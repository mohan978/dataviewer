
<!-- Importing Firebase SDK Starts Here-->
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
 <!-- Importing Firebase SDK Ends Here-->
 
 <!-- Importing JS files for charts of CanvaJs & HighCharts Starts Here-->
<script src="https://cdn.canvasjs.com/canvasjs.min.js"></script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/heatmap.js"></script>
<script src="https://code.highcharts.com/modules/treemap.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>
 <!-- Importing JS files for charts of CanvaJs & HighCharts Ends Here-->
 


  <script src="functions/commonFunctions.js"></script>
  <script src="functions/tableSortingFunctons.js"></script>
 <script src="functions/importFiles.js"></script>
 <script src="functions/firebase.js"></script>
 <script src="functions/firebaseFunctions.js"></script>
 <script src="functions/indexedDBFunctions.js"></script>

 <div id="importedContent"></div>
 
 <title>All Equity Live Scanner</title>
 
 

<style>

thead {
  position: sticky;
  top: 0;
}

body {
  margin: 0;
  font-family: Arial, Helvetica, sans-serif;
  background-color: #555;
  color: white; /* Set the text color to white */
}

* {
  box-sizing: border-box;
}

/* Create two unequal columns that floats next to each other */
.column {
  float: left;
  padding: 0.5px;
  height: 520px; /* Should be removed. Only for demonstration */
}

.equityLeft {
  width: 50%;
}

.spurtsRight {
  width: 50%;
}

.left {
  width: 25%;
}

.right {
  width: 75%;
}

/* Clear floats after the columns */
.row:after {
  content: "";
  display: table;
  clear: both;
}

@media screen and (max-width: 800px) {
  .column {
	width: 100%;
  }
  
  table {
    width: 100%;
	}
	
}

th, td {
    border: 1px solid black;
    padding: 1px;
    text-align: center;  /* Align text to the left */
    vertical-align: top;  /* Align content to the top */
}

</style>

 <label>Year:</label>
<select id="year" onchange="getFirestoreData()">
<option>2025</option>
</select>

 <label>Month Year:</label>
<select id="monthYear" onchange="getFirestoreData();fetchDataForAllSegments()">
</select>

 <label> | Trading Date:</label>
<select id="tradingDate" onchange="saveSelectedValues();setCommonSelectors();fetchDataForAllSegments()">
</select>


 <label> | Common TimeValues:</label>
<select id="commonTimeValues" onchange="saveSelectedValues();showLiveScannerAllStocksDataInTable()">
</select>

&nbsp; | &nbsp;&nbsp;
<button id="dataRefreshButton" onclick="getFirestoreData('refresh','')">Refresh</button>
&nbsp;&nbsp;<button id="dataRefreshButton" onclick="getFirestoreData('live','')">Live</button>

<hr>

 <label> Indices TimeValues:</label>
<select id="indicesTimeValues" onchange="getIndicesData()">
</select>

&nbsp; | &nbsp;&nbsp;
 <label> Spurts TimeValues:</label>
<select id="spurtsTimeValues" onchange="getSpurtsEquityData()">
</select>

&nbsp; | &nbsp;&nbsp;
 <label> Equity TimeValues:</label>
<select id="equityTimeValues" onchange="getAllEquityData()">
</select>
&nbsp; &nbsp;&nbsp; |  &nbsp;&nbsp; &nbsp;&nbsp;

 <button onclick='askClearIDB()'>Clear IDB</button>
<!--Content Start From Here-->



<span>&nbsp; &nbsp;&nbsp; |  &nbsp;&nbsp; &nbsp;&nbsp;Sync with Time  &nbsp;&nbsp; </span><label class="toggle">  <input id="indicesWithTimeOnOff" class="toggle-checkbox" type="checkbox" onchange="getPreMarketData()"> <div class="toggle-switch"></div> </label>
<style> .toggle {cursor: pointer;display: inline-block;}.toggle-switch {display: inline-block;background: #ccc;border-radius: 16px;width: 58px;height: 32px;position: relative;vertical-align: middle;transition: background 0.25s;}.toggle-switch:before, .toggle-switch:after {content: "";}.toggle-switch:before {display: block;background: linear-gradient(to bottom, #fff 0%, #eee 100%);border-radius: 50%;box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.25);width: 24px;height: 24px;position: absolute;top: 4px;left: 4px;transition: left 0.25s;}.toggle:hover .toggle-switch:before {background: linear-gradient(to bottom, #fff 0%, #fff 100%);box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.5);}.toggle-checkbox:checked + .toggle-switch {background: #56c080;}.toggle-checkbox:checked + .toggle-switch:before {left: 30px;}.toggle-checkbox {position: absolute;visibility: hidden;}.toggle-label {margin-left: 5px;position: relative;top: 2px;} </style>
	



<!-- Slider's Scripts STARTS from HERE -->

  <!-- <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/3.0.7/flatpickr.min.css"> -->
 <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/10.1.0/nouislider.min.css">
  <!-- <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.4.2/css/bulma.min.css"> -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.3.4/vue.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/3.0.7/flatpickr.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/10.1.0/nouislider.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
  
 <style>
    #slider {
    height: 10px;
}

#slider .noUi-connect {
    background: #c0392b;
}

#slider .noUi-handle {
    height: 18px;
    width: 18px;
    top: -5px;
    right: -9px; /* half the width */
    border-radius: 9px;
}

.noUi-tooltip {

    padding: 0px;

}


    </style>
	
<!--  Slider's Scripts ENDS HERE -->


<!--Content Start From Here-->
   <style>
        #sliderContainer {
            display: inline-block;
            vertical-align: middle;
            padding: 10px;
			 width: 100%;
        }


        #slider {
            width: 100%;
        }

  
        button {
            display: inline-block;
            vertical-align: middle;
            margin-left: 5px;
        }
    </style>
	
	 <style>
body {
  margin: 0;
  font-family: Arial, Helvetica, sans-serif;
  background-color: #555;
  color: white; 
   text-align: center;
  }
  
   
 .column {
  float: left;
  padding: 0.5px;
  height: 590px;
  margin-top:0px;
}

.Left {
  width: 55%;
  margin-left:1%;
}

.Right {
  width: 42%;
  margin-right:1%;
  margin-left:0.5%;
  margin-bottom:12px;
}

.row:after {
  content: "";
  display: table;
  clear: both;
  
}

 .Side {
  float: left;
  padding: 0.5px;
  height: 292px;
  width: 49.5%;
  
}

.First {
  width: 49.5%;
  margin-left:0.25%;
  margin-bottom:2px;
}

.Second {
  width: 49.5%;
  margin-right:0.1%;
  margin-left:0.25%;
  margin-bottom:2px;
  
}

.Bar1 {
  float: left;
  padding: 0.0px;
  height: 32px;
  width: 100%;
  margin-top:10px;
}

.sliderbar {
  width: 92%;
  height: 32px;
  margin-left:1%;
}

.sliderBtn {
  width: 6.5%;
  height: 32px;
  margin-left:0.2%;
}

.SmallBoxes{
height: 292px;
}

.SliderGO{
font-size: 18px;
margin-left:-10px ;
margin-top: 1.5px;
}

.SliderGO:active {
  background-color: #4CAF50;
  box-shadow: 0 5px #666;
  transform: translateY(2px);
  color: white;
}

.IntradayOI {
width: 48.5%;
}

.TotalOI {
width: 48.5%;
}


@media screen and (max-width: 700px) {
  .column {
    width: 98%;
	font-size: 15px;
	margin-left:1.5%;
	margin-right:1.5%;
  margin-bottom:12px;
  }
  
  .Side {
  float: left;
  padding: 0.5px;
  height: 270px;
  width: 49.5%;
  margin-bottom:2px;  
}

.SmallBoxes{
height: 270px;
}

.SliderGO{
font-size: 16px;
width: 50%;
}

.sliderBtn {
  width: 98%;
  margin-top:55px;
  }
  
  .sliderbar {
  width: 98%;
  height: 35px;
  margin-left:0%;
}

.IntradayOI {
width: 98%;
}

.TotalOI {
width: 98%;
}


}
</style>





<center>

<hr>

 <label> Derivatives Symbols:</label>
<select id="derivativesSymbols" onchange="showPerticularStocksEquityDataInTable()">
</select>
<span>  
 	| No. of Entries: 		 <input id="numberOfPreviousEntries" type="number" value="60"  size="3">
	| Minutes: 		 <input id="differenceBetweenEntries" type="number" value="1"  size="3">
 <button onclick="showPerticularStocksEquityDataInTable()">GO</button>
 </span>
<div class="spaceBetweenTables">  	<div id="perticularEquityTableContainer"></div> </div>
<div class="spaceBetweenTables">  	<div id="breakoutStocksTableContainer"></div> </div>
<div class="spaceBetweenTables">  	<div id="highestConsolidationBreakoutStocksTableContainer"></div> </div>


Breakout Time: 		<select id="breakoutTimeSelector"  onchange="showLiveScannerAllStocksDataInTable()">
<option>ALL</option>
</select>

Breakout Time Till: 		<select id="breakoutTimeTillSelector" >
<option>ALL</option>
</select>
 <button onclick="showLiveScannerAllStocksDataInTable()">GO</button>

<div class="spaceBetweenTables">  	<div id="highLowBreakoutContinuationStocksTableContainer"></div> </div>
<div class="spaceBetweenTables">  	<div id="highLowBreakoutContinuationStocksTableContainer2"></div> </div>


<br><br>
  <div class="row">
  <div class="Bar1 sliderbar" style="background-color:;">
    <div id="sliderContainer">
            <div id="slider"></div>
        </div>
  </div>
  <div class="Bar1 sliderBtn" style="background-color:;">
    <button class="SliderGO"onclick="showPerticularStocksEquityDataInTable()()">GO</button>
  </div>
          
  </div>
  <br><br>

<div class="spaceBetweenTables">  	<div id="highest_ask_bid_orders_tick_wise_TableContainer"></div> </div>
<div class="spaceBetweenTables">  	<div id="poc_changes_timewise_TableContainer"></div> </div>
<div class="spaceBetweenTables">  	<div id="volumeProfile_EquityTableContainer"></div> </div>
<div class="spaceBetweenTables">  	<div id="perticularEquityTableContainer2"></div> </div>



</center>



<div class="row">
  <div class="column left" style="background-color:#aaa;">
  
 <div id="IndicesPerformanceChart" style="min-height: 520px; height: auto;width: 100%;"></div>
   <br>
   </div>
  <div class="column right" style="background-color:#bbb;">
  
   <center> HeatMap Sectors: &nbsp;<select id="heatMapSectorSelector" aria-labelledby="expiryLbl" onchange="showHeatMapChart()"> <option value="">Select</option> </select></center>  <div id="heatMapContainer" style=" height:500px; width: auto; margin: 0 auto;"></div>

  </div>
</div>

<br><br>

<div class="row">
  <div class="column equityLeft" style="background-color:#aaa;">
    <div class="spaceBetweenTables">  	<div id="marketDepthOrderBookTableContainer"></div> </div>
  </div>
  <div class="column spurtsRight" style="background-color:#bbb;">
    <div class="spaceBetweenTables">  	<div id="liveSecurityWiseDeliveryTableContainer"></div> </div>
  </div>
</div>



<!-- 

<div class="row">
  <div class="column equityLeft" style="background-color:#aaa;">
    <div class="spaceBetweenTables">  	<div id="mostActiveFutStocksTableContainer"></div> </div>
  </div>
  <div class="column spurtsRight" style="background-color:#bbb;">
    <div class="spaceBetweenTables">  	<div id="mostActiveOptStocksTableContainer"></div> </div>
  </div>
</div>

<div class="row">
  <div class="column equityLeft" style="background-color:#aaa;">
    <div class="spaceBetweenTables">  	<div id="futuresDerivativesTableContainer"></div> </div>
  </div>
  <div class="column spurtsRight" style="background-color:#bbb;">
    <div class="spaceBetweenTables">  	<div id="optionsDerivativesTableContainer"></div> </div>
  </div>
</div>

<div class="row" name="optOIGainersLosers">
  <div class="column equityLeft" style="background-color:#aaa;">
    <div class="spaceBetweenTables">  	<div id="optOIGainersTableContainer"></div> </div>
  </div>
  <div class="column spurtsRight" style="background-color:#bbb;">
    <div class="spaceBetweenTables">  	<div id="optOILosersTableContainer"></div> </div>
  </div>
</div>

<div class="row" name="optPriceGainersLosers">
  <div class="column equityLeft" style="background-color:#aaa;">
    <div class="spaceBetweenTables">  	<div id="optPriceGainersTableContainer"></div> </div>
  </div>
  <div class="column spurtsRight" style="background-color:#bbb;">
    <div class="spaceBetweenTables">  	<div id="optPriceLosersTableContainer"></div> </div>
  </div>
</div>


<div class="row" name="futOIGainersLosers">
  <div class="column equityLeft" style="background-color:#aaa;">
    <div class="spaceBetweenTables">  	<div id="futOIGainersTableContainer"></div> </div>
  </div>
  <div class="column spurtsRight" style="background-color:#bbb;">
    <div class="spaceBetweenTables">  	<div id="futOILosersTableContainer"></div> </div>
  </div>
</div>


<div class="row" name="futPriceGainersLosers">
  <div class="column equityLeft" style="background-color:#aaa;">
    <div class="spaceBetweenTables">  	<div id="futPriceGainersTableContainer"></div> </div>
  </div>
  <div class="column spurtsRight" style="background-color:#bbb;">
    <div class="spaceBetweenTables">  	<div id="futPriceLosersTableContainer"></div> </div>
  </div>
</div>

Importing JS files for charts of CanvaJs & HighCharts Ends Here-->

<!--<div class="tableRow"> <center> Spurts Time: &nbsp;<select id="spurts_time_for_both" aria-labelledby="expiryLbl" onchange="adjust_equity_spurts_timeValues()"> <option value="">Select</option> </select> &nbsp; &nbsp;  | &nbsp; &nbsp; No. of Comparison Stocks : &nbsp; <input id="noOfComparisonStocks" type="number" value="30" size="3"> <button onclick="compareEquitySpurtsStocks(\'compareEquityWithSpurts\')">Cmp EquitySpurts</button> <button onclick="compareEquitySpurtsStocks(\'compareSpurtsWithEquity\')">Cmp SpurtsEquity</button>   </center> <br> <div class="tableColumn" style="background-color: ;border: 2px solid #4b4d4e;"> <div class="tableRow"> <center> Equity Time: &nbsp;<select id="only_equity_time" aria-labelledby="expiryLbl" onchange="show_only_equity_Data()"> <option value="">Select</option> </select> </center>  <div id="equityDataTableContainer"></div> </div> </div> <div class="tableColumn" style="border: 2px solid #4b4d4e;"> <div class="tableRow"> <center> Spurts Time: &nbsp;<select id="only_spurts_time" aria-labelledby="expiryLbl" onchange="show_only_Spurts_Data()"> <option value="">Select</option> </select> </center>  <div id="spurtsDataTableContainer"></div> </div> </div> -->


<br><br><br><br><br><br>
<!--Content Ends Here-->


<script>
function fetchDataForAllSegments()
{
set_breakout_timevalues()
//setIndicesSelectorTimeValues( "syncWithCommonTime" );
//setSpurtsSelectorTimeValues( "syncWithCommonTime" )
setDerivativesSelectorTimeValues( "syncWithCommonTime" )
showLiveScannerAllStocksDataInTable()
//setDerivativesSelectorTimeValues( "last" )

}
</script>


<!-- Indices Code Starts Here -->
<script>

function setIndicesSelectorTimeValues( passedValue )
{
	var tradingDate = document.getElementById('tradingDate').value
	var timeValuesArray = firestoreIndexObj[ tradingDate ]['Index']['index_performace']
	var selectElementRef = document.getElementById("indicesTimeValues");
	
	handleTimeValues( passedValue, timeValuesArray, selectElementRef, getIndicesData )
}

async function getIndicesData( passedValue )
{
	var selectedMonthYear = document.getElementById('monthYear').value
	var selectedTradingDate = document.getElementById('tradingDate').value
	var selectedIndicesTimeValues = document.getElementById('indicesTimeValues').value
	
	var docPath = '/'+selectedMonthYear+'/'+selectedTradingDate+'/index_performace/'+selectedIndicesTimeValues
	//await fetchFirebaseDocData( docPath, showIndicesPerformanceChart )
	var dataObj = await fetchFirebaseDocData( docPath )
	console.log( "dataObj", JSON.parse( dataObj['data'] )  )
	showIndicesPerformanceChart ( JSON.parse( dataObj['data'] ) )

}

async function showIndicesPerformanceChart ( returnedDataObj )
{
	var selectedIndicesTimeValues = document.getElementById('indicesTimeValues').value
	//var selectedValue = document.getElementById("indices_performance_time").value;
		
	//var indicesPerformanceObject = mainOIDataObject['index_performace'][selectedValue]
	var indicesPerformanceObject = returnedDataObj ['data']
	
	// list updated on June 30, 2023 from https://archives.nseindia.com/content/indices/ind_nifty50.pdf
	var sectorsWeightageInNifty50 = { "FIN SERVICE":37.59, "IT":12.65, "OIL AND GAS":11.99, "FMCG": 9.82, "AUTO":5.98, "PHARMA":3.86, "HEALTHCARE":3.86,"Construction":3.54, "METAL":3.52, "CONSR DURBL":3.30,"Telecommunication":2.61, "ENERGY":2.10,"INFRA":1.89, "SERV SECTOR":0.74, "Chemicals":0.41 }
	
	var dataPointsArray=[]
	var dataPointsArrayAdvances=[]
	var dataPointsArrayDeclines=[]
	var dataPointsArrayUnchanged=[]
	var dataPointsArrayPChangeAddition=[]
	
	var tempObj={}
	for (var symbol in indicesPerformanceObject) {
		//if(symbol !='INDIA VIX' && symbol !='NIFTY FINSRV25 50' && symbol !='NIFTY HEALTHCARE' )
		//if(symbol !='INDIA VIX' && symbol !='NIFTY FINSRV25 50' )
		if(symbol !='INDIA VIX' && symbol !='NIFTY FINSRV25 50' && symbol !='NIFTY NEXT 50' && symbol !='NIFTY 100' && symbol !='NIFTY 200' && symbol !='NIFTY 500' && symbol !='NIFTY MIDCAP 50' && symbol !='NIFTY MIDCAP 100' && symbol !='NIFTY SMLCAP 100' && symbol !='NIFTY MIDCAP 150' && symbol !='NIFTY SMLCAP 50' && symbol !='NIFTY SMLCAP 250' && symbol !='NIFTY MIDSML 400' && symbol !='NIFTY500 MULTICAP' && symbol !='NIFTY LARGEMID250' && symbol !='NIFTY TOTAL MKT' && symbol !='NIFTY MICROCAP250' )
		{
		tempObj[symbol]=indicesPerformanceObject[symbol]['percentChange']
		}
	}
	
// tempObj is sorted by this code
//Object.keys(tempObj).sort((a,b) => tempObj[a]-tempObj[b]).forEach((symbol) => { 	// ascending sort
Object.keys(tempObj).sort((a,b) => tempObj[a]-tempObj[b]).forEach((symbol) => {  	//  descending sort
var temp={}
if(symbol !='NIFTY 50' && symbol !='NIFTY BANK')
//if(symbol !='NIFTY BANK')
{
	temp["label"]=symbol.replace(/NIFTY /g,'')
}
else{
	temp["label"]=symbol
}
	
	if( sectorsWeightageInNifty50[ temp["label"] ]!=undefined )
	{
		 temp["label"] =  temp["label"] +" ("+ sectorsWeightageInNifty50[ temp["label"] ] +")"
	}
	
		//temp["y"]=tempObj[symbol]; 
		temp["y"]= Math.abs( tempObj[symbol] ); 
		if(tempObj[symbol]<0) 
		{
			temp["color"]="#cd5652"
		}
		else if(tempObj[symbol]>0) 
		{
			temp["color"]="#3a7dd4"
		}
		else if(tempObj[symbol]==0) 
		{
			temp["color"]="black"
		}
		
		dataPointsArray.push(temp)
	});
	
/*
Object.keys(tempObj).sort((a,b) => tempObj[b]-tempObj[a]).forEach((symbol) => {  	//  descending sort
var temp={}
var sectorName = symbol.replace(/_/g,' ')
if(sectorName !='NIFTY 50' && sectorName !='NIFTY BANK')
//if(symbol !='NIFTY BANK')
{
	temp["label"]=sectorName.replace(/NIFTY /g,'')
}
else{
	temp["label"]=sectorName
}
	
		temp["y"]=indicesPerformanceObject[symbol][9]; 
		temp["color"]="#089981"
			
		dataPointsArrayAdvances.push(temp)
		//console.log(symbol, preMarketSectorObj[symbol]["advances"])
	});
	
Object.keys(tempObj).sort((a,b) => tempObj[b]-tempObj[a]).forEach((symbol) => {  	//  descending sort
var temp={}
var sectorName = symbol.replace(/_/g,' ')
if(sectorName !='NIFTY 50' && sectorName !='NIFTY BANK')
//if(symbol !='NIFTY BANK')
{
	temp["label"]=sectorName.replace(/NIFTY /g,'')
}
else{
	temp["label"]=sectorName
}
	
		temp["y"]=indicesPerformanceObject[symbol][10]; 
		temp["color"]="#cd5652"
		
	
		
		dataPointsArrayDeclines.push(temp)
		
	});	
	
Object.keys(tempObj).sort((a,b) => tempObj[b]-tempObj[a]).forEach((symbol) => {  	//  descending sort
var temp={}
var sectorName = symbol.replace(/_/g,' ')
if(sectorName !='NIFTY 50' && sectorName !='NIFTY BANK')
//if(symbol !='NIFTY BANK')
{
	temp["label"]=sectorName.replace(/NIFTY /g,'')
}
else{
	temp["label"]=sectorName
}
	
		temp["y"]=indicesPerformanceObject[symbol][11]; 
	
		temp["color"]="#cbba4d"
		
		
		dataPointsArrayUnchanged.push(temp)
	});
	
	*/
// this section is for plotting indices chart for simple perchange change of single column bar
var chart = new CanvasJS.Chart("IndicesPerformanceChart", {
	animationEnabled: true,
	theme: "dark2", // "light1", "light2", "dark1", "dark2"
	title: {
		//text: "GDP Growth Rate - 2016"
	},
	subtitles: [{
			//text: "Subtitle 1"
		  },{
			text:  returnedDataObj['timestamp'].split(' ')[0] +' | '+ selectedIndicesTimeValues +' | '+returnedDataObj['timestamp'].split(' ')[1],
			//verticalAlign: "top",

			 //horizontalAlign: "right",
	
			 //fontSize: 15,
			 fontSize: 13,
			//dockInsidePlotArea: true
			dockInsidePlotArea: false
	}],
	
	toolTip: {
			//fontSize: 19,
			fontSize: 15,
	},
	axisY: {
		//title: "Growth Rate (in %)",
		//includeZero: true,
		//suffix: "%",
		gridThickness: 0.03,
		//labelFontSize: 18,
		labelFontSize: 0, // bottom size for change%
		 tickLength: 0,
		 
	},
	axisX: {
		interval: 1,
		//title: "Countries"
		includeZero: true,
		 //labelFontSize: 17,
		 labelFontSize: 11, // vertical axis size for text
		 //labelFontWeight: "bold",
		  lineThickness: 0.5,
         lineColor: "#ccc",
		 tickColor: "#555",
		 tickLength: 0,
		
		 
	},
	dataPointWidth: 12,
	data: [{
		//indexLabel: "{y}",
		//indexLabelFontSize: 18,
		click: onClick,
		//type: "column",
		type: "bar",
		indexLabelPlacement: "auto",
			indexLabel: "{y}",
			indexLabelFontSize: 11,
			indexLabelFontColor: "#ddd",
		yValueFormatString: "#,##0.0#\"%\"",
		dataPoints:dataPointsArray
	}]
});


//console.log("dataPointsArray",dataPointsArray)
chart.render();
//chart2.render();

} // showIndicesPerformanceChart ENDS HERE




function onClick(e) {

		//var label=e.dataPoint.label
		var label=e.dataPoint.label.replace(/ \(.*/g, '')
		var labelToScroll;
		{
			if( label=='NIFTY 50' || label=='NIFTY BANK')
			{
				labelToScroll = label.replace(/ /g, '_')
				document.getElementById("heatMapSectorSelector").value = labelToScroll ;
				showHeatMapChart();
				document.getElementById("heatMapSectorSelector").scrollIntoView();
			}
			else
			{
				labelToScroll = 'NIFTY_'+label.replace(/ /g, '_')
				document.getElementById("heatMapSectorSelector").value = labelToScroll ;
				showHeatMapChart();
				document.getElementById("heatMapSectorSelector").scrollIntoView();
			}
		}

		
}



</script>
<!-- Indices Code Ends Here -->



<!-- Spurts-Equity Code Starts Here -->

<style>    .spaceBetweenTables { border: 2px solid #4b4d4e;height: 518px;overflow-y: scroll;background-color: #32373a; }     .greenHeaderClass{   color: #ffffff;   background: #27ae60;   } .blueHeaderClass{   color: #ffffff;   background: #3a7dd4;    }  caption {	white-space: nowrap;  text-align: center; color: #ffffff; height: px; padding-top: 0rem; padding-bottom: 0rem;	}	</style>


<script>
var dataObjectForHeatChart={}
var sectorStockNamesObj = {}
var allBanksStocksObj ={}

function setSpurtsSelectorTimeValues( passedValue )
{
	var tradingDate = document.getElementById('tradingDate').value
	var timeValuesArray = firestoreIndexObj[ tradingDate ]['Index']['spurts_in_open_interest_by_underlyings']
	var selectElementRef = document.getElementById("spurtsTimeValues");
	
	handleTimeValues( passedValue, timeValuesArray, selectElementRef, getSpurtsEquityData )
}


async function getSpurtsEquityData( passedValue )
{
	var tradingDate = document.getElementById('tradingDate').value
	var selectedMonthYear = document.getElementById('monthYear').value
	var selectedTradingDate = document.getElementById('tradingDate').value
	
	var selectedSpurtsTimeRef = document.getElementById('spurtsTimeValues')
	var selectedSpurtsTimeValue = selectedSpurtsTimeRef.value

	var docPathForSpurts = '/'+selectedMonthYear+'/'+selectedTradingDate+'/spurts_in_open_interest_by_underlyings/'+selectedSpurtsTimeValue
	var spurtsDataObj = await fetchFirebaseDocData( docPathForSpurts )
	
	//console.log( "spurtsDataObj",JSON.parse( spurtsDataObj['data'] ) )
	//console.log( "spurtsDataObjPrevious",JSON.parse( spurtsDataObjPrevious['data'] ) )
	//showIndicesPerformanceChart ( JSON.parse( dataObj['data'] ) )
	
	
	var equityTimeValuesArray = firestoreIndexObj[ tradingDate ]['Index']['equity_market']['FnO']
	var equitySyncedTimeValue = syncTimeValues( equityTimeValuesArray, selectedSpurtsTimeValue )
	//var docPathForEquity = '/'+selectedMonthYear+'/'+selectedTradingDate+'/equity_market/FnO/'+equitySyncedTimeValue[0]+'/'+equitySyncedTimeValue[0]
	var docPathForEquity = '/'+selectedMonthYear+'/'+selectedTradingDate+'/equity_market/ALL/'+equitySyncedTimeValue[0]+'/'+equitySyncedTimeValue[0]
	
	//console.log( "docPathForEquity", docPathForEquity )
	var equityDataObj = await fetchFirebaseDocData( docPathForEquity )
	console.log( "equityDataObj",JSON.parse( equityDataObj['data'] ) )

	var docPathForDeliveryData = '/'+selectedMonthYear+'/'+selectedTradingDate+'/delivery_data/delivery_data'
	var deliveryDataObj = await fetchDeliveryDataDocData( docPathForDeliveryData )
	
	//console.log( "deliveryDataObj",JSON.parse( deliveryDataObj['data'] ) )
	
	
	var collectioPath = '/'+selectedMonthYear+'/'+selectedTradingDate+'/sector_stockNames/'
	sectorStockNamesObj = await fetchSectorStockNamesCollectionData( collectioPath )
	
	await show_only_equity_Data( selectedSpurtsTimeValue, selectedTradingDate, JSON.parse( equityDataObj['data'] ), JSON.parse( spurtsDataObj['data'] ) , JSON.parse( deliveryDataObj['data'] ) )
	//await show_only_Spurts_Data( selectedSpurtsTimeValue, selectedTradingDate, JSON.parse( equityDataObj['data'] ), JSON.parse( spurtsDataObj['data'] ) , JSON.parse( deliveryDataObj['data'] ) )
	
	addEventListnerInTables()
}

async function show_only_equity_Data( selectedSpurtsTimeValue, selectedTradingDate, equityDataObj, spurtsDataObj, deliveryDataObj )
{
	 //document.getElementById('equityDataTableContainer').innerHTML = "";
	
	var selectedValue = selectedSpurtsTimeValue
	//var previousTime=selectedValue.options[selectedValue.selectedIndex - 1] 
	
	var niftyTotalMarketObject = equityDataObj['data']
	var spurtsInOIUnderlyingsObject = spurtsDataObj['data']

//console.log( selectedSpurtsTimeValue, selectedSpurtsTimeValuePrevious, equityDataObj, equityDataObjPrevious, spurtsDataObj, spurtsDataObjPrevious  )

		var tempObj = {};

	
	  var onlyEquityTableStr = ' <div class=""> <div class="spaceBetweenTablesSpurtsEquity"> <table id="onlyEquityTableStr"> <caption style="caption-side:top"> Intraday Hike | '+selectedTradingDate+' | '+selectedValue+'</caption> <thead> <tr class="tableRowClass">'
	  +'<th>Symbol</th>'
	  +' <th>Chg%</th>'
	   +' <th>LTP</th>'
	  +' <th>T.O.</th>'
	 +' <th>Money</th>'
	  +' <th>20DAV</th>'
	  +' </tr> </thead> <tbody>'

		for (var S=0; S<spurtsInOIUnderlyingsObject.length ;S++ ) { // loop for accessing all stocks of 754 stocks
		var Symbol=spurtsInOIUnderlyingsObject[S]['symbol']
		//for (var Symbol in niftyTotalMarketObject ) { // loop for accessing all stocks of 754 stocks
		if( Symbol.includes('NIFTY')==false )
		{
		var symbolArray = niftyTotalMarketObject[Symbol] //for short-handing
        var spurtsSymbolArray = spurtsInOIUnderlyingsObject[S] //for short-handing
	
	var SpurtValvsOI = spurtsSymbolArray["total"] / spurtsSymbolArray["latestOI"]
	var average20DaysValue = deliveryDataObj["Symbols"][Symbol]["calculatedData"]["averageValues"]["twentyDays"]
	var EqtyValvs20DAyVal = ( (symbolArray["totalTradedValue"] ) / average20DaysValue)
	
	var WFactor =( EqtyValvs20DAyVal + SpurtValvsOI ).toFixed(2)
	var twentyDAV =( symbolArray["totalTradedValue"]  / average20DaysValue).toFixed(2)
	 
	  var rankForHeatMap = WFactor
	  
		//this block of code is for sectors heatMap chart. (START)
		//this block adds stocks in a object with few values. this code was written on 7-Jan-2023
		{
			//dataObjectForHeatChart["selectedTime"] =selectedValue.value
			dataObjectForHeatChart["selectedTime"] =selectedValue
			dataObjectForHeatChart["selectedTradingDate"] =selectedTradingDate
		   var colorValue;
		   var dataLabelFontColor="white";
		   
		if(symbolArray["pChange"]>=0)
	   {
		   if( symbolArray["pChange"]>=0 && symbolArray["pChange"]<=0.5)
		   {
			   colorValue = '#7cb67e' 
			  // dataLabelFontColor="black"
		   }
		   else if( symbolArray["pChange"]>0.5 && symbolArray["pChange"]<=1)
		   {
			   colorValue = '#6cac6e'
		   } 
		   else if( symbolArray["pChange"]>1 && symbolArray["pChange"]<=2)
		   {
			    colorValue = '#5ca35e'
		   }
		   else if( symbolArray["pChange"]>2)
		   {
			   colorValue = '#539355'
		   }
			   
		  
		   dataObjectForHeatChart[Symbol] ={
			  parent: 'Green',
			 name: Symbol,
			 pChange:symbolArray["pChange"],
			 value: Number(rankForHeatMap),
			 //colorValue: Number(symbolArray["pChange"])
			 color: colorValue,
			 
			 dataLabels: {
				 shadow: false,
				 color: dataLabelFontColor //data label font color
				 //format: '{name pChange} %'
			 }
		 }
		   
		 
	   }
	   else
	   {
		   if( symbolArray["pChange"]>=-0.5 && symbolArray["pChange"]<0)
		   {
			   colorValue = '#d4777a'
			   //dataLabelFontColor="black"
		   }
		   else if( symbolArray["pChange"]>-1 && symbolArray["pChange"]<=-0.5)
		   {
			   colorValue = '#ce6467'
		   }
		   else if( symbolArray["pChange"]>-2 && symbolArray["pChange"]<=-1)
		   {
			   colorValue = '#ca575a'
		   }
		   else if( symbolArray["pChange"]>-2)
		   {
			   colorValue = '#c85155'
		   }
			   
			 dataObjectForHeatChart[Symbol] ={
			  parent: 'Red',
			 name: Symbol,
			 pChange:symbolArray["pChange"],
			 value: Number(rankForHeatMap),
			 //colorValue: Number(symbolArray["pChange"])
			 color: colorValue,
			 
			 dataLabels: {
				  shadow: false,
				 color: dataLabelFontColor, //data label font color
				 //format: '{name pChange} %'
			 }
		 }
		  
		  
	   }
		
		}	   	//this block of code is for sectors heatMap chart. (END)
		  
		  
		  
		{
			onlyEquityTableStr +='<tr class="item"><td>'
			 +Symbol
			 +'</td><td>'
			+ symbolArray['pChange']  //pchange
			 +'</td><td>'
			 +symbolArray['lastPrice']  //lastPrice
			 +'</td><td>'
			 +( symbolArray['totalTradedValue'] / 1000000).toFixed(0)  //(symbolArray[8] / 10000000).toFixed(2) //totalTradedValue
		 +'</td><td>'
		 + WFactor
		+'</td><td>'
		+ twentyDAV
		+'</td></tr>'
			
		
		}
	}
		} //for Loop ENDS HERE
		
		onlyEquityTableStr +=' </tbody> </table>    </div>  </div>'
		
	//document.getElementById('equityDataTableContainer').innerHTML = onlyEquityTableStr
	 //addEventListnerInTables()
	 add_Sectors_In_HeatMapSelector( )
}	//	show_volume_value_spike_Data() Function ENDS HERE


function add_Sectors_In_HeatMapSelector( )
{
	//console.log( "sectorStockNamesObj", sectorStockNamesObj)
	
	if( sectorStockNamesObj !=undefined)
	{
	if( document.getElementById("heatMapSectorSelector").getElementsByTagName('option').length <=1 )
	{
	document.getElementById("heatMapSectorSelector").innerHTML = "";
	
	var option = document.createElement("option");
	option.value = "ALL BANKS";
	option.text = "ALL BANKS";
	document.getElementById("heatMapSectorSelector").add(option);
	
	
	for ( var sectorName in sectorStockNamesObj ) {
		
		if( sectorName != 'Template' )
		{
		var option = document.createElement("option");
		option.value = sectorName;
		option.text = sectorName;
		document.getElementById("heatMapSectorSelector").add(option);
		}
	}
	//document.getElementById('heatMapSectorSelector').value=document.getElementById('heatMapSectorSelector').getElementsByTagName('option')[2].value
	document.getElementById('heatMapSectorSelector').value="NIFTY_50"
	}
	
	//showHeatMapChart(sectorStockNamesObj)
	showHeatMapChart()
	}
	
} // add_Sectors_In_HeatMapSelector() ENDS HERE

async function showHeatMapChart( )
{
	await setHighChartsDarkTheme()
	var sectorDataArrayForHeatChart=[{
      id: 'Green',
      //name: 'Green',
      color: "#EC2500"
    }, {
      id: 'Red',
      //name: 'Red',
      color: "#ECE100"
    }]
	
	var heatMapSectorSelected = document.getElementById("heatMapSectorSelector").value
	var sectorStockArray;
	if( heatMapSectorSelected=='ALL BANKS' )
	{
		
		for( var sector in sectorStockNamesObj )
		{
			if( sector.includes('BANK')==true )
			{
				var sectorStockArray = sectorStockNamesObj [sector]
				for( var s=0;s<sectorStockArray.length;s++)
				{
					var Symbol = sectorStockArray [s]
					allBanksStocksObj [Symbol] = 1
				}
				
			}
		}
		
		sectorStockArray = Object.keys(allBanksStocksObj)
	}
	else {
	sectorStockArray = sectorStockNamesObj [heatMapSectorSelected] 
	}
	for( var s=0;s<sectorStockArray.length;s++)
	{
		var Symbol = sectorStockArray [s]
		//console.log(Symbol)
		if( dataObjectForHeatChart[Symbol] !=undefined )
		{
			sectorDataArrayForHeatChart.push( dataObjectForHeatChart[Symbol] )
		}
	}
	//console.log("sectorDataArrayForHeatChart", sectorDataArrayForHeatChart)
	
	
var H = Highcharts
H.addEvent(H.Legend, 'afterGetAllItems', function(e) {
  e.allItems.splice(2, 6);
});

H.chart('heatMapContainer', {
  colorAxis: {
      stops: [
       
	  [0, '#ff0000'],//red
      [0.5, '#fff'], // white
      [1, '#02ff00']//green
	  
    ],
  },
  legend: {
      enabled: false
    },
  series: [{
	animation: false,
	borderWidth: 0.25,
    //borderColor: '#fff',
    borderColor: '#4b4b4c',
    colorAxis: 0,
    legendType: 'point',
    showInLegend: false,
    type: "treemap",
    layoutAlgorithm: 'squarified',
    alternateStartingDirection: true,
    levels: [{
      level: 1,
      layoutAlgorithm: 'sliceAndDice',
      dataLabels: {
        enabled: false,
        align: 'left',
        verticalAlign: 'top',
        style: {
          fontSize: '15px',
          fontWeight: 'bold'
        }
      }
    }],
    data: sectorDataArrayForHeatChart,
	
  dataLabels: {
		enabled: true,
                format: '{point.name} <br> {point.value}',
			 },
			 
			  events: {
                    click: function (event) {
                        //console.log(event.point.name);
						copyHeatMapList( heatMapSectorSelected, event.point.parent )
                    }
                }
  }],
  tooltip: {
            //headerFormat: 'Temperature<br/>',
            pointFormat: '{point.name} <br> pChange: {point.pChange} <br> Rank: {point.value}'
        },
	
  title: {
    //text: heatMapSectorSelected +' | '+ dataObjectForHeatChart["selectedTime"] +' | '+ mainOIDataObject['Date'],
    text: heatMapSectorSelected +' | '+ dataObjectForHeatChart["selectedTradingDate"] +' | '+ dataObjectForHeatChart["selectedTime"],
	   style: {
                    //color: 'red',
                    fontSize:'15px'
                }
  }
});

}

function setHighChartsDarkTheme()
{

	Highcharts.theme = {
    colors: ['#2b908f', '#90ee7e', '#f45b5b', '#7798BF', '#aaeeee', '#ff0066',
        '#eeaaee', '#55BF3B', '#DF5353', '#7798BF', '#aaeeee'],
    chart: {
        backgroundColor: {
            linearGradient: { x1: 0, y1: 0, x2: 1, y2: 1 },
            stops: [
                [0, '#2a2a2b'],
                [1, '#3e3e40']
            ]
        },
        style: {
     
        },
        plotBorderColor: '#606063'
    },
    title: {
        style: {
            color: '#E0E0E3',
            textTransform: 'uppercase',
            fontSize: '20px'
        }
    },
    subtitle: {
        style: {
            color: '#E0E0E3',
            textTransform: 'uppercase'
        }
    },
    xAxis: {
        gridLineColor: '#707073',
        labels: {
            style: {
                color: '#E0E0E3'
            }
        },
        lineColor: '#707073',
        minorGridLineColor: '#505053',
        tickColor: '#707073',
        title: {
            style: {
                color: '#A0A0A3'
            }
        }
    },
    yAxis: {
        gridLineColor: '#707073',
        labels: {
            style: {
                color: '#E0E0E3'
            }
        },
        lineColor: '#707073',
        minorGridLineColor: '#505053',
        tickColor: '#707073',
        tickWidth: 1,
        title: {
            style: {
                color: '#A0A0A3'
            }
        }
    },
    tooltip: {
        backgroundColor: 'rgba(0, 0, 0, 0.85)',
        style: {
            color: '#F0F0F0'
        }
    },
    plotOptions: {
        series: {
            dataLabels: {
                color: '#F0F0F3',
                style: {
                    fontSize: '12px'
                }
            },
            marker: {
                lineColor: '#333'
            }
        },
        boxplot: {
            fillColor: '#505053'
        },
        candlestick: {
          
        },
        errorbar: {
            
        }
    },
    legend: {
        backgroundColor: 'rgba(0, 0, 0, 0.5)',
        itemStyle: {
            color: '#E0E0E3'
        },
        itemHoverStyle: {
            color: '#FFF'
        },
        itemHiddenStyle: {
            color: '#606063'
        },
        title: {
            style: {
                color: '#C0C0C0'
            }
        }
    },
    credits: {
        style: {
            color: '#666'
        }
    },
    labels: {
        style: {
            color: '#707073'
        }
    },
    drilldown: {
        activeAxisLabelStyle: {
            color: '#F0F0F3'
        },
        activeDataLabelStyle: {
            color: '#F0F0F3'
        }
    },
    navigation: {
        buttonOptions: {
            symbolStroke: '#DDDDDD',
            theme: {
                fill: '#505053'
            }
        }
    },
    // scroll charts
    rangeSelector: {
        buttonTheme: {
            fill: '#505053',
            stroke: '#000000',
            style: {
              
            },
            states: {
                hover: {
                    fill: '#707073',
                    stroke: '#000000',
                    style: {
                      
                    }
                },
                select: {
                    fill: '#000003',
                    stroke: '#000000',
                    style: {
                        
                    }
                }
            }
        },
        inputBoxBorderColor: '#505053',
        inputStyle: {
            backgroundColor: '#333',
            color: 'silver'
        },
        labelStyle: {
            color: 'silver'
        }
    },
    navigator: {
        handles: {
            backgroundColor: '#666',
            borderColor: '#AAA'
        },
        outlineColor: '#CCC',
        maskFill: 'rgba(255,255,255,0.1)',
        series: {
            color: '#7798BF',
            lineColor: '#A6C7ED'
        },
        xAxis: {
            gridLineColor: '#505053'
        }
    },
    scrollbar: {
        barBackgroundColor: '#808083',
        barBorderColor: '#808083',
        buttonArrowColor: '#CCC',
        buttonBackgroundColor: '#606063',
        buttonBorderColor: '#606063',
        rifleColor: '#FFF',
        trackBackgroundColor: '#404043',
        trackBorderColor: '#404043'
    }
};
	// Apply the theme
	Highcharts.setOptions(Highcharts.theme);

}


function copyHeatMapList( heatMapSectorSelected, greenOrRed )
{
	var symbolObject ={}
	var sectorStockArray;
	if( heatMapSectorSelected=='ALL BANKS' )
	{
		sectorStockArray = Object.keys(allBanksStocksObj)
	}
	else {
	sectorStockArray = sectorStockNamesObj[heatMapSectorSelected]
	}
	
	for( var s=0;s<sectorStockArray.length;s++)
	{
		var Symbol = sectorStockArray [s]
		//console.log(Symbol)
		if( dataObjectForHeatChart[Symbol] !=undefined )
		{
			if( dataObjectForHeatChart[Symbol]["parent"]==greenOrRed )
				symbolObject[Symbol] = dataObjectForHeatChart[Symbol]["value"] //symbol's rank
		}
	}
	
	var stockNames=''
	stockNames= ( 'NSE:'+dataObjectForHeatChart["selectedTime"] +'_'+ heatMapSectorSelected+',' ).replace(/ /g,'_')
	
	Object.keys(symbolObject).sort((a,b) => symbolObject[b]-symbolObject[a]).forEach((symbol) => {    	//  descending sort
		stockNames +='NSE:'+symbol.replace(/-/g,'_').replace(/&amp;/g,'_').replace(/&/g,'_') +','
	});

	
	
	navigator.clipboard.writeText(stockNames);
}


</script>
<!-- Spurts-Equity Code Ends Here -->



<!-- All Derivatives Code Starts Here -->

<style>    .spaceBetweenTables { border: 2px solid #4b4d4e;height: 518px;overflow-y: scroll;background-color: #32373a; }     .greenHeaderClass{   color: #ffffff;   background: #27ae60;   } .blueHeaderClass{   color: #ffffff;   background: #3a7dd4;    }  caption {	white-space: nowrap;  text-align: center; color: #ffffff; height: px; padding-top: 0rem; padding-bottom: 0rem;	}	</style>


<script>
var sectorStockNamesObj = {}


function setCommonSelectors()
{
	var tradingDate = document.getElementById('tradingDate').value
	
	var monthYearCollection = document.getElementById('monthYear').value
	//var allSymbolsArray = ( firestoreIndexObj[ monthYearCollection ] [tradingDate] ).sort();
	//var selectElementRef = document.getElementById("derivativesSymbols");
	
	var timeValuesArray 
	//timeValuesArray = ( firestoreIndexObj[ monthYearCollection ] [tradingDate] ).sort();
	timeValuesArray = ( firestoreIndexObj[ monthYearCollection ]['all_equity_index'] [tradingDate] ).sort();
	/*
	if( firestoreIndexObj[ tradingDate ]['all_equity_index']['time_values'] !=undefined )
	{
		//timeValuesArray = firestoreIndexObj[ tradingDate ]['Index']['common_timeValues']
		timeValuesArray = firestoreIndexObj[ tradingDate ]['all_equity_index']['time_values']
		// handle common time values
	}
	else if( firestoreIndexObj[ tradingDate ]['Index']['common_time_values'] !=undefined )
	{
		//timeValuesArray = firestoreIndexObj[ tradingDate ]['Index']['common_timeValues']
		timeValuesArray = firestoreIndexObj[ tradingDate ]['Index']['common_time_values']
		// handle common time values
	}
	else
	{
		timeValuesArray = firestoreIndexObj[ tradingDate ]['Index']['index_performace']
	}
	*/

const selectElement = document.getElementById("commonTimeValues");
selectElement.innerHTML = '<option>Select</option>'
  for (let i = 0; i < timeValuesArray.length; i++) {
    const optionElement = document.createElement("option");
    optionElement.text = timeValuesArray[i];
    selectElement.add(optionElement);
  }


}

function setDerivativesSelectorTimeValues( passedValue )
{
	/*
	var tradingDate = document.getElementById('tradingDate').value
	var timeValuesArray = firestoreIndexObj[ tradingDate ]['all_equity_index']['time_values']
	var selectElementRef = document.getElementById("equityTimeValues");
	
	handleTimeValues( passedValue, timeValuesArray, selectElementRef, getAllEquityData )
	*/
	setDerivativesSymbolsSelector( passedValue )
}

function setDerivativesSymbolsSelector( passedValue )
{
	var tradingDate = document.getElementById('tradingDate').value
	var monthYearCollection = document.getElementById('monthYear').value
	var allSymbolsArray = (firestoreIndexObj[ monthYearCollection ]['stock_names']).sort();
	var selectElementRef = document.getElementById("derivativesSymbols");
	
	if( selectElementRef.options.length<3 )
		handleTimeValues( passedValue, allSymbolsArray, selectElementRef, null )
}

async function getAllEquityData( passedValue )
{

	var tradingDate = document.getElementById('tradingDate').value
	var selectedMonthYear = document.getElementById('monthYear').value
	var selectedTradingDate = document.getElementById('tradingDate').value
	
	var selectedEquityTimeRef = document.getElementById('equityTimeValues')
	var selectedEquityTimeValue = selectedEquityTimeRef.value

	var docPath = '/'+selectedMonthYear+'/'+selectedTradingDate+'/all_equity/'+selectedEquityTimeValue+'/'+selectedEquityTimeValue
	//var allDerivativesDataArray = await fetchDerivativesCollectionData( docPathForSpurts )
	//console.log( "docPath", docPath )
	
	var allEquityDataObj = await fetchAndSaveDataIDB( docPath );
	
	var selectedDifferenceBetweenEntries = Number( document.getElementById("differenceBetweenEntries").value )
	//var returnedEntryWiseObj = await previousEntriesDataObj( 2, 1, selectedTradingDate, true)
	var returnedEntryWiseObj = await previousEntriesDataObj( 2, selectedDifferenceBetweenEntries, selectedTradingDate, true)
	//console.log( "returnedEntryWiseObj.length", returnedEntryWiseObj )
	
	//console.log( "allDerivativesDataArray.length", JSON.stringify( allDerivativesDataArray ).length )
	//console.log( "spurtsDataObjPrevious",JSON.parse( spurtsDataObjPrevious['data'] ) )
	//showIndicesPerformanceChart ( JSON.parse( dataObj['data'] ) )
	
	//await showAllDerivativesData( selectedDerivativesTimeValue, selectedTradingDate, allDerivativesDataObj )
	await calculateFutOptData( selectedEquityTimeValue, selectedTradingDate, allEquityDataObj, returnedEntryWiseObj )


	/*
	var equityTimeValuesArray = firestoreIndexObj[ tradingDate ]['Index']['equity_market']['FnO']
	var equitySyncedTimeValue = syncTimeValues( equityTimeValuesArray, selectedSpurtsTimeValue )
	var docPathForEquity = '/'+selectedMonthYear+'/'+selectedTradingDate+'/equity_market/FnO/'+equitySyncedTimeValue[0]+'/'+equitySyncedTimeValue[0]
	
	//console.log( "docPathForEquity", docPathForEquity )
	var equityDataObj = await fetchFirebaseDocData( docPathForEquity )
	console.log( "equityDataObj",JSON.parse( equityDataObj['data'] ) )

	var docPathForDeliveryData = '/'+selectedMonthYear+'/'+selectedTradingDate+'/delivery_data/delivery_data'
	var deliveryDataObj = await fetchDeliveryDataDocData( docPathForDeliveryData )
	
	//console.log( "deliveryDataObj",JSON.parse( deliveryDataObj['data'] ) )
	
	
	var collectioPath = '/'+selectedMonthYear+'/'+selectedTradingDate+'/sector_stockNames/'
	sectorStockNamesObj = await fetchSectorStockNamesCollectionData( collectioPath )
	
	await show_only_equity_Data( selectedSpurtsTimeValue, selectedTradingDate, JSON.parse( equityDataObj['data'] ), JSON.parse( spurtsDataObj['data'] ) , JSON.parse( deliveryDataObj['data'] ) )
	await show_only_Spurts_Data( selectedSpurtsTimeValue, selectedTradingDate, JSON.parse( equityDataObj['data'] ), JSON.parse( spurtsDataObj['data'] ) , JSON.parse( deliveryDataObj['data'] ) )
	*/
	addEventListnerInTables()
	 addOnclickEvent()
}

async function calculateFutOptData( selectedEquityTimeValue, selectedTradingDate, allEquityDataObj, returnedEntryWiseObj )
{
	console.log("allEquityDataObj",allEquityDataObj, selectedEquityTimeValue)
	console.log("allEquityDataObj", Object.keys(allEquityDataObj).length )
	
	//var  dataObj = JSON.parse( allDerivativesDataObj["UPL"]['data'] )
	//console.log("dataObj", dataObj )
	
	var marketDeptOrderBookObj = {}
	var securityWiseDeliveryPerObj = {}
	
	for( var symbol in allEquityDataObj ) {
	if( symbol != 'timestamp' )
	{
	
	var dataObj = JSON.parse( allEquityDataObj[symbol]['data'] )
	
	securityWiseDeliveryPerObj[symbol] = dataObj['securityWiseDP']['deliveryToTradedQuantity']
	
	if( dataObj['marketDeptOrderBook']['totalBuyQuantity'] >= dataObj['marketDeptOrderBook']['totalSellQuantity']  )
	{
		marketDeptOrderBookObj[symbol] = dataObj['marketDeptOrderBook']['totalBuyQuantity'] / dataObj['marketDeptOrderBook']['totalSellQuantity']
	}
	else if( dataObj['marketDeptOrderBook']['totalBuyQuantity'] < dataObj['marketDeptOrderBook']['totalSellQuantity']  )
	{
		marketDeptOrderBookObj[symbol] = dataObj['marketDeptOrderBook']['totalSellQuantity'] / dataObj['marketDeptOrderBook']['totalBuyQuantity']
	}
	
	}
	}
	
	
	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => b[1] - a[1] ) )   // for sorting object ascending
	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => a[1] - b[1] ) )   // for sorting object descending
	
	securityWiseDeliveryPerObj = Object.fromEntries( Object.entries(securityWiseDeliveryPerObj).sort( (a,b) => b[1] - a[1] )  ) 
	showSecurityWiseDeliveryPerStocks( selectedEquityTimeValue, selectedTradingDate, securityWiseDeliveryPerObj, allEquityDataObj, returnedEntryWiseObj )
	
	marketDeptOrderBookObj = Object.fromEntries( Object.entries(marketDeptOrderBookObj).sort( (a,b) => b[1] - a[1] )  ) 
	showMarketDepthOrderBook( selectedEquityTimeValue, selectedTradingDate, marketDeptOrderBookObj, allEquityDataObj, returnedEntryWiseObj )
	
	/*
	futuresOIPerChngObj = Object.fromEntries( Object.entries(futuresOIPerChngObj).sort( (a,b) => b[1] - a[1] ) ) 
	
	optionsPricePerChngObj = Object.fromEntries( Object.entries(optionsPricePerChngObj).sort( (a,b) => b[1] - a[1] ) ) 
	futuresPricePerChngObj = Object.fromEntries( Object.entries(futuresPricePerChngObj).sort( (a,b) => b[1] - a[1] ) ) 
	
	optionsTurnoverObj = Object.fromEntries( Object.entries(optionsTurnoverObj).sort( (a,b) => b[1] - a[1] )  ) 
	futuresTurnoverObj = Object.fromEntries( Object.entries(futuresTurnoverObj).sort( (a,b) => b[1] - a[1] )  ) 
	
	allOptionsTurnoverObj = Object.fromEntries( Object.entries(allOptionsTurnoverObj).sort( (a,b) => b[1] - a[1] )  ) 
	allFuturesTurnoverObj = Object.fromEntries( Object.entries(allFuturesTurnoverObj).sort( (a,b) => b[1] - a[1] )  ) 
	
	showOptOIGainersLosersStocks( selectedSpurtsTimeValue, selectedTradingDate, optionsOIPerChngObj )
	showOptPricePerChngStocks( selectedSpurtsTimeValue, selectedTradingDate, optionsPricePerChngObj )
	
	showFutOIGainersLosersStocks( selectedSpurtsTimeValue, selectedTradingDate, futuresOIPerChngObj )
	showFutPricePerChngStocks( selectedSpurtsTimeValue, selectedTradingDate, futuresPricePerChngObj )
	
	showOptMostActiveStocks( selectedSpurtsTimeValue, selectedTradingDate, optionsTurnoverObj )
	showFutMostActiveStocks( selectedSpurtsTimeValue, selectedTradingDate, futuresTurnoverObj )
	

	showMostActiveOptStocks( selectedSpurtsTimeValue, selectedTradingDate, allOptionsTurnoverObj )
	showMostActiveFutStocks( selectedSpurtsTimeValue, selectedTradingDate, allFuturesTurnoverObj )
	
	//console.log( optionsOIPerChngObj, futuresOIPerChngObj 	)
	//console.log( optionsPricePerChngObj, futuresPricePerChngObj 	)
	//console.log( optionsTurnoverObj, futuresTurnoverObj 	)
	*/
	
	// await addEventListnerInTables()
}	//	show_spurts_in_oi_underlyings_Data() Function ENDS HERE


async function showMarketDepthOrderBook( selectedTimeValue, selectedTradingDate, passedDataObj, allEquityDataObj, returnedEntryWiseObj )
{
	
	 document.getElementById('marketDepthOrderBookTableContainer').innerHTML = "";
	 //document.getElementById('optPriceLosersTableContainer').innerHTML = "";

	var onlySpurtsSelectedTime = selectedTimeValue

	var timestamp = allEquityDataObj['timestamp']['data'].split(' ')[1]
	
	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => b[1] - a[1] ) )   // for sorting object ascending
	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => a[1] - b[1] ) )   // for sorting object descending
	var theadStr = '<thead class="tableRowClass">   <tr>      '
	+'<th>Symbol</th>'
	+' <th>cBuy</th>'
	+' <th>cSell</th>'
	+'<th>Ratio</th>'
	+' <th>Agrsv</th>'
	+' <th>Buy</th>'
	+' <th>Sell</th>'
	+' <th>Buy%</th>'
	+' <th>Sell%</th>'
	
	//+'<th>Ratio%</th>   '
	+' </tr></thead><tbody>'
	var optMostActiveTablesStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="marketDepthOrderBookTableStr"><caption style="caption-side:top"> Market Depth Orders | '+selectedTradingDate+' | '+timestamp+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	//var optOILosersTablesStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="optPriceLosersTablesStr"><caption style="caption-side:top">Options Price Losers | '+selectedTradingDate+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	 
	
	function returnDataStr( symbol, objectValue, dataObj )
	{
	
		
		var timeStampPrevious1 = Object.keys( returnedEntryWiseObj )[1]
		var allEquityDataObjPrevious1
		if(timeStampPrevious1!=undefined )
		{
			allEquityDataObjPrevious1 = returnedEntryWiseObj[timeStampPrevious1]
		}
		var dataObjPrevious1
		var changeInBuyQty = 0
		var changeInSellQty = 0
		if( allEquityDataObjPrevious1!=undefined )
		{
			dataObjPrevious1 = JSON.parse( allEquityDataObjPrevious1[symbol]['data'] )
			changeInBuyQty = ((dataObj['marketDeptOrderBook']['totalBuyQuantity']  - dataObjPrevious1['marketDeptOrderBook']['totalBuyQuantity'])/dataObjPrevious1['marketDeptOrderBook']['totalBuyQuantity'] )*100
			changeInSellQty = ((dataObj['marketDeptOrderBook']['totalSellQuantity']  - dataObjPrevious1['marketDeptOrderBook']['totalSellQuantity'])/dataObjPrevious1['marketDeptOrderBook']['totalSellQuantity'] )*100
		
		}
		
	
		
		
	
		var whoIsMoreAggressive = ''
		var ratioPercentage = 0
		if( dataObj['marketDeptOrderBook']['totalBuyQuantity'] >= dataObj['marketDeptOrderBook']['totalSellQuantity'] )
		{
			//var percentage = (dataObj['marketDeptOrderBook']['totalBuyQuantity']-dataObj['marketDeptOrderBook']['totalSellQuantity']) / (dataObj['marketDeptOrderBook']['totalBuyQuantity']+dataObj['marketDeptOrderBook']['totalSellQuantity'])
			whoIsMoreAggressive = 'Buy' 
			ratioPercentage = ((dataObj['marketDeptOrderBook']['totalBuyQuantity']  - dataObj['marketDeptOrderBook']['totalSellQuantity'])/dataObj['marketDeptOrderBook']['totalSellQuantity'] )*100
		}
		else if( dataObj['marketDeptOrderBook']['totalBuyQuantity'] < dataObj['marketDeptOrderBook']['totalSellQuantity'] )
		{
			whoIsMoreAggressive = 'Sell'
			ratioPercentage = ((dataObj['marketDeptOrderBook']['totalSellQuantity']  - dataObj['marketDeptOrderBook']['totalBuyQuantity'])/dataObj['marketDeptOrderBook']['totalBuyQuantity'] )*100
		}

		var tablesStr = '<tr class="item"><td>'
		+ symbol
		+'</td><td>'
		+changeInBuyQty.toFixed(2)
		+'</td><td>'
		+changeInSellQty.toFixed(2)
		+'</td><td>'
		+ objectValue.toFixed(2)
		+'</td><td>'
		+ whoIsMoreAggressive 
		+'</td><td>'
		+ dataObj['marketDeptOrderBook']['totalBuyQuantity'] 
		+'</td><td>'
		+ dataObj['marketDeptOrderBook']['totalSellQuantity']
		+'</td><td>'
		//+ dataObj['marketDeptOrderBook']['totalBuyQuantity'] + ' (' +(dataObj['marketDeptOrderBook']['totalBuyQuantity'] / (dataObj['marketDeptOrderBook']['totalBuyQuantity'] + dataObj['marketDeptOrderBook']['totalSellQuantity'] ) *100 ).toFixed(2) + ')' 
		+ (dataObj['marketDeptOrderBook']['totalBuyQuantity'] / (dataObj['marketDeptOrderBook']['totalBuyQuantity'] + dataObj['marketDeptOrderBook']['totalSellQuantity'] ) *100 ).toFixed(2) 
		+'</td><td>'
		//+ dataObj['marketDeptOrderBook']['totalSellQuantity'] + ' (' +(dataObj['marketDeptOrderBook']['totalSellQuantity'] / (dataObj['marketDeptOrderBook']['totalBuyQuantity'] + dataObj['marketDeptOrderBook']['totalSellQuantity'] ) *100 ).toFixed(2) + ')' 
		+ (dataObj['marketDeptOrderBook']['totalSellQuantity'] / (dataObj['marketDeptOrderBook']['totalBuyQuantity'] + dataObj['marketDeptOrderBook']['totalSellQuantity'] ) *100 ).toFixed(2)
		//+'</td><td>'
		//+ ratioPercentage.toFixed(2)
		+'</td></tr>'
		
		return tablesStr;
	}

	for( var i=0; i< Object.keys( passedDataObj ).length ; i++ ) {
	//for( var i=0; i< 50 ; i++ ) {
	//var symbol = symbolStr.split('_')[0]
	var symbol = Object.keys( passedDataObj )[i]
	var objectValue = passedDataObj [symbol]
	{

		var dataObj = JSON.parse( allEquityDataObj[symbol]['data'] )
	
		optMostActiveTablesStr +=	returnDataStr( symbol, objectValue, dataObj )

	}
	}
	
	optMostActiveTablesStr +=' </tbody> </table>    </div>  </div>'
	//optOILosersTablesStr +=' </tbody> </table>    </div>  </div>'


	
	 document.getElementById('marketDepthOrderBookTableContainer').innerHTML = optMostActiveTablesStr;
	 //document.getElementById('optPriceLosersTableContainer').innerHTML = optOILosersTablesStr;

	// await addEventListnerInTables()
}	//	show_spurts_in_oi_underlyings_Data() Function ENDS HERE

async function showSecurityWiseDeliveryPerStocks( selectedSpurtsTimeValue, selectedTradingDate, passedDataObj, allEquityDataObj )
{
	
	 document.getElementById('liveSecurityWiseDeliveryTableContainer').innerHTML = "";
	 //document.getElementById('optPriceLosersTableContainer').innerHTML = "";

	var onlySpurtsSelectedTime = selectedSpurtsTimeValue
	//console.log( allEquityDataObj[ Object.keys(allEquityDataObj)[0] ] )
	var timestamp = JSON.parse(allEquityDataObj[ Object.keys(allEquityDataObj)[0] ]['data'] ) ['securityWiseDP']['secWiseDelPosDate']

	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => b[1] - a[1] ) )   // for sorting object ascending
	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => a[1] - b[1] ) )   // for sorting object descending
	var theadStr = '<thead class="tableRowClass">   <tr>      '
	+'<th>Symbol</th>'
	+' <th>QtyTrd</th>'
	+' <th>DeliQty</th>'
	+'<th>Delivery%</th>   '
	+' </tr></thead><tbody>'
	var optMostActiveTablesStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="liveSecurityWiseDeliveryTableStr"><caption style="caption-side:top"> Live Delivery | '+selectedTradingDate+' | '+timestamp+'</caption>'+theadStr 
	//var optOILosersTablesStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="optPriceLosersTablesStr"><caption style="caption-side:top">Options Price Losers | '+selectedTradingDate+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	
	function returnDataStr( symbol,  dataObj )
	{

		var tablesStr = '<tr class="item"><td>'
		+ symbol
		+'</td><td>'
		+ dataObj['securityWiseDP']['quantityTraded']
		+'</td><td>'
		+ dataObj['securityWiseDP']['deliveryQuantity']
		+'</td><td>'
		+ dataObj['securityWiseDP']['deliveryToTradedQuantity']
		+'</td></tr>'
		
		return tablesStr;
	}

	for( var i=0; i< Object.keys( passedDataObj ).length ; i++ ) {
	//for( var i=0; i< 50 ; i++ ) {
	//var symbol = symbolStr.split('_')[0]
	var symbol = Object.keys( passedDataObj )[i]
	{

		var dataObj = JSON.parse( allEquityDataObj[symbol]['data'] )
		optMostActiveTablesStr +=	returnDataStr( symbol,  dataObj )

	}
	}
	
	optMostActiveTablesStr +=' </tbody> </table>    </div>  </div>'
	//optOILosersTablesStr +=' </tbody> </table>    </div>  </div>'


	
	 document.getElementById('liveSecurityWiseDeliveryTableContainer').innerHTML = optMostActiveTablesStr;
	 //document.getElementById('optPriceLosersTableContainer').innerHTML = optOILosersTablesStr;

	// await addEventListnerInTables()
}	//	show_spurts_in_oi_underlyings_Data() Function ENDS HERE

function set_breakout_timevalues()
{

  const selector = document.getElementById("breakoutTimeSelector");
  const selector2 = document.getElementById("breakoutTimeTillSelector");
if( document.getElementById("breakoutTimeSelector").options.length<=1 )
{
  let hour = 9;
  let minute = 20;

  while (hour < 15 || (hour === 15 && minute <= 30)) {
    const hh = hour.toString().padStart(2, '0');
    const mm = minute.toString().padStart(2, '0');
    const timeStr = `${hh}:${mm}:00`;

    const option = document.createElement("option");
    option.value = timeStr;
    option.textContent = timeStr;
    selector.appendChild(option);

    const option2 = document.createElement("option");
    option2.value = timeStr;
    option2.textContent = timeStr;
    selector2.appendChild(option2);

    minute += 5;
    if (minute >= 60) {
      minute = 0;
      hour += 1;
    }
  }
  }

}

async function showLiveScannerAllStocksDataInTable()
{
	//set_breakout_timevalues()
	 var breakoutTimeSelectorValue = document.getElementById("breakoutTimeSelector").value
	 var breakoutTimeTillSelectorValue = document.getElementById("breakoutTimeTillSelector").value

	 document.getElementById('perticularEquityTableContainer').innerHTML = "";
	 /*
	 var selectedDeliveryStockSymbol = document.getElementById("deliveryStockSymbol").value
	var selectedMonthYear = document.getElementById('monthYear').value
	var selectedTradingDate = document.getElementById('tradingDate').value
	var selectedAvgDays = Number( document.getElementById("avgDays").value )
	var selectedPreviousTradingDays = Number( document.getElementById("previousTradingDays").value )

*/
	var selectedYear = document.getElementById('year').value
	var selectedMonthYear = document.getElementById('monthYear').value
	var selectedTradingDate = document.getElementById('tradingDate').value
	//var selectedEquitySymbol = document.getElementById('derivativesSymbols').value
	var selectedTimeValue = document.getElementById('commonTimeValues').value
	
	var selectedEquityTimeRef = document.getElementById('equityTimeValues')
	var selectedEquityTimeValue = selectedEquityTimeRef.value


	//var docPath = '/'+selectedYear+'/'+selectedMonthYear+'/'+selectedTradingDate+'/'+selectedTimeValue+'/'+selectedTimeValue
	var docPath = '/'+selectedYear+'/'+selectedMonthYear+'/'+selectedTradingDate+'/'+'all_equity'+'/'+selectedTimeValue
	//var allDerivativesDataArray = await fetchDerivativesCollectionData( docPathForSpurts )
	//console.log( "docPath", docPath )
	//var candleWiseDataObj = await fetchAndSaveDataIDB( docPath );
	var candleWiseDataObj = await fetchAndSaveDataIDB( docPath );
	console.log("candleWiseDataObj", candleWiseDataObj)
	candleWiseDataObj = Object.fromEntries(Object.entries(candleWiseDataObj).sort((a, b) => a[0].localeCompare(b[0])));  // for sorting object ascending by keys
	//console.log("candleWiseDataObj", candleWiseDataObj)
	
	//const sortedAsc = Object.fromEntries(Object.entries(candleWiseDataObj).sort((a, b) => a[0].localeCompare(b[0])));
	//const sortedDesc = Object.fromEntries(Object.entries(candleWiseDataObj).sort((a, b) => b[0].localeCompare(a[0])));

	//console.log(allEquityDataObj )
	
	
	
	
	
	document.getElementById('perticularEquityTableContainer').innerHTML = "";
	 //document.getElementById('optPriceLosersTableContainer').innerHTML = "";

	var onlySpurtsSelectedTime = selectedTimeValue

	var timestamp = selectedTimeValue
	
	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => b[1] - a[1] ) )   // for sorting object ascending
	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => a[1] - b[1] ) )   // for sorting object descending
	var theadStr = '<thead class="tableRowClass">   <tr>      '
	+'<th>Symbol</th>'
	 
	+' <th>Inside_Cndl</th>'
	+' <th>Trend_5m</th>'
	+' <th>Rng%_5m</th>'
	+' <th>BodyRng%</th>'
	+' <th>Rng*Cndl</th>'
	+' <th>Swings</th>'
	+' <th>Swings_Score</th>'
	
	
	+' <th>c%</th>'
	+' <th>Score_1m</th>'
	+' <th>Candles</th>'
	//+' <th>bodyWick_1m</th>'
	+' <th>bodyPer</th>'
	+' <th>bullish</th>'
	+' <th>bearish</th>'
	//+' <th>retracement</th>'
	//+' <th>pullback</th>'
	
	+' <th>bullish%</th>'
	+' <th>bearish%</th>'

	+' <th>Score_5m</th>'
	+' <th>Candles</th>'
	//+' <th>bodyWick_5m</th>'
	+' <th>bodyPer</th>'
	+' <th>bullish</th>'
	+' <th>bearish</th>'
	//+' <th>retracement</th>'
	//+' <th>pullback</th>'
	
	+' <th>bullish%</th>'
	+' <th>bearish%</th>'

	
	+'<th>Ratio</th>'
	+' <th>Agrsv</th>'
	+' <th>Near HVP</th>'
	+' <th>Near POC</th>'
	+' <th>HVP</th>'
	+' <th>POC</th>'
	+' <th>LTP</th>'
	+' <th>TimeHVP</th>'
	+' <th>HVP Near High</th>'
	+' <th>HVP Near Low</th>'
	
	
	+' <th>BuyChng</th>'
	+' <th>SellChng</th>'
	+' <th>C%_1m</th>'
	
	
	//+'<th>Ratio%</th>   '
	+' </tr></thead><tbody>'
	var optMostActiveTablesStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="marketDepthOrderBookTableStr"><caption style="caption-side:top"> Market Depth Orders | '+selectedTradingDate+' | '+timestamp+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	//var optOILosersTablesStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="optPriceLosersTablesStr"><caption style="caption-side:top">Options Price Losers | '+selectedTradingDate+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	 
	
	function returnDataStr( symbol, dataObj )
	{
	
		
	
	 
	 var LastPrice = dataObj['LTP']
	 var POC_Price = dataObj['POC'][0].split('-')[0]
	 var HighestVolBar_priceRange = Number( dataObj['HighestVolBar'][0][1]['HighestVolBar']['priceRange'].split('-')[0] )
	 var HighestVolBar_priceRange_total_ask = dataObj['HighestVolBar'][0][1]['total_ask']
	 var HighestVolBar_priceRange_total_bid = dataObj['HighestVolBar'][0][1]['total_bid']
	 var HighestVolBar_time =  dataObj['HighestVolBar'][0][0]
	var LTP_near_HighestVolBar_priceRange =  Math.abs(LastPrice - HighestVolBar_priceRange) / HighestVolBar_priceRange *100
	var LTP_near_POC =  Math.abs(LastPrice - POC_Price) / POC_Price *100
	
	var day_high = dataObj['day_high']
	var day_low = dataObj['day_low']
	var HighestVolBar_candle_high = Number( dataObj['HighestVolBar'][0][1]['currentCandle'][2] )
	var HighestVolBar_candle_low = Number( dataObj['HighestVolBar'][0][1]['currentCandle'][3] )
	var HighestVolBar_near_day_high =  Math.abs(day_high - HighestVolBar_candle_high) / HighestVolBar_candle_high *100
	var HighestVolBar_near_day_low =  Math.abs(day_low - HighestVolBar_candle_low) / HighestVolBar_candle_low *100
	
	var pChange_total_1m = 0
	if( dataObj['pChange_total_1m'] !=undefined )
		pChange_total_1m = dataObj['pChange_total_1m'].toFixed(2)
	
	
	
	
	/*
	 var DayHigh = symbolArray['dayHigh'] 
	 var DayLow = symbolArray['dayLow']
	  var DayRange =( ( (DayHigh - DayLow) / DayLow) *100).toFixed(2)
	  
    var near_high_pct = (1 - (DayHigh - LastPrice) / (DayHigh - DayLow)) * 100 
    var near_low_pct = (1 - (LastPrice - DayLow) / (DayHigh - DayLow)) * 100
	  */
		var whoIsMoreAggressive = ''
		var ratioPercentage = 0
		if( dataObj['total_ask'] >= dataObj['total_bid'] )
		{
			//var percentage = (dataObj['marketDeptOrderBook']['totalBuyQuantity']-dataObj['marketDeptOrderBook']['totalSellQuantity']) / (dataObj['marketDeptOrderBook']['totalBuyQuantity']+dataObj['marketDeptOrderBook']['totalSellQuantity'])
			whoIsMoreAggressive = 'Buy' 
			//ratioPercentage = ((dataObj['total_ask']  - dataObj['total_bid'])/dataObj['total_bid'] )*100
			ratioPercentage = dataObj['total_ask'] / dataObj['total_bid']
		}
		else if( dataObj['total_ask'] < dataObj['total_bid'] )
		{
			whoIsMoreAggressive = 'Sell'
			ratioPercentage = dataObj['total_bid'] / dataObj['total_ask']
		}
		
		var percentageChange = ( ( ( dataObj['LTP'] - dataObj['day_open'] ) / dataObj['day_open'] ) * 100 )

		var tablesStr = '<tr class="item"><td>'
		+ symbol
	
		
		if( dataObj['market_structure_1m'] != undefined )
		{
		//var last_swing_obj_5m = dataObj['market_structure_1m'][ dataObj['market_structure_1m'].length-1 ]
		var last_swing_obj_5m =   dataObj['market_structure_5m'] && dataObj['market_structure_5m'].length > 0    ? dataObj['market_structure_5m'][dataObj['market_structure_5m'].length - 1]    : {}; // or provide a default object like { time: null, type: null }
		//var last_swing_obj_5m =   dataObj['market_structure_5m'] && dataObj['market_structure_5m'].length > 1    ? dataObj['market_structure_5m'][dataObj['market_structure_5m'].length - 2]    : {}; // or provide a default object like { time: null, type: null }

		
		tablesStr += 
		'</td><td>'
		//+ last_swing_obj_5m['inside_candles']
		+ ( last_swing_obj_5m['inside_candles']  ? last_swing_obj_5m['inside_candles']  : 0 )
		
		+'</td><td>'
		//+ last_swing_obj_5m['trend']
		+ ( last_swing_obj_5m['trend']  ? last_swing_obj_5m['trend']  : 'Null' )
		
		+'</td><td>'
		+ ( last_swing_obj_5m['swing_high']  ? ( (last_swing_obj_5m['swing_high'] - last_swing_obj_5m['swing_low'])/last_swing_obj_5m['swing_low']*100 ).toFixed(2) : 'Null' )
		
		+'</td><td>'
		+ ( last_swing_obj_5m['swing_high']  ? Math.abs( (last_swing_obj_5m['swing_close'] - last_swing_obj_5m['swing_open'])/last_swing_obj_5m['swing_open']*100 ).toFixed(2) : 'Null' )
		
		+'</td><td>'
		//+ ( last_swing_obj_5m['swing_high']  ? ( (100-( (last_swing_obj_5m['swing_high'] - last_swing_obj_5m['swing_low'])/last_swing_obj_5m['swing_low']*100 )) * last_swing_obj_5m['inside_candles'] ) .toFixed(2) : 'Null' )
		+ ( last_swing_obj_5m['swing_high']  ? ( (100-( Math.abs( (last_swing_obj_5m['swing_close'] - last_swing_obj_5m['swing_open'])/last_swing_obj_5m['swing_open']*100 )  )) * last_swing_obj_5m['inside_candles'] ) .toFixed(2) : 'Null' )
		
		+'</td><td>'
		+ ( dataObj['market_structure_5m'] ? dataObj['market_structure_5m'].length  : 0  )
		//+ ( dataObj['market_structure_5m'] ? Math.abs( percentageChange * dataObj['market_structure_5m'].length ).toFixed(2)  : 0  )
		
		+'</td><td>'
		+ ( dataObj['market_structure_5m'] ? ( 	Math.abs( percentageChange  * dataObj['market_structure_1m'].length ).toFixed(2)		)  : 0  )

		//+'</td><td>'
		}

		if( dataObj['score_result_1m'] != undefined )
		{
		tablesStr += 
		'</td><td>'
		//+ dataObj['score_result_1m']['score']
		+ percentageChange.toFixed(2)
		 
		+'</td><td>'
		//+ dataObj['score_result_1m']['score']
		//+ ( dataObj['score_result_1m']['num_consec'] * dataObj['score_result_1m']['body_per'] ).toFixed(2)
		//+ Math.abs( percentageChange * dataObj['score_result_1m']['num_consec'] * dataObj['score_result_1m']['body_per']  ).toFixed(2)
		+ Math.abs( percentageChange * dataObj['score_result_1m']['num_consec'] ).toFixed(2)
		
		+'</td><td>'
		+ dataObj['score_result_1m']['num_consec']
		
		//+'</td><td>'
		//+ dataObj['score_result_1m']['body_wick']
		
		+'</td><td>'
		+ dataObj['score_result_1m']['body_per']
		
		+'</td><td>'
		//+ dataObj['score_result_1m']['analyzed_candles']['max_consecutive_bullish']
		+ dataObj['score_result_1m']['analyzed_candles']['max_valid_consecutive_bullish']
		+'</td><td>'
		+ dataObj['score_result_1m']['analyzed_candles']['max_valid_consecutive_bearish']
		
		+'</td><td>'
		//+ dataObj['score_result_1m']['retracement']
		+Math.abs( percentageChange * dataObj['score_result_1m']['analyzed_candles']['max_valid_consecutive_bullish'] ).toFixed(2)
		
		+'</td><td>'
		//+ dataObj['score_result_1m']['pullback_depth']
		+Math.abs( percentageChange * dataObj['score_result_1m']['analyzed_candles']['max_valid_consecutive_bearish'] ).toFixed(2)
		
		
		
		+'</td><td>'
		//+ dataObj['score_result_5m']['score']
		//+ ( dataObj['score_result_5m']['num_consec'] * dataObj['score_result_5m']['body_per'] ).toFixed(2)
		//+Math.abs( percentageChange  * dataObj['score_result_5m']['num_consec'] * dataObj['score_result_5m']['body_per']   ).toFixed(2)
		+Math.abs( percentageChange  * dataObj['score_result_5m']['num_consec'] ).toFixed(2)
		
		
		+'</td><td>'
		+ dataObj['score_result_5m']['num_consec']
		
		//+'</td><td>'
		//+ dataObj['score_result_5m']['body_wick']
		
		+'</td><td>'
		+ dataObj['score_result_5m']['body_per']
		
		+'</td><td>'
		+ dataObj['score_result_5m']['analyzed_candles']['max_valid_consecutive_bullish']
		+'</td><td>'
		+ dataObj['score_result_5m']['analyzed_candles']['max_valid_consecutive_bearish']
		
		
		+'</td><td>'
		//+ dataObj['score_result_5m']['retracement']
		+Math.abs( percentageChange * dataObj['score_result_5m']['analyzed_candles']['max_valid_consecutive_bullish'] ).toFixed(2)
		
		+'</td><td>'
		//+ dataObj['score_result_5m']['pullback_depth']
		+Math.abs( percentageChange  * dataObj['score_result_5m']['analyzed_candles']['max_valid_consecutive_bearish'] ).toFixed(2)
		
		
		+'</td><td>'
		}

	
		tablesStr += 
		//+'</td><td>'
		+ratioPercentage.toFixed(2)
		+'</td><td>'
		+ whoIsMoreAggressive 
		+'</td><td>'
		+ LTP_near_HighestVolBar_priceRange.toFixed(3)
		+'</td><td>'
		+ LTP_near_POC.toFixed(3)
		+'</td><td>'
		+ HighestVolBar_priceRange
		+'</td><td>'
		+ POC_Price
		+'</td><td>'
		+ LastPrice
		+'</td><td>'
		+ HighestVolBar_time
		+'</td><td>'
		+ HighestVolBar_near_day_high.toFixed(3)
		+'</td><td>'
		+ HighestVolBar_near_day_low.toFixed(3)
		+'</td><td>'
		+ ( dataObj['total_ask'] - HighestVolBar_priceRange_total_ask )
		+'</td><td>'
		+ ( dataObj['total_bid'] - HighestVolBar_priceRange_total_bid )
		
		+'</td><td>'
		+ ( pChange_total_1m )
		
				
		/*
		+'</td><td>'
		+ dataObj['marketDeptOrderBook']['totalBuyQuantity'] 
		+'</td><td>'
		+ dataObj['marketDeptOrderBook']['totalSellQuantity']
		+'</td><td>'
		//+ dataObj['marketDeptOrderBook']['totalBuyQuantity'] + ' (' +(dataObj['marketDeptOrderBook']['totalBuyQuantity'] / (dataObj['marketDeptOrderBook']['totalBuyQuantity'] + dataObj['marketDeptOrderBook']['totalSellQuantity'] ) *100 ).toFixed(2) + ')' 
		+ (dataObj['marketDeptOrderBook']['totalBuyQuantity'] / (dataObj['marketDeptOrderBook']['totalBuyQuantity'] + dataObj['marketDeptOrderBook']['totalSellQuantity'] ) *100 ).toFixed(2) 
		+'</td><td>'
		//+ dataObj['marketDeptOrderBook']['totalSellQuantity'] + ' (' +(dataObj['marketDeptOrderBook']['totalSellQuantity'] / (dataObj['marketDeptOrderBook']['totalBuyQuantity'] + dataObj['marketDeptOrderBook']['totalSellQuantity'] ) *100 ).toFixed(2) + ')' 
		+ (dataObj['marketDeptOrderBook']['totalSellQuantity'] / (dataObj['marketDeptOrderBook']['totalBuyQuantity'] + dataObj['marketDeptOrderBook']['totalSellQuantity'] ) *100 ).toFixed(2)
		//+'</td><td>'
		*/
		//+ ratioPercentage.toFixed(2)
		+'</td></tr>'
		
		return tablesStr;
	}

	for( var i=0; i< Object.keys( candleWiseDataObj ).length ; i++ ) {
	//for( var i=0; i< 50 ; i++ ) {
	//var symbol = symbolStr.split('_')[0]
	var symbol = Object.keys( candleWiseDataObj )[i]
	if(false)
	{

		var dataObj = candleWiseDataObj [symbol]
	
		optMostActiveTablesStr +=	returnDataStr( symbol, dataObj )

	}
	}
	
	optMostActiveTablesStr +=' </tbody> </table>    </div>  </div>'
	//optOILosersTablesStr +=' </tbody> </table>    </div>  </div>'


	
	 document.getElementById('perticularEquityTableContainer').innerHTML = optMostActiveTablesStr;
	 //document.getElementById('optPriceLosersTableContainer').innerHTML = optOILosersTablesStr;

	
	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => b[1] - a[1] ) )   // for sorting object ascending
	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => a[1] - b[1] ) )   // for sorting object descending
	var theadStr = '<thead class="tableRowClass">   <tr>      '
	+'<th>Symbol</th>'
	 +' <th>Sgnl%</th>'
	+' <th>Inside_Cndl</th>'
	+' <th>Trend_5m</th>'
	+' <th>Rng%_5m</th>'
	+' <th>Rng*Cndl</th>'
	+' <th>Swings</th>'
	+' <th>StartT</th>'
	+' <th>BreakoutT</th>'
	+' <th>BreakoutStngh</th>'
	
	
	+' <th>c%</th>'
	
	/*
	+' <th>Score_1m</th>'
	+' <th>Candles</th>'
	//+' <th>bodyWick_1m</th>'
	+' <th>bodyPer</th>'
	+' <th>bullish</th>'
	+' <th>bearish</th>'
	//+' <th>retracement</th>'
	//+' <th>pullback</th>'
	
	+' <th>bullish%</th>'
	+' <th>bearish%</th>'

	+' <th>Score_5m</th>'
	+' <th>Candles</th>'
	//+' <th>bodyWick_5m</th>'
	+' <th>bodyPer</th>'
	+' <th>bullish</th>'
	+' <th>bearish</th>'
	//+' <th>retracement</th>'
	//+' <th>pullback</th>'
	
	+' <th>bullish%</th>'
	+' <th>bearish%</th>'

	
	+'<th>Ratio</th>'
	+' <th>Agrsv</th>'
	+' <th>Near HVP</th>'
	+' <th>Near POC</th>'
	+' <th>HVP</th>'
	+' <th>POC</th>'
	+' <th>LTP</th>'
	+' <th>TimeHVP</th>'
	+' <th>HVP Near High</th>'
	+' <th>HVP Near Low</th>'
	
	
	+' <th>BuyChng</th>'
	+' <th>SellChng</th>'
	+' <th>C%_1m</th>'
	*/
	
	//+'<th>Ratio%</th>   '
	+' </tr></thead><tbody>'
	var optMostActiveTablesStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="breakoutStocksTableStr"><caption style="caption-side:top"> Last Breakout Stocks| '+selectedTradingDate+' | '+timestamp+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	//var optOILosersTablesStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="optPriceLosersTablesStr"><caption style="caption-side:top">Options Price Losers | '+selectedTradingDate+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	 
	
	function returnDataStr2( symbol, dataObj )
	{
	
		
	
	 
	 var LastPrice = dataObj['LTP']

	var day_high = dataObj['day_high']
	var day_low = dataObj['day_low']

	var pChange_total_1m = 0


		var percentageChange = ( ( ( dataObj['LTP'] - dataObj['day_open'] ) / dataObj['day_open'] ) * 100 )

		var tablesStr = ''
		//var tablesStr = '<tr class="item"><td>'
		//+ symbol
	
		
		if( dataObj['market_structure_5m'] && dataObj['market_structure_5m'].length > 1 )
		{
		//var last_swing_obj_5m = dataObj['market_structure_1m'][ dataObj['market_structure_1m'].length-1 ]
		//var last_swing_obj_5m =   dataObj['market_structure_5m'] && dataObj['market_structure_5m'].length > 0    ? dataObj['market_structure_5m'][dataObj['market_structure_5m'].length - 1]    : {}; // or provide a default object like { time: null, type: null }
		var last_swing_obj_5m =   dataObj['market_structure_5m'] && dataObj['market_structure_5m'].length > 1  ? dataObj['market_structure_5m'][dataObj['market_structure_5m'].length - 2]    : {}; // or provide a default object like { time: null, type: null }
		
		//console.log( symbol, last_swing_obj_5m )

		
		var breakoutTime = last_swing_obj_5m ['day_close_candle'][0]
		//console.log( symbol, last_swing_obj_5m )
		//if( breakoutTime==breakoutTimeSelectorValue || breakoutTimeSelectorValue== 'ALL')
		if( (breakoutTime >=breakoutTimeSelectorValue && breakoutTime <=breakoutTimeTillSelectorValue) || breakoutTimeSelectorValue== 'ALL')
		{
		tablesStr += '<tr class="item"><td>'
		+ symbol
		+'</td><td>'
		
		+ ( ( ( dataObj['LTP'] -  last_swing_obj_5m ['day_close_candle'][4] ) / last_swing_obj_5m ['day_close_candle'][4] ) * 100 ).toFixed(2)
		 +'</td><td>'
		 
		//+ last_swing_obj_5m['inside_candles']
		+ ( last_swing_obj_5m['inside_candles']  ? last_swing_obj_5m['inside_candles']  : 0 )
		
		+'</td><td>'
		//+ last_swing_obj_5m['trend']
		+ ( last_swing_obj_5m['trend']  ? last_swing_obj_5m['trend']  : 'Null' )
		
		+'</td><td>'
		+ ( last_swing_obj_5m['swing_high']  ? ( (last_swing_obj_5m['swing_high'] - last_swing_obj_5m['swing_low'])/last_swing_obj_5m['swing_low']*100 ).toFixed(2) : 'Null' )
		+'</td><td>'
		+ ( last_swing_obj_5m['swing_high']  ? ( (100-( (last_swing_obj_5m['swing_high'] - last_swing_obj_5m['swing_low'])/last_swing_obj_5m['swing_low']*100 )) * last_swing_obj_5m['inside_candles'] ) .toFixed(2) : 'Null' )
		
		
		+'</td><td>'
		+ ( dataObj['market_structure_5m'] ? dataObj['market_structure_5m'].length  : 0  )
		 
		+'</td><td>'
		+ ( last_swing_obj_5m['start_candle'] ? last_swing_obj_5m ['start_candle'][0]  : ''  )
	
		+'</td><td>'
		+ ( last_swing_obj_5m['day_close_candle'] ? last_swing_obj_5m ['day_close_candle'][0]  : ''  )
	
		+'</td><td>'
		+ ( last_swing_obj_5m['day_close_candle'] ?( (  Math.abs(last_swing_obj_5m ['day_close_candle'][4] - last_swing_obj_5m ['day_close_candle'][1]) / (last_swing_obj_5m ['day_close_candle'][2] - last_swing_obj_5m ['day_close_candle'][3]))*100 ) .toFixed(2)    : ''  )
	
		+'</td><td>'
		//+ dataObj['score_result_1m']['score']
		+ percentageChange.toFixed(2)
		 
		//+'</td><td>'
		+'</td></tr>'
		}
		}

		if( false && dataObj['score_result_1m'] != undefined )
		{
		tablesStr += 
		'</td><td>'
		//+ dataObj['score_result_1m']['score']
		+ percentageChange.toFixed(2)
		 
		+'</td><td>'
		//+ dataObj['score_result_1m']['score']
		//+ ( dataObj['score_result_1m']['num_consec'] * dataObj['score_result_1m']['body_per'] ).toFixed(2)
		//+ Math.abs( percentageChange * dataObj['score_result_1m']['num_consec'] * dataObj['score_result_1m']['body_per']  ).toFixed(2)
		+ Math.abs( percentageChange * dataObj['score_result_1m']['num_consec'] ).toFixed(2)
		
		+'</td><td>'
		+ dataObj['score_result_1m']['num_consec']
		
		//+'</td><td>'
		//+ dataObj['score_result_1m']['body_wick']
		
		+'</td><td>'
		+ dataObj['score_result_1m']['body_per']
		
		+'</td><td>'
		//+ dataObj['score_result_1m']['analyzed_candles']['max_consecutive_bullish']
		+ dataObj['score_result_1m']['analyzed_candles']['max_valid_consecutive_bullish']
		+'</td><td>'
		+ dataObj['score_result_1m']['analyzed_candles']['max_valid_consecutive_bearish']
		
		+'</td><td>'
		//+ dataObj['score_result_1m']['retracement']
		+Math.abs( percentageChange * dataObj['score_result_1m']['analyzed_candles']['max_valid_consecutive_bullish'] ).toFixed(2)
		
		+'</td><td>'
		//+ dataObj['score_result_1m']['pullback_depth']
		+Math.abs( percentageChange * dataObj['score_result_1m']['analyzed_candles']['max_valid_consecutive_bearish'] ).toFixed(2)
		
		
		
		+'</td><td>'
		//+ dataObj['score_result_5m']['score']
		//+ ( dataObj['score_result_5m']['num_consec'] * dataObj['score_result_5m']['body_per'] ).toFixed(2)
		//+Math.abs( percentageChange  * dataObj['score_result_5m']['num_consec'] * dataObj['score_result_5m']['body_per']   ).toFixed(2)
		+Math.abs( percentageChange  * dataObj['score_result_5m']['num_consec'] ).toFixed(2)
		
		
		+'</td><td>'
		+ dataObj['score_result_5m']['num_consec']
		
		//+'</td><td>'
		//+ dataObj['score_result_5m']['body_wick']
		
		+'</td><td>'
		+ dataObj['score_result_5m']['body_per']
		
		+'</td><td>'
		+ dataObj['score_result_5m']['analyzed_candles']['max_valid_consecutive_bullish']
		+'</td><td>'
		+ dataObj['score_result_5m']['analyzed_candles']['max_valid_consecutive_bearish']
		
		
		+'</td><td>'
		//+ dataObj['score_result_5m']['retracement']
		+Math.abs( percentageChange * dataObj['score_result_5m']['analyzed_candles']['max_valid_consecutive_bullish'] ).toFixed(2)
		
		+'</td><td>'
		//+ dataObj['score_result_5m']['pullback_depth']
		+Math.abs( percentageChange  * dataObj['score_result_5m']['analyzed_candles']['max_valid_consecutive_bearish'] ).toFixed(2)
		
		
		+'</td><td>'
		}

			
		/*
		tablesStr += 
		//+'</td><td>'
		+ratioPercentage.toFixed(2)
		+'</td><td>'
		+ whoIsMoreAggressive 
		+'</td><td>'
		+ LTP_near_HighestVolBar_priceRange.toFixed(3)
		+'</td><td>'
		+ LTP_near_POC.toFixed(3)
		+'</td><td>'
		+ HighestVolBar_priceRange
		+'</td><td>'
		+ POC_Price
		+'</td><td>'
		+ LastPrice
		+'</td><td>'
		+ HighestVolBar_time
		+'</td><td>'
		+ HighestVolBar_near_day_high.toFixed(3)
		+'</td><td>'
		+ HighestVolBar_near_day_low.toFixed(3)
		+'</td><td>'
		+ ( dataObj['total_ask'] - HighestVolBar_priceRange_total_ask )
		+'</td><td>'
		+ ( dataObj['total_bid'] - HighestVolBar_priceRange_total_bid )
		
		+'</td><td>'
		+ ( pChange_total_1m )
		*/
		
				
		/*
		+'</td><td>'
		+ dataObj['marketDeptOrderBook']['totalBuyQuantity'] 
		+'</td><td>'
		+ dataObj['marketDeptOrderBook']['totalSellQuantity']
		+'</td><td>'
		//+ dataObj['marketDeptOrderBook']['totalBuyQuantity'] + ' (' +(dataObj['marketDeptOrderBook']['totalBuyQuantity'] / (dataObj['marketDeptOrderBook']['totalBuyQuantity'] + dataObj['marketDeptOrderBook']['totalSellQuantity'] ) *100 ).toFixed(2) + ')' 
		+ (dataObj['marketDeptOrderBook']['totalBuyQuantity'] / (dataObj['marketDeptOrderBook']['totalBuyQuantity'] + dataObj['marketDeptOrderBook']['totalSellQuantity'] ) *100 ).toFixed(2) 
		+'</td><td>'
		//+ dataObj['marketDeptOrderBook']['totalSellQuantity'] + ' (' +(dataObj['marketDeptOrderBook']['totalSellQuantity'] / (dataObj['marketDeptOrderBook']['totalBuyQuantity'] + dataObj['marketDeptOrderBook']['totalSellQuantity'] ) *100 ).toFixed(2) + ')' 
		+ (dataObj['marketDeptOrderBook']['totalSellQuantity'] / (dataObj['marketDeptOrderBook']['totalBuyQuantity'] + dataObj['marketDeptOrderBook']['totalSellQuantity'] ) *100 ).toFixed(2)
		//+'</td><td>'
		*/
		//+ ratioPercentage.toFixed(2)
		//+'</td></tr>'
		//console.log( "tablesStr", tablesStr )
		return tablesStr;
	}

	for( var i=0; i< Object.keys( candleWiseDataObj ).length ; i++ ) {
	//for( var i=0; i< 50 ; i++ ) {
	//var symbol = symbolStr.split('_')[0]
	var symbol = Object.keys( candleWiseDataObj )[i]
	
	{

		var dataObj = candleWiseDataObj [symbol]
	
		optMostActiveTablesStr +=	returnDataStr2( symbol, dataObj )

	}
	}
	
	optMostActiveTablesStr +=' </tbody> </table>    </div>  </div>'
	//optOILosersTablesStr +=' </tbody> </table>    </div>  </div>'


	
	 document.getElementById('breakoutStocksTableContainer').innerHTML = optMostActiveTablesStr;
	 //document.getElementById('optPriceLosersTableContainer').innerHTML = optOILosersTablesStr;

	
	
	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => b[1] - a[1] ) )   // for sorting object ascending
	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => a[1] - b[1] ) )   // for sorting object descending
	var theadStr = '<thead class="tableRowClass">   <tr>      '
	+'<th>Symbol</th>'
	 +' <th>Sgnl%</th>'
	+' <th>Inside_Cndl</th>'
	+' <th>Trend_5m</th>'
	+' <th>ORB_Trend</th>'
	+' <th>Rng%_5m</th>'
	+' <th>Rng*Cndl</th>'
	+' <th>Swings</th>'
	+' <th>StartT</th>'
	+' <th>BreakoutT</th>'
	+' <th>BreakoutStngh</th>'
	
	+' <th>c%</th>'
	
	/*
	+' <th>Score_1m</th>'
	+' <th>Candles</th>'
	//+' <th>bodyWick_1m</th>'
	+' <th>bodyPer</th>'
	+' <th>bullish</th>'
	+' <th>bearish</th>'
	//+' <th>retracement</th>'
	//+' <th>pullback</th>'
	
	+' <th>bullish%</th>'
	+' <th>bearish%</th>'

	+' <th>Score_5m</th>'
	+' <th>Candles</th>'
	//+' <th>bodyWick_5m</th>'
	+' <th>bodyPer</th>'
	+' <th>bullish</th>'
	+' <th>bearish</th>'
	//+' <th>retracement</th>'
	//+' <th>pullback</th>'
	
	+' <th>bullish%</th>'
	+' <th>bearish%</th>'

	
	+'<th>Ratio</th>'
	+' <th>Agrsv</th>'
	+' <th>Near HVP</th>'
	+' <th>Near POC</th>'
	+' <th>HVP</th>'
	+' <th>POC</th>'
	+' <th>LTP</th>'
	+' <th>TimeHVP</th>'
	+' <th>HVP Near High</th>'
	+' <th>HVP Near Low</th>'
	
	
	+' <th>BuyChng</th>'
	+' <th>SellChng</th>'
	+' <th>C%_1m</th>'
	*/
	
	//+'<th>Ratio%</th>   '
	+' </tr></thead><tbody>'
	var optMostActiveTablesStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="highestConsolidationBreakoutStocksTableStr"><caption style="caption-side:top"> Highest Consolidation Breakout Stocks| '+selectedTradingDate+' | '+timestamp+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	//var optOILosersTablesStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="optPriceLosersTablesStr"><caption style="caption-side:top">Options Price Losers | '+selectedTradingDate+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	 
	
	function returnDataStr3( symbol, dataObj )
	{
	
		
	
	 
	 var LastPrice = dataObj['LTP']
	 
	var day_high = dataObj['day_high']
	var day_low = dataObj['day_low']
	
	var pChange_total_1m = 0


		
		var percentageChange = ( ( ( dataObj['LTP'] - dataObj['day_open'] ) / dataObj['day_open'] ) * 100 )


		
		var tablesStr = ''
		//var tablesStr = '<tr class="item"><td>'
		//+ symbol
	
		
		if( dataObj['market_structure_5m'] && dataObj['market_structure_5m'].length > 1 )
		{
		var market_structure_selected_timeFrame_array = dataObj['market_structure_5m']
		var highestConsolidation_index = 0
		var highestConsolidation_candles = 0
		
		for( var i=0;i<=market_structure_selected_timeFrame_array.length-2;i++)
		//for( var i=0;i<=market_structure_selected_timeFrame_array.length-1;i++)
		{
			if( market_structure_selected_timeFrame_array[i]['inside_candles'] > highestConsolidation_candles )
			{
				highestConsolidation_candles = market_structure_selected_timeFrame_array[i]['inside_candles'] 
				highestConsolidation_index = i
			}
		}
		
		
		//var last_swing_obj_5m = dataObj['market_structure_1m'][ dataObj['market_structure_1m'].length-1 ]
		//var last_swing_obj_5m =   dataObj['market_structure_5m'] && dataObj['market_structure_5m'].length > 0    ? dataObj['market_structure_5m'][dataObj['market_structure_5m'].length - 1]    : {}; // or provide a default object like { time: null, type: null }
		//var last_swing_obj_5m =   dataObj['market_structure_5m'] && dataObj['market_structure_5m'].length > 1  ? dataObj['market_structure_5m'][dataObj['market_structure_5m'].length - 2]    : {}; // or provide a default object like { time: null, type: null }
		var last_swing_obj_5m =   market_structure_selected_timeFrame_array && market_structure_selected_timeFrame_array.length > 1  ? market_structure_selected_timeFrame_array[ highestConsolidation_index ]   : {}; // or provide a default object like { time: null, type: null }
		
		//console.log( symbol, last_swing_obj_5m )

		var breakoutTime = last_swing_obj_5m ['day_close_candle'][0]
		//console.log( symbol, last_swing_obj_5m )
		//if( breakoutTime==breakoutTimeSelectorValue || breakoutTimeSelectorValue== 'ALL')
		if( (breakoutTime >=breakoutTimeSelectorValue && breakoutTime <=breakoutTimeTillSelectorValue) || breakoutTimeSelectorValue== 'ALL')
		{
		tablesStr += '<tr class="item"><td>'
		+ symbol
		+'</td><td>'
		

		+ ( ( ( dataObj['LTP'] -  last_swing_obj_5m ['day_close_candle'][4] ) / last_swing_obj_5m ['day_close_candle'][4] ) * 100 ).toFixed(2)
		 +'</td><td>'
		 
		//+ last_swing_obj_5m['inside_candles']
		+ ( last_swing_obj_5m['inside_candles']  ? last_swing_obj_5m['inside_candles']  : 0 )
		
		+'</td><td>'
		//+ last_swing_obj_5m['trend']
		+ ( last_swing_obj_5m['trend']  ? last_swing_obj_5m['trend']  : 'Null' )
		
		+'</td><td>'
		//+ last_swing_obj_5m['trend']
		+ ( last_swing_obj_5m['trend'] && last_swing_obj_5m['green_candles'] >0 && last_swing_obj_5m['red_candles'] >0  ? last_swing_obj_5m['trend']  : 'Null' )
		
		+'</td><td>'
		+ ( last_swing_obj_5m['swing_high']  ? ( (last_swing_obj_5m['swing_high'] - last_swing_obj_5m['swing_low'])/last_swing_obj_5m['swing_low']*100 ).toFixed(2) : 'Null' )
		+'</td><td>'
		+ ( last_swing_obj_5m['swing_high']  ? ( (100-( (last_swing_obj_5m['swing_high'] - last_swing_obj_5m['swing_low'])/last_swing_obj_5m['swing_low']*100 )) * last_swing_obj_5m['inside_candles'] ) .toFixed(2) : 'Null' )
		
		+'</td><td>'
		+ ( dataObj['market_structure_5m'] ? dataObj['market_structure_5m'].length  : 0  )
		//+ ( dataObj['market_structure_5m'] ? Math.abs( percentageChange * dataObj['market_structure_5m'].length ).toFixed(2)  : 0  )
		
		+'</td><td>'
		+ ( last_swing_obj_5m['start_candle'] ? last_swing_obj_5m['start_candle'][0]  : ''  )
	
		+'</td><td>'
		+ ( last_swing_obj_5m['day_close_candle'] ? last_swing_obj_5m ['day_close_candle'][0]  : ''  )
		
		+'</td><td>'
		+ ( last_swing_obj_5m['day_close_candle'] ?( (  Math.abs(last_swing_obj_5m ['day_close_candle'][4] - last_swing_obj_5m ['day_close_candle'][1]) / (last_swing_obj_5m ['day_close_candle'][2] - last_swing_obj_5m ['day_close_candle'][3]))*100 ) .toFixed(2)    : ''  )
	
	
		+'</td><td>'
		//+ dataObj['score_result_1m']['score']
		+ percentageChange.toFixed(2)
		 
		 
		//+'</td><td>'
		+'</td></tr>'
		}
		
		}

		if( false && dataObj['score_result_1m'] != undefined )
		{
		tablesStr += 
		'</td><td>'
		//+ dataObj['score_result_1m']['score']
		+ percentageChange.toFixed(2)
		 
		+'</td><td>'
		//+ dataObj['score_result_1m']['score']
		//+ ( dataObj['score_result_1m']['num_consec'] * dataObj['score_result_1m']['body_per'] ).toFixed(2)
		//+ Math.abs( percentageChange * dataObj['score_result_1m']['num_consec'] * dataObj['score_result_1m']['body_per']  ).toFixed(2)
		+ Math.abs( percentageChange * dataObj['score_result_1m']['num_consec'] ).toFixed(2)
		
		+'</td><td>'
		+ dataObj['score_result_1m']['num_consec']
		
		//+'</td><td>'
		//+ dataObj['score_result_1m']['body_wick']
		
		+'</td><td>'
		+ dataObj['score_result_1m']['body_per']
		
		+'</td><td>'
		//+ dataObj['score_result_1m']['analyzed_candles']['max_consecutive_bullish']
		+ dataObj['score_result_1m']['analyzed_candles']['max_valid_consecutive_bullish']
		+'</td><td>'
		+ dataObj['score_result_1m']['analyzed_candles']['max_valid_consecutive_bearish']
		
		+'</td><td>'
		//+ dataObj['score_result_1m']['retracement']
		+Math.abs( percentageChange * dataObj['score_result_1m']['analyzed_candles']['max_valid_consecutive_bullish'] ).toFixed(2)
		
		+'</td><td>'
		//+ dataObj['score_result_1m']['pullback_depth']
		+Math.abs( percentageChange * dataObj['score_result_1m']['analyzed_candles']['max_valid_consecutive_bearish'] ).toFixed(2)
		
		
		
		+'</td><td>'
		//+ dataObj['score_result_5m']['score']
		//+ ( dataObj['score_result_5m']['num_consec'] * dataObj['score_result_5m']['body_per'] ).toFixed(2)
		//+Math.abs( percentageChange  * dataObj['score_result_5m']['num_consec'] * dataObj['score_result_5m']['body_per']   ).toFixed(2)
		+Math.abs( percentageChange  * dataObj['score_result_5m']['num_consec'] ).toFixed(2)
		
		
		+'</td><td>'
		+ dataObj['score_result_5m']['num_consec']
		
		//+'</td><td>'
		//+ dataObj['score_result_5m']['body_wick']
		
		+'</td><td>'
		+ dataObj['score_result_5m']['body_per']
		
		+'</td><td>'
		+ dataObj['score_result_5m']['analyzed_candles']['max_valid_consecutive_bullish']
		+'</td><td>'
		+ dataObj['score_result_5m']['analyzed_candles']['max_valid_consecutive_bearish']
		
		
		+'</td><td>'
		//+ dataObj['score_result_5m']['retracement']
		+Math.abs( percentageChange * dataObj['score_result_5m']['analyzed_candles']['max_valid_consecutive_bullish'] ).toFixed(2)
		
		+'</td><td>'
		//+ dataObj['score_result_5m']['pullback_depth']
		+Math.abs( percentageChange  * dataObj['score_result_5m']['analyzed_candles']['max_valid_consecutive_bearish'] ).toFixed(2)
		
		
		+'</td><td>'
		}

			
		/*
		tablesStr += 
		//+'</td><td>'
		+ratioPercentage.toFixed(2)
		+'</td><td>'
		+ whoIsMoreAggressive 
		+'</td><td>'
		+ LTP_near_HighestVolBar_priceRange.toFixed(3)
		+'</td><td>'
		+ LTP_near_POC.toFixed(3)
		+'</td><td>'
		+ HighestVolBar_priceRange
		+'</td><td>'
		+ POC_Price
		+'</td><td>'
		+ LastPrice
		+'</td><td>'
		+ HighestVolBar_time
		+'</td><td>'
		+ HighestVolBar_near_day_high.toFixed(3)
		+'</td><td>'
		+ HighestVolBar_near_day_low.toFixed(3)
		+'</td><td>'
		+ ( dataObj['total_ask'] - HighestVolBar_priceRange_total_ask )
		+'</td><td>'
		+ ( dataObj['total_bid'] - HighestVolBar_priceRange_total_bid )
		
		+'</td><td>'
		+ ( pChange_total_1m )
		*/
		
				
		/*
		+'</td><td>'
		+ dataObj['marketDeptOrderBook']['totalBuyQuantity'] 
		+'</td><td>'
		+ dataObj['marketDeptOrderBook']['totalSellQuantity']
		+'</td><td>'
		//+ dataObj['marketDeptOrderBook']['totalBuyQuantity'] + ' (' +(dataObj['marketDeptOrderBook']['totalBuyQuantity'] / (dataObj['marketDeptOrderBook']['totalBuyQuantity'] + dataObj['marketDeptOrderBook']['totalSellQuantity'] ) *100 ).toFixed(2) + ')' 
		+ (dataObj['marketDeptOrderBook']['totalBuyQuantity'] / (dataObj['marketDeptOrderBook']['totalBuyQuantity'] + dataObj['marketDeptOrderBook']['totalSellQuantity'] ) *100 ).toFixed(2) 
		+'</td><td>'
		//+ dataObj['marketDeptOrderBook']['totalSellQuantity'] + ' (' +(dataObj['marketDeptOrderBook']['totalSellQuantity'] / (dataObj['marketDeptOrderBook']['totalBuyQuantity'] + dataObj['marketDeptOrderBook']['totalSellQuantity'] ) *100 ).toFixed(2) + ')' 
		+ (dataObj['marketDeptOrderBook']['totalSellQuantity'] / (dataObj['marketDeptOrderBook']['totalBuyQuantity'] + dataObj['marketDeptOrderBook']['totalSellQuantity'] ) *100 ).toFixed(2)
		//+'</td><td>'
		*/
		//+ ratioPercentage.toFixed(2)
		//+'</td></tr>'
		//console.log( "tablesStr", tablesStr )
		return tablesStr;
	}

	for( var i=0; i< Object.keys( candleWiseDataObj ).length ; i++ ) {
	//for( var i=0; i< 50 ; i++ ) {
	//var symbol = symbolStr.split('_')[0]
	var symbol = Object.keys( candleWiseDataObj )[i]
	
	{

		var dataObj = candleWiseDataObj [symbol]
	
		optMostActiveTablesStr +=	returnDataStr3( symbol, dataObj )

	}
	}
	
	optMostActiveTablesStr +=' </tbody> </table>    </div>  </div>'
	//optOILosersTablesStr +=' </tbody> </table>    </div>  </div>'


	
	 document.getElementById('highestConsolidationBreakoutStocksTableContainer').innerHTML = optMostActiveTablesStr;
	 //document.getElementById('optPriceLosersTableContainer').innerHTML = optOILosersTablesStr;

	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => b[1] - a[1] ) )   // for sorting object ascending
	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => a[1] - b[1] ) )   // for sorting object descending
	var theadStr = '<thead class="tableRowClass">   <tr>      '
	+'<th>Symbol</th>'
	+' <th>%Chng/Range</th>'
	+' <th>Chng%Ratio</th>'
	+' <th>BreakoutT</th>'
	//+' <th>ContinueT</th>'
	
	+' <th>Trend_5m</th>'
	
	
	+' <th>BreakoutStngh</th>'
	
	+' <th>Avg_Rng</th>'
	+' <th>Avg_pChng</th>'
	//+' <th>Score</th>'
	
	+' <th>c%</th>'
	+' <th>Sgnl%</th>'
	+' <th>Score</th>'
	+' <th>SwingRng</th>'
	+' <th>Candles</th>'
	+' <th>Rng*Cndl</th>'
	+' <th>Rng*Cndl*No.Brk</th>'
	+' <th>No.Breaks</th>'
	
	
	/*
	+' <th>Score_1m</th>'
	+' <th>Candles</th>'
	//+' <th>bodyWick_1m</th>'
	+' <th>bodyPer</th>'
	+' <th>bullish</th>'
	+' <th>bearish</th>'
	//+' <th>retracement</th>'
	//+' <th>pullback</th>'
	
	+' <th>bullish%</th>'
	+' <th>bearish%</th>'

	+' <th>Score_5m</th>'
	+' <th>Candles</th>'
	//+' <th>bodyWick_5m</th>'
	+' <th>bodyPer</th>'
	+' <th>bullish</th>'
	+' <th>bearish</th>'
	//+' <th>retracement</th>'
	//+' <th>pullback</th>'
	
	+' <th>bullish%</th>'
	+' <th>bearish%</th>'

	
	+'<th>Ratio</th>'
	+' <th>Agrsv</th>'
	+' <th>Near HVP</th>'
	+' <th>Near POC</th>'
	+' <th>HVP</th>'
	+' <th>POC</th>'
	+' <th>LTP</th>'
	+' <th>TimeHVP</th>'
	+' <th>HVP Near High</th>'
	+' <th>HVP Near Low</th>'
	
	
	+' <th>BuyChng</th>'
	+' <th>SellChng</th>'
	+' <th>C%_1m</th>'
	*/
	
	//+'<th>Ratio%</th>   '
	+' </tr></thead><tbody>'
	var optMostActiveTablesStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="highLowBreakoutContinuationStocksTableStr"><caption style="caption-side:top"> 1st High Low Breakout Stocks| '+selectedTradingDate+' | '+timestamp+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	//var optOILosersTablesStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="optPriceLosersTablesStr"><caption style="caption-side:top">Options Price Losers | '+selectedTradingDate+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	 
	
	function returnDataStr4( symbol, dataObj )
	{
	
		
	
	 
	 var LastPrice = dataObj['LTP']
	
	
	var day_high = dataObj['day_high']
	var day_low = dataObj['day_low']
	
	var pChange_total_1m = 0
	
	
	
		var percentageChange = ( ( ( dataObj['LTP'] - dataObj['day_open'] ) / dataObj['day_open'] ) * 100 )


		
		var tablesStr = ''
		//var tablesStr = '<tr class="item"><td>'
		//+ symbol
	
		
		if( dataObj['high_low_breakout_continuation_structure_5m'] && dataObj['high_low_breakout_continuation_structure_5m'].length > 0 )
		{
		
		/*
		var market_structure_selected_timeFrame_array = dataObj['market_structure_5m']
		var highestConsolidation_index = 0
		var highestConsolidation_candles = 0
		
		for( var i=0;i<=market_structure_selected_timeFrame_array.length-2;i++)
		{
			if( market_structure_selected_timeFrame_array[i]['inside_candles'] > highestConsolidation_candles )
			{
				highestConsolidation_candles = market_structure_selected_timeFrame_array[i]['inside_candles'] 
				highestConsolidation_index = i
			}
		}
		
		
		//var last_swing_obj_5m = dataObj['market_structure_1m'][ dataObj['market_structure_1m'].length-1 ]
		//var last_swing_obj_5m =   dataObj['market_structure_5m'] && dataObj['market_structure_5m'].length > 0    ? dataObj['market_structure_5m'][dataObj['market_structure_5m'].length - 1]    : {}; // or provide a default object like { time: null, type: null }
		//var last_swing_obj_5m =   dataObj['market_structure_5m'] && dataObj['market_structure_5m'].length > 1  ? dataObj['market_structure_5m'][dataObj['market_structure_5m'].length - 2]    : {}; // or provide a default object like { time: null, type: null }
		var last_swing_obj_5m =   market_structure_selected_timeFrame_array && market_structure_selected_timeFrame_array.length > 1  ? market_structure_selected_timeFrame_array[ highestConsolidation_index ]   : {}; // or provide a default object like { time: null, type: null }
		
		*/
		
		
		//var last_swing_obj_5m = dataObj['market_structure_1m'][ dataObj['market_structure_1m'].length-1 ]
		//var last_swing_obj_5m =   dataObj['market_structure_5m'] && dataObj['market_structure_5m'].length > 0    ? dataObj['market_structure_5m'][dataObj['market_structure_5m'].length - 1]    : {}; // or provide a default object like { time: null, type: null }
		//var last_swing_obj_5m =   dataObj['market_structure_5m'] && dataObj['market_structure_5m'].length > 1  ? dataObj['market_structure_5m'][dataObj['market_structure_5m'].length - 2]    : {}; // or provide a default object like { time: null, type: null }
		//var last_swing_obj_5m =   market_structure_selected_timeFrame_array && market_structure_selected_timeFrame_array.length > 1  ? market_structure_selected_timeFrame_array[ highestConsolidation_index ]   : {}; // or provide a default object like { time: null, type: null }
		var last_swing_obj_5m =  dataObj['high_low_breakout_continuation_structure_5m'] [0]  // or provide a default object like { time: null, type: null }
		//var last_swing_obj_5m =  dataObj['high_low_breakout_continuation_structure_5m'] [ dataObj['high_low_breakout_continuation_structure_5m'].length-1 ]  // or provide a default object like { time: null, type: null }
		var breakoutTime = last_swing_obj_5m['breakout_candle'][0]
		
		//var market_structure_5m_last_swing_obj = dataObj['market_structure_1m'][ dataObj['market_structure_1m'].length-1 ]
		var market_structure_5m_last_swing_obj =   dataObj['market_structure_5m'] && dataObj['market_structure_5m'].length > 0    ? dataObj['market_structure_5m'][dataObj['market_structure_5m'].length - 1]    : {}; // or provide a default object like { time: null, type: null }
		//var market_structure_5m_last_swing_obj =   dataObj['market_structure_5m'] && dataObj['market_structure_5m'].length > 1  ? dataObj['market_structure_5m'][dataObj['market_structure_5m'].length - 2]    : {}; // or provide a default object like { time: null, type: null }
		
		var singnal_per_change =  ( last_swing_obj_5m['trend'] =='Bullish' ?  ( ( ( dataObj['day_high'] -  last_swing_obj_5m ['breakout_candle'][4] ) / last_swing_obj_5m ['breakout_candle'][4] ) * 100 ).toFixed(2) :  ( ( ( dataObj['day_low'] -  last_swing_obj_5m ['breakout_candle'][4] ) / last_swing_obj_5m ['breakout_candle'][4] ) * 100 ).toFixed(2) )
		
		//console.log( symbol, last_swing_obj_5m )
		//if( breakoutTime==breakoutTimeSelectorValue || breakoutTimeSelectorValue== 'ALL')
		if( (breakoutTime >=breakoutTimeSelectorValue && breakoutTime <=breakoutTimeTillSelectorValue) || breakoutTimeSelectorValue== 'ALL')
		{


		
		tablesStr += '<tr class="item"><td>'
		+ symbol
		+'</td><td>'
	
		+ ( last_swing_obj_5m['avg_range_%'] ?( ( (  Math.abs(last_swing_obj_5m ['breakout_candle'][4] - last_swing_obj_5m ['breakout_candle'][1]) / ( last_swing_obj_5m ['breakout_candle'][1]))*100 ) / last_swing_obj_5m['avg_range_%'] ).toFixed(2)    : ''  )
		
		
		+'</td><td>'
		+ ( last_swing_obj_5m['avg_pChange'] ?  Math.abs(( ( (  Math.abs(last_swing_obj_5m ['breakout_candle'][4] - last_swing_obj_5m ['breakout_candle'][1]) / ( last_swing_obj_5m ['breakout_candle'][1]))*100 ) / last_swing_obj_5m['avg_pChange'] ) * percentageChange ).toFixed(2)    : ''  )
		
		+'</td><td>'
		
		//+ last_swing_obj_5m['inside_candles']
		+ ( last_swing_obj_5m['breakout_candle']  ? last_swing_obj_5m['breakout_candle'][0] : '' )
		+'</td><td>'
		 
		//+ last_swing_obj_5m['inside_candles']
		//+ ( last_swing_obj_5m['continuation_candle']  ? last_swing_obj_5m['continuation_candle'][0] : '' )
		//+'</td><td>'
		
		+ ( last_swing_obj_5m['trend']  ? last_swing_obj_5m['trend'] : 0 )
	
		
		//+'</td><td>'
		//+ ( last_swing_obj_5m['start_candle'] ? last_swing_obj_5m['start_candle'][0]  : ''  )
	
		//+'</td><td>'
		//+ ( last_swing_obj_5m['day_close_candle'] ? last_swing_obj_5m ['day_close_candle'][0]  : ''  )
		
		
		+'</td><td>'
		+ ( last_swing_obj_5m['breakout_candle'] ?( (  Math.abs(last_swing_obj_5m ['breakout_candle'][4] - last_swing_obj_5m ['breakout_candle'][1]) / (last_swing_obj_5m ['breakout_candle'][2] - last_swing_obj_5m ['breakout_candle'][3]))*100 ) .toFixed(2)    : ''  )
	
	
		+'</td><td>'
		+ ( last_swing_obj_5m['avg_range_%'] ?(  last_swing_obj_5m['avg_range_%'] ).toFixed(2)    : ''  )
	
		+'</td><td>'
		+ ( last_swing_obj_5m['avg_pChange'] ?(  last_swing_obj_5m['avg_pChange'] ).toFixed(2)    : ''  )
	
		+'</td><td>'
		//+ dataObj['score_result_1m']['score']
		+ percentageChange.toFixed(2)
		
		+'</td><td>'
		//+ dataObj['score_result_1m']['score']
		+ ( last_swing_obj_5m['trend'] =='Bullish' ?  ( ( ( dataObj['day_high'] -  last_swing_obj_5m ['breakout_candle'][4] ) / last_swing_obj_5m ['breakout_candle'][4] ) * 100 ).toFixed(2) :  ( ( ( dataObj['day_low'] -  last_swing_obj_5m ['breakout_candle'][4] ) / last_swing_obj_5m ['breakout_candle'][4] ) * 100 ).toFixed(2) )
		
		 
		+'</td><td>'
		//+ dataObj['score_result_1m']['score']
		+ ( last_swing_obj_5m['trend'] =='Bullish' ?  (( ( ( dataObj['day_high'] -  last_swing_obj_5m ['breakout_candle'][4] ) / last_swing_obj_5m ['breakout_candle'][4] ) * 100 ) * dataObj['high_low_breakout_continuation_structure_5m'].length).toFixed(2) :  (( ( ( dataObj['day_low'] -  last_swing_obj_5m ['breakout_candle'][4] ) / last_swing_obj_5m ['breakout_candle'][4] ) * 100 ) * dataObj['high_low_breakout_continuation_structure_5m'].length).toFixed(2) )
		
		 
		+'</td><td>'
		+ ( market_structure_5m_last_swing_obj['swing_high']  ? ( (market_structure_5m_last_swing_obj['swing_high'] - market_structure_5m_last_swing_obj['swing_low'])/market_structure_5m_last_swing_obj['swing_low']*100 ).toFixed(2) : 'Null' )
		
		 
		+'</td><td>'
		+ ( market_structure_5m_last_swing_obj['inside_candles']  ? market_structure_5m_last_swing_obj['inside_candles'] : '0' )
		
		+'</td><td>'
		//+ ( market_structure_5m_last_swing_obj['swing_high']  ? ( (100-( (market_structure_5m_last_swing_obj['swing_high'] - market_structure_5m_last_swing_obj['swing_low'])/market_structure_5m_last_swing_obj['swing_low']*100 )) * market_structure_5m_last_swing_obj['inside_candles'] ) .toFixed(2) : 'Null' )
		//+ ( market_structure_5m_last_swing_obj['swing_high']  ? ( (100-( (market_structure_5m_last_swing_obj['swing_high'] - market_structure_5m_last_swing_obj['swing_low'])/market_structure_5m_last_swing_obj['swing_low']*100 )) * market_structure_5m_last_swing_obj['inside_candles'] * Number( singnal_per_change ) ) .toFixed(2) : 'Null' )
		 +( market_structure_5m_last_swing_obj['swing_high']  ? ( (100-( (market_structure_5m_last_swing_obj['swing_high'] - market_structure_5m_last_swing_obj['swing_low'])/market_structure_5m_last_swing_obj['swing_low']*100 )) * (dataObj['high_low_breakout_continuation_structure_5m'].length) ) .toFixed(2) : 'Null' )
		 
		+'</td><td>'
		 +( market_structure_5m_last_swing_obj['swing_high']  ? ( (100-( (market_structure_5m_last_swing_obj['swing_high'] - market_structure_5m_last_swing_obj['swing_low'])/market_structure_5m_last_swing_obj['swing_low']*100 )) * market_structure_5m_last_swing_obj['inside_candles'] *  (dataObj['high_low_breakout_continuation_structure_5m'].length) ) .toFixed(2) : 'Null' )
		
		+'</td><td>'
		+ (dataObj['high_low_breakout_continuation_structure_5m'].length)
		 
		//+'</td><td>'
		+'</td></tr>'
		}
		
		}

		if( false && dataObj['score_result_1m'] != undefined )
		{
		tablesStr += 
		'</td><td>'
		//+ dataObj['score_result_1m']['score']
		+ percentageChange.toFixed(2)
		 
		+'</td><td>'
		//+ dataObj['score_result_1m']['score']
		//+ ( dataObj['score_result_1m']['num_consec'] * dataObj['score_result_1m']['body_per'] ).toFixed(2)
		//+ Math.abs( percentageChange * dataObj['score_result_1m']['num_consec'] * dataObj['score_result_1m']['body_per']  ).toFixed(2)
		+ Math.abs( percentageChange * dataObj['score_result_1m']['num_consec'] ).toFixed(2)
		
		+'</td><td>'
		+ dataObj['score_result_1m']['num_consec']
		
		//+'</td><td>'
		//+ dataObj['score_result_1m']['body_wick']
		
		+'</td><td>'
		+ dataObj['score_result_1m']['body_per']
		
		+'</td><td>'
		//+ dataObj['score_result_1m']['analyzed_candles']['max_consecutive_bullish']
		+ dataObj['score_result_1m']['analyzed_candles']['max_valid_consecutive_bullish']
		+'</td><td>'
		+ dataObj['score_result_1m']['analyzed_candles']['max_valid_consecutive_bearish']
		
		+'</td><td>'
		//+ dataObj['score_result_1m']['retracement']
		+Math.abs( percentageChange * dataObj['score_result_1m']['analyzed_candles']['max_valid_consecutive_bullish'] ).toFixed(2)
		
		+'</td><td>'
		//+ dataObj['score_result_1m']['pullback_depth']
		+Math.abs( percentageChange * dataObj['score_result_1m']['analyzed_candles']['max_valid_consecutive_bearish'] ).toFixed(2)
		
		
		
		+'</td><td>'
		//+ dataObj['score_result_5m']['score']
		//+ ( dataObj['score_result_5m']['num_consec'] * dataObj['score_result_5m']['body_per'] ).toFixed(2)
		//+Math.abs( percentageChange  * dataObj['score_result_5m']['num_consec'] * dataObj['score_result_5m']['body_per']   ).toFixed(2)
		+Math.abs( percentageChange  * dataObj['score_result_5m']['num_consec'] ).toFixed(2)
		
		
		+'</td><td>'
		+ dataObj['score_result_5m']['num_consec']
		
		//+'</td><td>'
		//+ dataObj['score_result_5m']['body_wick']
		
		+'</td><td>'
		+ dataObj['score_result_5m']['body_per']
		
		+'</td><td>'
		+ dataObj['score_result_5m']['analyzed_candles']['max_valid_consecutive_bullish']
		+'</td><td>'
		+ dataObj['score_result_5m']['analyzed_candles']['max_valid_consecutive_bearish']
		
		
		+'</td><td>'
		//+ dataObj['score_result_5m']['retracement']
		+Math.abs( percentageChange * dataObj['score_result_5m']['analyzed_candles']['max_valid_consecutive_bullish'] ).toFixed(2)
		
		+'</td><td>'
		//+ dataObj['score_result_5m']['pullback_depth']
		+Math.abs( percentageChange  * dataObj['score_result_5m']['analyzed_candles']['max_valid_consecutive_bearish'] ).toFixed(2)
		
		
		+'</td><td>'
		}

			
		/*
		tablesStr += 
		//+'</td><td>'
		+ratioPercentage.toFixed(2)
		+'</td><td>'
		+ whoIsMoreAggressive 
		+'</td><td>'
		+ LTP_near_HighestVolBar_priceRange.toFixed(3)
		+'</td><td>'
		+ LTP_near_POC.toFixed(3)
		+'</td><td>'
		+ HighestVolBar_priceRange
		+'</td><td>'
		+ POC_Price
		+'</td><td>'
		+ LastPrice
		+'</td><td>'
		+ HighestVolBar_time
		+'</td><td>'
		+ HighestVolBar_near_day_high.toFixed(3)
		+'</td><td>'
		+ HighestVolBar_near_day_low.toFixed(3)
		+'</td><td>'
		+ ( dataObj['total_ask'] - HighestVolBar_priceRange_total_ask )
		+'</td><td>'
		+ ( dataObj['total_bid'] - HighestVolBar_priceRange_total_bid )
		
		+'</td><td>'
		+ ( pChange_total_1m )
		*/
		
				
		/*
		+'</td><td>'
		+ dataObj['marketDeptOrderBook']['totalBuyQuantity'] 
		+'</td><td>'
		+ dataObj['marketDeptOrderBook']['totalSellQuantity']
		+'</td><td>'
		//+ dataObj['marketDeptOrderBook']['totalBuyQuantity'] + ' (' +(dataObj['marketDeptOrderBook']['totalBuyQuantity'] / (dataObj['marketDeptOrderBook']['totalBuyQuantity'] + dataObj['marketDeptOrderBook']['totalSellQuantity'] ) *100 ).toFixed(2) + ')' 
		+ (dataObj['marketDeptOrderBook']['totalBuyQuantity'] / (dataObj['marketDeptOrderBook']['totalBuyQuantity'] + dataObj['marketDeptOrderBook']['totalSellQuantity'] ) *100 ).toFixed(2) 
		+'</td><td>'
		//+ dataObj['marketDeptOrderBook']['totalSellQuantity'] + ' (' +(dataObj['marketDeptOrderBook']['totalSellQuantity'] / (dataObj['marketDeptOrderBook']['totalBuyQuantity'] + dataObj['marketDeptOrderBook']['totalSellQuantity'] ) *100 ).toFixed(2) + ')' 
		+ (dataObj['marketDeptOrderBook']['totalSellQuantity'] / (dataObj['marketDeptOrderBook']['totalBuyQuantity'] + dataObj['marketDeptOrderBook']['totalSellQuantity'] ) *100 ).toFixed(2)
		//+'</td><td>'
		*/
		//+ ratioPercentage.toFixed(2)
		//+'</td></tr>'
		//console.log( "tablesStr", tablesStr )
		return tablesStr;
	}

	for( var i=0; i< Object.keys( candleWiseDataObj ).length ; i++ ) {
	//for( var i=0; i< 50 ; i++ ) {
	//var symbol = symbolStr.split('_')[0]
	var symbol = Object.keys( candleWiseDataObj )[i]

	{

		var dataObj = candleWiseDataObj [symbol]
	
		optMostActiveTablesStr +=	returnDataStr4( symbol, dataObj )

	}
	}
	
	optMostActiveTablesStr +=' </tbody> </table>    </div>  </div>'
	//optOILosersTablesStr +=' </tbody> </table>    </div>  </div>'


	
	 document.getElementById('highLowBreakoutContinuationStocksTableContainer').innerHTML = optMostActiveTablesStr;
	 //document.getElementById('optPriceLosersTableContainer').innerHTML = optOILosersTablesStr;

	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => b[1] - a[1] ) )   // for sorting object ascending
	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => a[1] - b[1] ) )   // for sorting object descending
	var theadStr = '<thead class="tableRowClass">   <tr>      '
	+'<th>Symbol</th>'
	+'<th>No.Break</th>'
	+'<th>Score</th>'
	+'<th>TimeDiff</th>'
	+' <th>%Chng/Range</th>'
	+' <th>Chng%Ratio</th>'
	+' <th>BreakoutT</th>'
	//+' <th>ContinueT</th>'
	
	+' <th>Trend_5m</th>'
	
	
	+' <th>BreakoutStngh</th>'
	
	+' <th>Avg_Rng</th>'
	+' <th>Avg_pChng</th>'
	//+' <th>Score</th>'
	
	+' <th>c%</th>'
	+' <th>Sgnl%</th>'
	
	/*
	+' <th>Score_1m</th>'
	+' <th>Candles</th>'
	//+' <th>bodyWick_1m</th>'
	+' <th>bodyPer</th>'
	+' <th>bullish</th>'
	+' <th>bearish</th>'
	//+' <th>retracement</th>'
	//+' <th>pullback</th>'
	
	+' <th>bullish%</th>'
	+' <th>bearish%</th>'

	+' <th>Score_5m</th>'
	+' <th>Candles</th>'
	//+' <th>bodyWick_5m</th>'
	+' <th>bodyPer</th>'
	+' <th>bullish</th>'
	+' <th>bearish</th>'
	//+' <th>retracement</th>'
	//+' <th>pullback</th>'
	
	+' <th>bullish%</th>'
	+' <th>bearish%</th>'

	
	+'<th>Ratio</th>'
	+' <th>Agrsv</th>'
	+' <th>Near HVP</th>'
	+' <th>Near POC</th>'
	+' <th>HVP</th>'
	+' <th>POC</th>'
	+' <th>LTP</th>'
	+' <th>TimeHVP</th>'
	+' <th>HVP Near High</th>'
	+' <th>HVP Near Low</th>'
	
	
	+' <th>BuyChng</th>'
	+' <th>SellChng</th>'
	+' <th>C%_1m</th>'
	*/
	
	//+'<th>Ratio%</th>   '
	+' </tr></thead><tbody>'
	var optMostActiveTablesStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="highLowBreakoutContinuationStocksTableStr2"><caption style="caption-side:top"> Latest High Low Breakout Stocks| '+selectedTradingDate+' | '+timestamp+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	//var optOILosersTablesStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="optPriceLosersTablesStr"><caption style="caption-side:top">Options Price Losers | '+selectedTradingDate+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	 
	const diffMins = (t1, t2) => (new Date(`1970-01-01T${t1}Z`) - new Date(`1970-01-01T${t2}Z`)) / 60000;
	//console.log(diffMins("09:35:00", "09:30:00")); // 5


	
	function returnDataStr5( symbol, dataObj )
	{
	
		
	
	 
	 var LastPrice = dataObj['LTP']
	
	
	var day_high = dataObj['day_high']
	var day_low = dataObj['day_low']
	
	var pChange_total_1m = 0
	
	
	
		var percentageChange = ( ( ( dataObj['LTP'] - dataObj['day_open'] ) / dataObj['day_open'] ) * 100 )


		
		var tablesStr = ''
		//var tablesStr = '<tr class="item"><td>'
		//+ symbol
	
		
		if( dataObj['high_low_breakout_continuation_structure_5m'] && dataObj['high_low_breakout_continuation_structure_5m'].length > 0 )
		{
		
		/*
		var market_structure_selected_timeFrame_array = dataObj['market_structure_5m']
		var highestConsolidation_index = 0
		var highestConsolidation_candles = 0
		
		for( var i=0;i<=market_structure_selected_timeFrame_array.length-2;i++)
		{
			if( market_structure_selected_timeFrame_array[i]['inside_candles'] > highestConsolidation_candles )
			{
				highestConsolidation_candles = market_structure_selected_timeFrame_array[i]['inside_candles'] 
				highestConsolidation_index = i
			}
		}
		
		
		//var last_swing_obj_5m = dataObj['market_structure_1m'][ dataObj['market_structure_1m'].length-1 ]
		//var last_swing_obj_5m =   dataObj['market_structure_5m'] && dataObj['market_structure_5m'].length > 0    ? dataObj['market_structure_5m'][dataObj['market_structure_5m'].length - 1]    : {}; // or provide a default object like { time: null, type: null }
		//var last_swing_obj_5m =   dataObj['market_structure_5m'] && dataObj['market_structure_5m'].length > 1  ? dataObj['market_structure_5m'][dataObj['market_structure_5m'].length - 2]    : {}; // or provide a default object like { time: null, type: null }
		var last_swing_obj_5m =   market_structure_selected_timeFrame_array && market_structure_selected_timeFrame_array.length > 1  ? market_structure_selected_timeFrame_array[ highestConsolidation_index ]   : {}; // or provide a default object like { time: null, type: null }
		
		*/
		
		
		//var last_swing_obj_5m = dataObj['market_structure_1m'][ dataObj['market_structure_1m'].length-1 ]
		//var last_swing_obj_5m =   dataObj['market_structure_5m'] && dataObj['market_structure_5m'].length > 0    ? dataObj['market_structure_5m'][dataObj['market_structure_5m'].length - 1]    : {}; // or provide a default object like { time: null, type: null }
		//var last_swing_obj_5m =   dataObj['market_structure_5m'] && dataObj['market_structure_5m'].length > 1  ? dataObj['market_structure_5m'][dataObj['market_structure_5m'].length - 2]    : {}; // or provide a default object like { time: null, type: null }
		//var last_swing_obj_5m =   market_structure_selected_timeFrame_array && market_structure_selected_timeFrame_array.length > 1  ? market_structure_selected_timeFrame_array[ highestConsolidation_index ]   : {}; // or provide a default object like { time: null, type: null }
		//var last_swing_obj_5m =  dataObj['high_low_breakout_continuation_structure_5m'] [0]  // or provide a default object like { time: null, type: null }
		var last_swing_obj_5m =  dataObj['high_low_breakout_continuation_structure_5m'] [ dataObj['high_low_breakout_continuation_structure_5m'].length-1 ]  // or provide a default object like { time: null, type: null }
		var last_swing_obj_5m_previous =   ( dataObj['high_low_breakout_continuation_structure_5m'].length >1 ? dataObj['high_low_breakout_continuation_structure_5m'] [ dataObj['high_low_breakout_continuation_structure_5m'].length-2 ] : undefined )  // or provide a default object like { time: null, type: null }
		var breakoutTime = last_swing_obj_5m['breakout_candle'][0]
		//console.log( symbol, last_swing_obj_5m )
		//if( breakoutTime==breakoutTimeSelectorValue || breakoutTimeSelectorValue== 'ALL')
		if( (breakoutTime >=breakoutTimeSelectorValue && breakoutTime <=breakoutTimeTillSelectorValue) || breakoutTimeSelectorValue== 'ALL')
		{
		tablesStr += '<tr class="item"><td>'
		+ symbol
		+'</td><td>'
		
		+ (dataObj['high_low_breakout_continuation_structure_5m'].length)
		+'</td><td>'
		
		+ (  percentageChange * dataObj['high_low_breakout_continuation_structure_5m'].length).toFixed(2)
		+'</td><td>'
		
		+ ( last_swing_obj_5m_previous ? Math.abs(( diffMins(last_swing_obj_5m_previous['breakout_candle'][0], last_swing_obj_5m['breakout_candle'][0]) ) / 5 ) : '' )
		+'</td><td>'
	
		+ ( last_swing_obj_5m['avg_range_%'] ?( ( (  Math.abs(last_swing_obj_5m ['breakout_candle'][4] - last_swing_obj_5m ['breakout_candle'][1]) / ( last_swing_obj_5m ['breakout_candle'][1]))*100 ) / last_swing_obj_5m['avg_range_%'] ).toFixed(2)    : ''  )
		
		
		+'</td><td>'
		+ ( last_swing_obj_5m['avg_pChange'] ?  Math.abs(( ( (  Math.abs(last_swing_obj_5m ['breakout_candle'][4] - last_swing_obj_5m ['breakout_candle'][1]) / ( last_swing_obj_5m ['breakout_candle'][1]))*100 ) / last_swing_obj_5m['avg_pChange'] ) * percentageChange ).toFixed(2)    : ''  )
		
		+'</td><td>'
		
		//+ last_swing_obj_5m['inside_candles']
		+ ( last_swing_obj_5m['breakout_candle']  ? last_swing_obj_5m['breakout_candle'][0] : '' )
		+'</td><td>'
		 
		//+ last_swing_obj_5m['inside_candles']
		//+ ( last_swing_obj_5m['continuation_candle']  ? last_swing_obj_5m['continuation_candle'][0] : '' )
		//+'</td><td>'
		
		+ ( last_swing_obj_5m['trend']  ? last_swing_obj_5m['trend'] : 0 )
	
		
		//+'</td><td>'
		//+ ( last_swing_obj_5m['start_candle'] ? last_swing_obj_5m['start_candle'][0]  : ''  )
	
		//+'</td><td>'
		//+ ( last_swing_obj_5m['day_close_candle'] ? last_swing_obj_5m ['day_close_candle'][0]  : ''  )
		
		
		+'</td><td>'
		+ ( last_swing_obj_5m['breakout_candle'] ?( (  Math.abs(last_swing_obj_5m ['breakout_candle'][4] - last_swing_obj_5m ['breakout_candle'][1]) / (last_swing_obj_5m ['breakout_candle'][2] - last_swing_obj_5m ['breakout_candle'][3]))*100 ) .toFixed(2)    : ''  )
	
	
		+'</td><td>'
		+ ( last_swing_obj_5m['avg_range_%'] ?(  last_swing_obj_5m['avg_range_%'] ).toFixed(2)    : ''  )
	
		+'</td><td>'
		+ ( last_swing_obj_5m['avg_pChange'] ?(  last_swing_obj_5m['avg_pChange'] ).toFixed(2)    : ''  )
	
		+'</td><td>'
		//+ dataObj['score_result_1m']['score']
		+ percentageChange.toFixed(2)
		
		+'</td><td>'
		//+ dataObj['score_result_1m']['score']
		+ ( last_swing_obj_5m['trend'] =='Bullish' ?  ( ( ( dataObj['day_high'] -  last_swing_obj_5m ['breakout_candle'][4] ) / last_swing_obj_5m ['breakout_candle'][4] ) * 100 ).toFixed(2) :  ( ( ( dataObj['day_low'] -  last_swing_obj_5m ['breakout_candle'][4] ) / last_swing_obj_5m ['breakout_candle'][4] ) * 100 ).toFixed(2) )
		
		 
		//+'</td><td>'
		+'</td></tr>'
		
		}
		}

		if( false && dataObj['score_result_1m'] != undefined )
		{
		tablesStr += 
		'</td><td>'
		//+ dataObj['score_result_1m']['score']
		+ percentageChange.toFixed(2)
		 
		+'</td><td>'
		//+ dataObj['score_result_1m']['score']
		//+ ( dataObj['score_result_1m']['num_consec'] * dataObj['score_result_1m']['body_per'] ).toFixed(2)
		//+ Math.abs( percentageChange * dataObj['score_result_1m']['num_consec'] * dataObj['score_result_1m']['body_per']  ).toFixed(2)
		+ Math.abs( percentageChange * dataObj['score_result_1m']['num_consec'] ).toFixed(2)
		
		+'</td><td>'
		+ dataObj['score_result_1m']['num_consec']
		
		//+'</td><td>'
		//+ dataObj['score_result_1m']['body_wick']
		
		+'</td><td>'
		+ dataObj['score_result_1m']['body_per']
		
		+'</td><td>'
		//+ dataObj['score_result_1m']['analyzed_candles']['max_consecutive_bullish']
		+ dataObj['score_result_1m']['analyzed_candles']['max_valid_consecutive_bullish']
		+'</td><td>'
		+ dataObj['score_result_1m']['analyzed_candles']['max_valid_consecutive_bearish']
		
		+'</td><td>'
		//+ dataObj['score_result_1m']['retracement']
		+Math.abs( percentageChange * dataObj['score_result_1m']['analyzed_candles']['max_valid_consecutive_bullish'] ).toFixed(2)
		
		+'</td><td>'
		//+ dataObj['score_result_1m']['pullback_depth']
		+Math.abs( percentageChange * dataObj['score_result_1m']['analyzed_candles']['max_valid_consecutive_bearish'] ).toFixed(2)
		
		
		
		+'</td><td>'
		//+ dataObj['score_result_5m']['score']
		//+ ( dataObj['score_result_5m']['num_consec'] * dataObj['score_result_5m']['body_per'] ).toFixed(2)
		//+Math.abs( percentageChange  * dataObj['score_result_5m']['num_consec'] * dataObj['score_result_5m']['body_per']   ).toFixed(2)
		+Math.abs( percentageChange  * dataObj['score_result_5m']['num_consec'] ).toFixed(2)
		
		
		+'</td><td>'
		+ dataObj['score_result_5m']['num_consec']
		
		//+'</td><td>'
		//+ dataObj['score_result_5m']['body_wick']
		
		+'</td><td>'
		+ dataObj['score_result_5m']['body_per']
		
		+'</td><td>'
		+ dataObj['score_result_5m']['analyzed_candles']['max_valid_consecutive_bullish']
		+'</td><td>'
		+ dataObj['score_result_5m']['analyzed_candles']['max_valid_consecutive_bearish']
		
		
		+'</td><td>'
		//+ dataObj['score_result_5m']['retracement']
		+Math.abs( percentageChange * dataObj['score_result_5m']['analyzed_candles']['max_valid_consecutive_bullish'] ).toFixed(2)
		
		+'</td><td>'
		//+ dataObj['score_result_5m']['pullback_depth']
		+Math.abs( percentageChange  * dataObj['score_result_5m']['analyzed_candles']['max_valid_consecutive_bearish'] ).toFixed(2)
		
		
		+'</td><td>'
		}

			
		/*
		tablesStr += 
		//+'</td><td>'
		+ratioPercentage.toFixed(2)
		+'</td><td>'
		+ whoIsMoreAggressive 
		+'</td><td>'
		+ LTP_near_HighestVolBar_priceRange.toFixed(3)
		+'</td><td>'
		+ LTP_near_POC.toFixed(3)
		+'</td><td>'
		+ HighestVolBar_priceRange
		+'</td><td>'
		+ POC_Price
		+'</td><td>'
		+ LastPrice
		+'</td><td>'
		+ HighestVolBar_time
		+'</td><td>'
		+ HighestVolBar_near_day_high.toFixed(3)
		+'</td><td>'
		+ HighestVolBar_near_day_low.toFixed(3)
		+'</td><td>'
		+ ( dataObj['total_ask'] - HighestVolBar_priceRange_total_ask )
		+'</td><td>'
		+ ( dataObj['total_bid'] - HighestVolBar_priceRange_total_bid )
		
		+'</td><td>'
		+ ( pChange_total_1m )
		*/
		
				
		/*
		+'</td><td>'
		+ dataObj['marketDeptOrderBook']['totalBuyQuantity'] 
		+'</td><td>'
		+ dataObj['marketDeptOrderBook']['totalSellQuantity']
		+'</td><td>'
		//+ dataObj['marketDeptOrderBook']['totalBuyQuantity'] + ' (' +(dataObj['marketDeptOrderBook']['totalBuyQuantity'] / (dataObj['marketDeptOrderBook']['totalBuyQuantity'] + dataObj['marketDeptOrderBook']['totalSellQuantity'] ) *100 ).toFixed(2) + ')' 
		+ (dataObj['marketDeptOrderBook']['totalBuyQuantity'] / (dataObj['marketDeptOrderBook']['totalBuyQuantity'] + dataObj['marketDeptOrderBook']['totalSellQuantity'] ) *100 ).toFixed(2) 
		+'</td><td>'
		//+ dataObj['marketDeptOrderBook']['totalSellQuantity'] + ' (' +(dataObj['marketDeptOrderBook']['totalSellQuantity'] / (dataObj['marketDeptOrderBook']['totalBuyQuantity'] + dataObj['marketDeptOrderBook']['totalSellQuantity'] ) *100 ).toFixed(2) + ')' 
		+ (dataObj['marketDeptOrderBook']['totalSellQuantity'] / (dataObj['marketDeptOrderBook']['totalBuyQuantity'] + dataObj['marketDeptOrderBook']['totalSellQuantity'] ) *100 ).toFixed(2)
		//+'</td><td>'
		*/
		//+ ratioPercentage.toFixed(2)
		//+'</td></tr>'
		//console.log( "tablesStr", tablesStr )
		return tablesStr;
	}

	for( var i=0; i< Object.keys( candleWiseDataObj ).length ; i++ ) {
	//for( var i=0; i< 50 ; i++ ) {
	//var symbol = symbolStr.split('_')[0]
	var symbol = Object.keys( candleWiseDataObj )[i]

	{

		var dataObj = candleWiseDataObj [symbol]
	
		optMostActiveTablesStr +=	returnDataStr5( symbol, dataObj )

	}
	}
	
	optMostActiveTablesStr +=' </tbody> </table>    </div>  </div>'
	//optOILosersTablesStr +=' </tbody> </table>    </div>  </div>'


	
	 document.getElementById('highLowBreakoutContinuationStocksTableContainer2').innerHTML = optMostActiveTablesStr;
	 //document.getElementById('optPriceLosersTableContainer').innerHTML = optOILosersTablesStr;

	
	
	 await addEventListnerInTables()
}	//	show_spurts_in_oi_underlyings_Data() Function ENDS HERE



var sliderValuesForTimeValuesObj ={}
function convert24HTimeInto12HTime(timeValue) {
  var timeArray = timeValue.split(":");
  var hours = parseInt(timeArray[0]);
  
  // Adjust the hours if necessary
  if (hours > 12) {
    hours -= 12;
  }
  
  var convertedTime = ("0" + hours).slice(-2) + ":" + timeArray[1];
  return convertedTime;
}

async function showPipsInSlider( passed_data_obj ) {
	//console.log( "passed_data_obj", passed_data_obj )
	//localStorage.setItem("candleWiseDataObj", JSON.stringify( passed_data_obj ));
	//await fetchAndSaveDataIDB( docPath );
	//await saveDataInIDB("candleWiseDataObj", passed_data_obj) 
		
	function formatDateTime(timestamp) {
		const date = new Date(timestamp);
		const year = date.getFullYear();
		const month = String(date.getMonth() + 1).padStart(2, '0'); // Months are 0-based
		const day = String(date.getDate()).padStart(2, '0');
		const hours = String(date.getHours()).padStart(2, '0');
		const minutes = String(date.getMinutes()).padStart(2, '0');
		const seconds = String(date.getSeconds()).padStart(2, '0');

		return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
	}

	
	var currentDayData = passed_data_obj

	var data_object_for_slider = {}

	var selectedEquityTimeRef = document.getElementById('commonTimeValues')
	var selectedCommonTimeValue = selectedEquityTimeRef.value.replace(':00', '')
	
	var sliderLastTimeValue = Object.keys(sliderValuesForTimeValuesObj)[Object.keys(sliderValuesForTimeValuesObj).length - 1]
	if( document.getElementById('indicesWithTimeOnOff').checked==true && sliderLastTimeValue==selectedCommonTimeValue  )
	{	// 
		return
	}
	
	if( Object.keys(currentDayData).length != Object.keys(sliderValuesForTimeValuesObj).length )
	{
		sliderValuesForTimeValuesObj ={}
	
	for( var i=0;i<Object.keys(currentDayData).length;i++ ){
	//for( var i=0;i<2;i++ ){
		var c = Object.keys(currentDayData)[i]
		//var candleTime = formatDateTime( Number(c) ).split(' ')[1]; // 1738813500000 Output: 2025-03-08 13:45:00
		var candleTime = formatDateTime( Number(c) ).split(' ')[1].replace(':00', ''); // 1738813500000 Output: 2025-03-08 13:45:00
		data_object_for_slider[ candleTime ] = currentDayData[c]
		if( document.getElementById('indicesWithTimeOnOff').checked==true && selectedCommonTimeValue==candleTime )
		{
			break
		}
	}
	


	var selectedYear = document.getElementById('year').value
	var selectedMonthYear = document.getElementById('monthYear').value
	var selectedTradingDate = document.getElementById('tradingDate').value
	

	var tradingDate = document.getElementById('tradingDate').value
	var selectedSymbol = document.getElementById('derivativesSymbols').value
	//var optionChainTimeValuesArray= firestoreIndexObj[ tradingDate ]['Index']['option_chain_data'][selectedSymbol]['timeValues']
	
	// Use keys from passed_data_obj instead of <select> options
	//const optionChainTimeValuesArray = Object.keys(passed_data_obj);
	const optionChainTimeValuesArray = Object.keys(data_object_for_slider);

	// Get the latest time (last key)
	var selectedTime = optionChainTimeValuesArray[optionChainTimeValuesArray.length - 1];

	if( document.getElementById('indicesWithTimeOnOff').checked==true )
	{
		selectedTime = selectedCommonTimeValue
	}
	
	//Object.keys(optionChainTimeValuesArray).indexOf('09:30')
	
	console.log("selectedTime", selectedTime);

	// Get time 14 steps before the latest one, if it exists
	//let pre15StempsTimeIndex = optionChainTimeValuesArray.length - 15;
	let pre15StempsTimeIndex = 0;
	if (pre15StempsTimeIndex < 0) pre15StempsTimeIndex = 1;  // fallback to second element

	const pre15StempsTime = optionChainTimeValuesArray[pre15StempsTimeIndex];
	console.log("pre15StempsTime", pre15StempsTime);



	// Reset slider container
	document.getElementById('sliderContainer').innerHTML = '<div id="slider"></div>';

	let percentage = 0;
	const initialSlider = [timeToMinutes(pre15StempsTime), timeToMinutes(selectedTime)];
	const range2 = {};

	const keysLength = optionChainTimeValuesArray.length;
	let previous_key = timeToMinutes("09:15:00");
	let index = 0;
	let timeValues = "";

	optionChainTimeValuesArray.forEach((key, i) => {
		const current = timeToMinutes(key);
		const difference = current - previous_key;
		const label = key.split(':')[0] + ":" + key.split(':')[1];

		// Add unique hour:minute labels for pips
		if (!timeValues.includes(label + "#")) {
			timeValues += `${label}#${current},`;
		}

		const arr = [previous_key, difference];
		percentage += 100 / keysLength;

		if (i === 0 || difference === 0) {
			// skip adding range on first iteration or no time gap
		} else if (i === 1) {
			range2['min'] = arr;
		} else if (i === keysLength - 1) {
			range2['max'] = [current];
			timeValues += `${label}#${current},`; // final label
		} else {
			range2[`${percentage.toFixed(2)}%`] = arr;
		}

		// 12-hour to 24-hour mapping
		sliderValuesForTimeValuesObj[convert24HTimeInto12HTime(key)] = key;

		previous_key = current;
	});


		
console.log("range2",range2)

			var slider = document.getElementById('slider');
			noUiSlider.create(slider, {
				start: initialSlider,
				connect: true,
				step: 3,
				tooltips: [true, true],

				range: range2,

				pips: {
					mode: 'steps',
					density: 4,
					//values: [0, 720, 1439],
					filter: function (value, type) {
						// //console.log(type, value, value % 60);
						// document.getElementById('temp').innerHTML += value+': '+ (value % 240) +',  '+(value % 60)+', '+(value % (60 * 4) === 0 ? 1 : value % 60 === 0 ? 2 : 0)+'<br>';

						if (timeValues.includes(value))
							//if(value==555 || value==930)
							return 1
						else
							return value % (60 * 4) === 0 ? 1 : value % 60 === 0 ? 1 : 0;
					},
					//density: 2,
					format: {
						to: function (value) {
							if (timeValues.includes(value)) {
								//if (value % (60) === 0 || value==555  || value==930) {
								// return moment().startOf('day').add(value, 'minutes').format('hh:mm A');
								return moment().startOf('day').add(value, 'minutes').format('hh:mm');
							}
							return '';
						},
						from: function (value) {
							return value;
						}
					}
				},


				format: {
					to: function (value) {
						//return value + ',-';
						//return moment().startOf('day').add(value, 'minutes').format('hh:mm A');
						return moment().startOf('day').add(value, 'minutes').format('hh:mm');
					},
					from: function (value) {
						return value;
					}
				}
			});


	}
	
	//document.getElementById('slider').setAttribute('onclick','fetchSlidersBuildupData()')
	//document.getElementsByClassName('noUi-handle noUi-handle-lower')[0].setAttribute('onmouseup','fetchSlidersBuildupData()')
	//document.getElementsByClassName('noUi-handle noUi-handle-upper')[0].setAttribute('onmouseup','fetchSlidersBuildupData()')

	//document.getElementById('slider').setAttribute('onclick', 'showData("flexibleSlider")')
	//document.getElementsByClassName('noUi-handle noUi-handle-lower')[0].setAttribute('onmouseup', 'showData("flexibleSlider")')
	//document.getElementsByClassName('noUi-handle noUi-handle-upper')[0].setAttribute('onmouseup', 'showData("flexibleSlider")')


} //showSliderData() ends here

async function showPerticularStocksEquityDataInTable()
{
	 document.getElementById('volumeProfile_EquityTableContainer').innerHTML = "";
	 /*
	 var selectedDeliveryStockSymbol = document.getElementById("deliveryStockSymbol").value
	var selectedMonthYear = document.getElementById('monthYear').value
	var selectedTradingDate = document.getElementById('tradingDate').value
	var selectedAvgDays = Number( document.getElementById("avgDays").value )
	var selectedPreviousTradingDays = Number( document.getElementById("previousTradingDays").value )

*/
	var selectedYear = document.getElementById('year').value
	var selectedMonthYear = document.getElementById('monthYear').value
	var selectedTradingDate = document.getElementById('tradingDate').value
	var selectedEquitySymbol = document.getElementById('derivativesSymbols').value
	
	var selectedEquityTimeRef = document.getElementById('equityTimeValues')
	var selectedEquityTimeValue = selectedEquityTimeRef.value


	var docPath = '/'+selectedYear+'/'+selectedMonthYear+'/'+selectedTradingDate+'/'+selectedEquitySymbol+'/'+selectedEquitySymbol
	//var allDerivativesDataArray = await fetchDerivativesCollectionData( docPathForSpurts )
	//console.log( "docPath", docPath )
	//var candleWiseDataObj = await fetchAndSaveDataIDB( docPath );
	var candleWiseDataObj = await fetchAndSaveDataIDB( docPath );
	//console.log("candleWiseDataObj", candleWiseDataObj)
	candleWiseDataObj = Object.fromEntries(Object.entries(candleWiseDataObj).sort((a, b) => a[0].localeCompare(b[0])));  // for sorting object ascending by keys
	//console.log("candleWiseDataObj", candleWiseDataObj)
	
	//const sortedAsc = Object.fromEntries(Object.entries(candleWiseDataObj).sort((a, b) => a[0].localeCompare(b[0])));
	//const sortedDesc = Object.fromEntries(Object.entries(candleWiseDataObj).sort((a, b) => b[0].localeCompare(a[0])));

	//console.log(allEquityDataObj )
	
	
	var temp
	var total_volume_profile_price_obj = {}
	var total_ask_bid = {
		'ask':0,
		'bid':0,
	}
	
	function sortByVolumeSumDescending(obj) {
    return Object.entries(obj)
        .sort((a, b) => {
            let sumA = a[1].reduce((sum, num) => sum + num, 0);
            let sumB = b[1].reduce((sum, num) => sum + num, 0);
            return sumB - sumA; // Sort in descending order
        });
	}

	function sortByVolumeSumDescending2(obj) {
		return Object.entries(obj)
			.sort((a, b) => {
				let sumA = a[1][1].reduce((sum, num) => sum + num, 0);
				let sumB = b[1][1].reduce((sum, num) => sum + num, 0);
				return sumB - sumA; // Sort in descending order
			});
	}


function formatDateTime(timestamp) {
    const date = new Date(timestamp);
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0'); // Months are 0-based
    const day = String(date.getDate()).padStart(2, '0');
    const hours = String(date.getHours()).padStart(2, '0');
    const minutes = String(date.getMinutes()).padStart(2, '0');
    const seconds = String(date.getSeconds()).padStart(2, '0');

    return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
}

	var previous_tick_price = 0
	var currentDayData = candleWiseDataObj
	//console.log("currentDayData", currentDayData)
	
	var highest_vol_price_arr = []
	var candlewise_highest_vol_price_obj = {}
	var candlewise_highest_vol_price_obj2 = {}
	
	
	var highest_ask_bid_orders_tick_wise_obj = {	ask:{},	bid:{},	}
	var highest_ask_bid_orders_whole_candle_wise_obj = {	ask:{},	bid:{},	}
	
	
	var previous_tick_price = 0
	var price_ranges_data_obj = {}
	var iceberg_orders_data_obj =  {	ask:{},	bid:{},	}


	
	await showPipsInSlider(candleWiseDataObj)
	
	var fromTime = sliderValuesForTimeValuesObj[ slider.noUiSlider.get()[0] ];
	var toTime = sliderValuesForTimeValuesObj[ slider.noUiSlider.get()[1] ];
	var candleWiseDataObjKeysArray = Object.values( sliderValuesForTimeValuesObj )
	//console.log( "candleWiseDataObjKeysArray", candleWiseDataObjKeysArray )
	var fromIndex = candleWiseDataObjKeysArray.indexOf(fromTime);
	var toIndex = candleWiseDataObjKeysArray.indexOf(toTime);
	
	
	//for( var i=0;i<Object.keys(currentDayData).length;i++ ){
	//for( var i=0;i<2;i++ ){
	for (var i = fromIndex; i <= toIndex; i++) {
		var c = Object.keys(currentDayData)[i]
		//console.log("c", c)
	
		
	//for( var c in currentDayData ){
	
		//var candleTime = formatDateTime( Number(c) ).split(' ')[1]; // 1738813500000 Output: 2025-03-08 13:45:00
		var candleTime = formatDateTime( Number(c) ).split(' ')[1].replace(':00', ''); // 1738813500000 Output: 2025-03-08 13:45:00
		//console.log( candleTime, currentDayData[c] )
		//console.log("candleTime", candleTime)
		if( currentDayData[c]['graphicsCmds'] !=undefined )
		{
			//console.log( candleTime, currentDayData[c]['graphicsCmds'] )
			//console.log(currentDayData[c]['graphicsCmds']['create']['hhists'][0]['data'])
			if( currentDayData[c]['graphicsCmds']['create'] !=undefined )
			{
				var hhists_data_array = currentDayData[c]['graphicsCmds']['create']['hhists'][0]['data']
				var single_candle_volume_profile_price_obj = {}
				
				
				// iceberg orders code starts here
				var previous_tick_difference = 0
				
				var previous_iceberg_executed_ask = 1
				var total_iceberg_executed_ask = 0
				var previous_iceberg_executed_ask_tick_counter = 0
				
				var previous_iceberg_executed_bid = 1
				var total_iceberg_executed_bid = 0
				var previous_iceberg_executed_bid_tick_counter = 0

				var start_iceberg_ask_price = 0
				var start_iceberg_bid_price = 0
				// iceberg orders code ends here
				
				var tick_counter = 0
				
				for( var tick of hhists_data_array )
				{
					
					var tick_id = tick['id']
					
					var priceHigh = tick['priceHigh'].toFixed(2)
					var priceLow = tick['priceLow'].toFixed(2)
					var ask = tick['rate'][0]
					var bid = tick['rate'][1]
					total_ask_bid['ask'] += ask
					total_ask_bid['bid'] += bid
					
					
					if( previous_tick_price==0 )
					{
						previous_tick_price = priceLow
					}
					
					//var priceRange = priceLow +'-'+ priceHigh
					//var priceRange = priceLow 
					var priceRange = previous_tick_price +'-'+ priceLow 
					
					var tick_difference = Math.abs( ( Number( priceRange.split('-')[1] ) - Number( priceRange.split('-')[0] ) ).toFixed(2) )
					 
					if(single_candle_volume_profile_price_obj[priceRange] ==undefined )
					{
						single_candle_volume_profile_price_obj[priceRange] = [ ask, bid, ask+bid ]
					}
					else
					{
						single_candle_volume_profile_price_obj[priceRange] = [ single_candle_volume_profile_price_obj[priceRange][0] + ask, single_candle_volume_profile_price_obj[priceRange] [1] + bid, single_candle_volume_profile_price_obj[priceRange] [2] +ask+ bid  ]
					}
					
					if(total_volume_profile_price_obj[priceRange] ==undefined )
					{
						total_volume_profile_price_obj[priceRange] = [ ask, bid ]
					}
					else
					{
						total_volume_profile_price_obj[priceRange] = [ total_volume_profile_price_obj[priceRange][0] + ask, total_volume_profile_price_obj[priceRange] [1] + bid ]
					}
					
					
					
					var uniquePriceID = priceRange +'_'+candleTime + '_'+ tick_id 
					
					highest_ask_bid_orders_tick_wise_obj ['ask'] [ uniquePriceID ] = ask
					highest_ask_bid_orders_tick_wise_obj ['bid'] [ uniquePriceID ] = bid
		
					var uniquePriceID = priceRange +'_'+candleTime 
					
					//highest_ask_bid_orders_whole_candle_wise_obj ['ask'] [ uniquePriceID ] = ask
					//highest_ask_bid_orders_whole_candle_wise_obj ['bid'] [ uniquePriceID ] = bid
					if( highest_ask_bid_orders_whole_candle_wise_obj ['ask'] [ uniquePriceID ] ==undefined )
					{
						highest_ask_bid_orders_whole_candle_wise_obj ['ask'] [ uniquePriceID ] = ask
					}
					else
					{
						highest_ask_bid_orders_whole_candle_wise_obj ['ask'] [ uniquePriceID ] += ask
					}
		
					if( highest_ask_bid_orders_whole_candle_wise_obj ['bid'] [ uniquePriceID ] ==undefined )
					{
						highest_ask_bid_orders_whole_candle_wise_obj ['bid'] [ uniquePriceID ] = bid
					}
					else
					{
						highest_ask_bid_orders_whole_candle_wise_obj ['bid'] [ uniquePriceID ] += bid
					}
		
	
					
					// iceberg orders code starts here
					if( tick_counter== 0 )
					{
						previous_tick_difference = tick_difference
						previous_iceberg_executed_ask = ask
						previous_iceberg_executed_bid = bid
						previous_iceberg_executed_ask_tick_counter = tick_counter
						
						start_iceberg_ask_price = priceLow
						start_iceberg_bid_price = priceLow
					}
					else   
					{
					
					if( tick_difference == previous_tick_difference && ( tick_counter - previous_iceberg_executed_ask_tick_counter ) ==1  || ask==previous_iceberg_executed_ask && previous_iceberg_executed_ask !=0 )
					{
						// ask iceberg
						previous_iceberg_executed_ask_tick_counter = tick_counter
						total_iceberg_executed_ask += previous_iceberg_executed_ask
						previous_iceberg_executed_ask = ask
						if(start_iceberg_ask_price.includes('ICB') ==false )
							start_iceberg_ask_price = 'ICB-'+ start_iceberg_ask_price
						//console.log( candleTime, total_iceberg_executed_ask )
						
					} 
					else if(  ask !=0 || ((tick_counter+1) == hhists_data_array.length) ) 
					//else 
					{ 	// ask iceberg break
						total_iceberg_executed_ask += previous_iceberg_executed_ask
						var uniquePriceID =  start_iceberg_ask_price +'-'+ priceLow  +'_'+candleTime + '_'+ tick_id 
					
						iceberg_orders_data_obj ['ask'] [ uniquePriceID ] = total_iceberg_executed_ask
						
						//console.log( candleTime, uniquePriceID, total_iceberg_executed_ask )
						total_iceberg_executed_ask = 0
						previous_iceberg_executed_ask = ask
						start_iceberg_ask_price = priceLow
						//console.log( "hhists_data_array", hhists_data_array )
					}
					
					if( tick_difference == previous_tick_difference && ( tick_counter - previous_iceberg_executed_bid_tick_counter ) ==1  || bid==previous_iceberg_executed_bid && previous_iceberg_executed_bid !=0 )
					{
						// ask iceberg
						previous_iceberg_executed_bid_tick_counter = tick_counter
						total_iceberg_executed_bid += previous_iceberg_executed_bid
						previous_iceberg_executed_bid = bid
						if(start_iceberg_bid_price.includes('ICB') ==false )
							start_iceberg_bid_price = 'ICB-'+ start_iceberg_bid_price
						//console.log( candleTime, total_iceberg_executed_ask )
						
					}
					else if(  bid !=0 || ((tick_counter+1) == hhists_data_array.length) ) 
					//else 
					{ 	// ask iceberg break
						total_iceberg_executed_bid += previous_iceberg_executed_bid
						var uniquePriceID =  start_iceberg_bid_price +'-'+ priceLow  +'_'+candleTime + '_'+ tick_id 
					
						iceberg_orders_data_obj ['bid'] [ uniquePriceID ] = total_iceberg_executed_bid
						
						//console.log( candleTime, uniquePriceID, total_iceberg_executed_ask )
						total_iceberg_executed_bid = 0
						previous_iceberg_executed_bid = bid
						start_iceberg_bid_price = priceLow
						//console.log( "hhists_data_array", hhists_data_array )
					}
					
					if( total_iceberg_executed_ask!=0 && ((tick_counter+1) == hhists_data_array.length) ) 
					//else 
					{ 	// ask iceberg break
						total_iceberg_executed_ask += previous_iceberg_executed_ask
						var uniquePriceID =  start_iceberg_ask_price +'-'+ priceLow  +'_'+candleTime + '_'+ tick_id 
					
						iceberg_orders_data_obj ['ask'] [ uniquePriceID ] = total_iceberg_executed_ask
						
						//console.log( candleTime, uniquePriceID, total_iceberg_executed_ask )
					
						//console.log( "hhists_data_array", hhists_data_array )
					}
					
					if( total_iceberg_executed_bid !=0 && ((tick_counter+1) == hhists_data_array.length) ) 
					//else 
					{ 	// ask iceberg break
						total_iceberg_executed_bid += previous_iceberg_executed_bid
						var uniquePriceID =  start_iceberg_bid_price +'-'+ priceLow  +'_'+candleTime + '_'+ tick_id 
					
						iceberg_orders_data_obj ['bid'] [ uniquePriceID ] = total_iceberg_executed_bid
						
						//console.log( candleTime, uniquePriceID, total_iceberg_executed_ask )
					
						//console.log( "hhists_data_array", hhists_data_array )
					}
					
					}
					
					previous_tick_difference = tick_difference
					
					// iceberg orders code ends here
					
					previous_tick_price = priceLow
					tick_counter ++
				}
				
				
				var current_candle_HighestVolBar = sortByVolumeSumDescending( single_candle_volume_profile_price_obj )[0]
				candlewise_highest_vol_price_obj[candleTime] = current_candle_HighestVolBar
				
				var returnedArray = sortByVolumeSumDescending2( candlewise_highest_vol_price_obj )
				
				if(returnedArray.length>10)
				{
					candlewise_highest_vol_price_obj2 [candleTime]  = returnedArray.slice(0,10)
				}
				else
				{
					candlewise_highest_vol_price_obj2 [candleTime]  = returnedArray
				}
				
				var sorted_total_volume_profile_price_obj = sortByVolumeSumDescending( total_volume_profile_price_obj )
				
				candlewise_highest_vol_price_obj2 [candleTime] ['total_ask'] = total_ask_bid['ask']
				candlewise_highest_vol_price_obj2 [candleTime] ['total_bid'] = total_ask_bid['bid']
				candlewise_highest_vol_price_obj2 [candleTime] ['poc'] = sorted_total_volume_profile_price_obj[0]
				
				if( highest_vol_price_arr.length==0 )
				{
					//highest_vol_price_arr.push( {[candleTime]:single_candle_volume_profile_price_obj} )
					highest_vol_price_arr.push( {[candleTime]:current_candle_HighestVolBar} )
				}
				else 
				{
					var lastEntry = highest_vol_price_arr[highest_vol_price_arr.length-1]
					//var lastEntryHighestVolBar = sortByVolumeSumDescending(lastEntry[Object.keys(lastEntry)])[0][1]
					var lastEntryHighestVolBar = lastEntry[Object.keys(lastEntry)][1]
					
					//console.log( lastEntryHighestVolBar, current_candle_HighestVolBar )
					if( current_candle_HighestVolBar[1][2] >= lastEntryHighestVolBar[2])
					{
						//highest_vol_price_arr.push( {[candleTime]:single_candle_volume_profile_price_obj} )
						highest_vol_price_arr.push( {[candleTime]:current_candle_HighestVolBar} )
					}
					
					//sortByVolumeSumDescending(total_volume_profile_price_obj)
					
				}
				
				
					
			
			}

		}

/*
		var graphicsCmds_data = currentDayData[c]['graphicsCmds'] ? currentDayData[c]['graphicsCmds']['create']['hhists'] 
												: currentDayData[c]['graphicsCmds']['create']['hhists'][0]['data'] : []
		
		user.profile?.city ? user.profile.city 
            : user.address?.city ? user.address.city 
            : "Unknown";
			*/
			
		//for( var t=0;t<graphicsCmds_data.length;t++ )
	}
	
	
	/*

			"currentDate":currentDate,
			//currentDayData,
			total_volume_profile_price_obj,
			total_ask_bid,
			sortedArray,
			highest_vol_price_arr,
			//candlewise_highest_vol_price_obj,
			//sortByVolumeSumDescending2( candlewise_highest_vol_price_obj ),
			candlewise_highest_vol_price_obj2,
			
console.log(  "highest_vol_price_arr", highest_vol_price_arr)
console.log(  "candlewise_highest_vol_price_obj", candlewise_highest_vol_price_obj)
console.log(  "candlewise_highest_vol_price_obj2", candlewise_highest_vol_price_obj2)
console.log(  "total_volume_profile_price_obj", total_volume_profile_price_obj)

var sorted_total_volume_profile_price_obj = sortByVolumeSumDescending( total_volume_profile_price_obj )
console.log(  "sorted_total_volume_profile_price_obj", sorted_total_volume_profile_price_obj)
*/
	
	
	//var timestamp = allEquityDataObj['timestamp']['data'].split(' ')[1]
	
	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => b[1] - a[1] ) )   // for sorting object ascending
	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => a[1] - b[1] ) )   // for sorting object descending
	var theadStr = '<thead class="tableRowClass">   <tr>      '
	+'<th>Time</th>'
	+'<th>Buy</th>'	//ask
	+'<th>Sell</th>' //bid
	+'<th>Ratio</th>' //bid
	+'<th>POC</th>' //bid
	
	+' <th>Data</th>'
	
	+' </tr></thead><tbody>'
	var tableStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="perticularStockMarketDepthOrderBookTableStr"><caption style="caption-side:top"> Market Depth Orders | '+selectedEquitySymbol+' | '+selectedTradingDate+' | '+'</caption>'+theadStr 
	//var optOILosersTablesStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="optPriceLosersTablesStr"><caption style="caption-side:top">Options Price Losers | '+selectedTradingDate+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	 
	//for ( var candleTime2 in candlewise_highest_vol_price_obj2 ) 
	{
	var candleTime2 = Object.keys(candlewise_highest_vol_price_obj2)[Object.keys(candlewise_highest_vol_price_obj2).length-1]
	//console.log("candleTime2", candleTime2)
	var dataArray = candlewise_highest_vol_price_obj2[candleTime2]
	var ratio = ''
	if( dataArray['total_ask'] >= dataArray['total_bid'] )
	{
		ratio = (dataArray['total_ask']/dataArray['total_bid']).toFixed(2) + ' Buy'
	}
	else
	{
		ratio = (dataArray['total_bid']/dataArray['total_ask']).toFixed(2) + ' Sell'
	}
	
	
	tableStr += '<tr class="item"><td>'
		//+ timeStampPrevious1+'-'+timeStamp
		+ candleTime2
		+'</td><td>'
		+ dataArray['total_ask']
		+'</td><td>'
		+ dataArray['total_bid']
		+'</td><td>'
		+ ratio
		+'</td><td>'
		+ dataArray['poc'][0]
		//+ timeStampOfData
		+'</td><td><table>'
		
	for(var element of dataArray )
	{

	
		tableStr += '<tr>'
		+'<td>'
		+ element[0]
		+'</td>'        
		
		+'<td>'
		+ element[1][0] 
		+'</td>'    
		
		+'<td>'
		+ ( Number( element[1][0].split('-')[1] ) - Number( element[1][0].split('-')[0] ) ).toFixed(2)
		+'</td>'    
		
		+'<td>'
		+ element[1][1][0]
		+'</td>'       

		+'<td>'
		+ element[1][1][1]
		+'</td>'        
		
		+'<td>'
		+ element[1][1][2]
		+'</td>'        
		
		+'</tr>'
		
	}
	
	tableStr +='</table></td></tr>'

		
		
	}
	
	tableStr +=' </tbody> </table>    </div>  </div>'
	//optOILosersTablesStr +=' </tbody> </table>    </div>  </div>'
	
	 document.getElementById('volumeProfile_EquityTableContainer').innerHTML = tableStr;
	 //document.getElementById('allSpurtsUnderlyingsColumnsContainer').innerHTML += tablesStrForNegative;
	 
	
	var theadStr = '<thead class="tableRowClass">   <tr>      '
	+'<th>Time</th>'
	+'<th>Buy</th>'	//ask
	+'<th>Sell</th>' //bid
	+'<th>Ratio</th>' //bid
	+'<th>POC</th>' //bid
	+' <th>Data</th>'
	
	+' </tr></thead><tbody>'
	var tableStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="perticularStockMarketDepthOrderBookTableStr2"><caption style="caption-side:top"> Market Depth Orders | '+selectedEquitySymbol+' | '+selectedTradingDate+' | '+'</caption>'+theadStr 
	//var optOILosersTablesStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="optPriceLosersTablesStr"><caption style="caption-side:top">Options Price Losers | '+selectedTradingDate+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	 
	for ( var candleTime2 in candlewise_highest_vol_price_obj2 ) {
	
	var dataArray = candlewise_highest_vol_price_obj2[candleTime2]
	var ratio = ''
	if( dataArray['total_ask'] >= dataArray['total_bid'] )
	{
		ratio = (dataArray['total_ask']/dataArray['total_bid']).toFixed(2) + ' Buy'
	}
	else
	{
		ratio = (dataArray['total_bid']/dataArray['total_ask']).toFixed(2) + ' Sell'
	}
	
	tableStr += '<tr class="item"><td>'
		//+ timeStampPrevious1+'-'+timeStamp
		+ candleTime2
		+'</td><td>'
		+ dataArray['total_ask']
		+'</td><td>'
		+ dataArray['total_bid']
		+'</td><td>'
		+ ratio
		+'</td><td>'
		+ dataArray['poc'][0]
		//+ timeStampOfData
		+'</td><td><table>'
		
	for(var element of dataArray )
	{
	
		tableStr += '<tr>'
		
		+'<td>'
		+ element[0]
		+'</td>'        
		
		+'<td>'
		+ element[1][0] 
		+'</td>'    
		
		+'<td>'
		+ ( Number( element[1][0].split('-')[1] ) - Number( element[1][0].split('-')[0] ) ).toFixed(2)
		+'</td>'    
				
		+'<td>'
		+ element[1][1][0]
		+'</td>'       

		+'<td>'
		+ element[1][1][1]
		+'</td>'        
		
		+'<td>'
		+ element[1][1][2]
		+'</td>'        
		
		+'</tr>'
		
	}
	
	tableStr +='</table></td></tr>'

		
		
	}
	
	tableStr +=' </tbody> </table>    </div>  </div>'
	//optOILosersTablesStr +=' </tbody> </table>    </div>  </div>'
	
	 document.getElementById('perticularEquityTableContainer2').innerHTML = tableStr;
	 //document.getElementById('allSpurtsUnderlyingsColumnsContainer').innerHTML += tablesStrForNegative;
	 
	 
	//console.log( 'iceberg_orders_data_obj', iceberg_orders_data_obj )
	highest_ask_bid_orders_tick_wise_obj = iceberg_orders_data_obj

	 
	var theadStr = '<thead class="tableRowClass">   <tr>      '
	+'<th>Time</th>'
	+'<th>Buy Price</th>'
	+'<th>Buy Quantity</th>'	//ask
	+'<th> &nbsp;&nbsp;&nbsp;&nbsp; </th>'	//ask
	+'<th>Time</th>' //bid
	+'<th>Sell Price</th>' //bid
	+'<th>Sell Quantity</th>' //bid
	
	
	+' </tr></thead><tbody>'
	var tableStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="highest_ask_bid_orders_tick_wise_TableStr"><caption style="caption-side:top"> Big Buy/Sell Orders | '+fromTime+' - '+toTime+' | '+selectedEquitySymbol+' | '+selectedTradingDate+' | '+'</caption>'+theadStr 
	//var optOILosersTablesStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="optPriceLosersTablesStr"><caption style="caption-side:top">Options Price Losers | '+selectedTradingDate+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	

	function sortByValueDesc(data) {
    const sortDescending = (obj) => {
        return Object.fromEntries(
            Object.entries(obj)
                .sort(([, valueA], [, valueB]) => valueB - valueA)
        );
    };

    return {
        ask: sortDescending(data.ask),
        bid: sortDescending(data.bid)
    };
}


 var sorted_highest_ask_bid_orders_tick_wise_obj  = sortByValueDesc(highest_ask_bid_orders_tick_wise_obj )
 //var sorted_highest_ask_bid_orders_tick_wise_obj  = sortByValueDesc(highest_ask_bid_orders_whole_candle_wise_obj  )
//console.log( 'sorted_highest_ask_bid_orders_tick_wise_obj', sorted_highest_ask_bid_orders_tick_wise_obj )

				
				var ask_keys = Object.keys(sorted_highest_ask_bid_orders_tick_wise_obj ['ask'] )
				var bid_keys = Object.keys(sorted_highest_ask_bid_orders_tick_wise_obj ['bid'] )

				//console.log("Reversed Ask:", reversedAsk);
				//console.log("Reversed Bid:", reversedBid);
				
				var array_for_loop = ask_keys.length > bid_keys.length ? ask_keys : bid_keys;
				
				
	//for ( var uniquePriceID in sorted_highest_ask_bid_orders_tick_wise_obj ['ask'] ) {
	//for ( var i=0;i< Object.keys(sorted_highest_ask_bid_orders_tick_wise_obj ['ask'] ).length;i++ ) {
	for ( var i=0;i< 20;i++ ) {
	//for( var i=0;i<array_for_loop.length;i++ ) {
	
	/*
	var uniquePriceID_ask = Object.keys(sorted_highest_ask_bid_orders_tick_wise_obj ['ask'] )[i]
	var uniquePriceID_bid = Object.keys(sorted_highest_ask_bid_orders_tick_wise_obj ['bid'] )[i]
	
	var quantity_ask = sorted_highest_ask_bid_orders_tick_wise_obj ['ask'] [ uniquePriceID_ask ]
	var quantity_bid = sorted_highest_ask_bid_orders_tick_wise_obj ['bid'] [ uniquePriceID_bid ]
	*/
	
	var uniquePriceID_ask = Object.keys(sorted_highest_ask_bid_orders_tick_wise_obj ['ask'] )[i] !== undefined ? Object.keys(sorted_highest_ask_bid_orders_tick_wise_obj ['ask'] )[i] :  '0_0_0';
	var uniquePriceID_bid = Object.keys(sorted_highest_ask_bid_orders_tick_wise_obj ['bid'] )[i] !== undefined ? Object.keys(sorted_highest_ask_bid_orders_tick_wise_obj ['bid'] )[i] :  '0_0_0';
	
	var quantity_ask = sorted_highest_ask_bid_orders_tick_wise_obj ['ask'] [ uniquePriceID_ask ] !== undefined ? sorted_highest_ask_bid_orders_tick_wise_obj ['ask'] [ uniquePriceID_ask ] : 0;
	var quantity_bid = sorted_highest_ask_bid_orders_tick_wise_obj ['bid'] [ uniquePriceID_bid ] !== undefined ? sorted_highest_ask_bid_orders_tick_wise_obj ['bid'] [ uniquePriceID_bid ] : 0;
	

	
	tableStr += '<tr class="item"><td>'
		//+ timeStampPrevious1+'-'+timeStamp
		+ uniquePriceID_ask.split('_')[1]
		+'</td><td>'
		
		+ uniquePriceID_ask.split('_')[0]
		+'</td><td>'
				
		//+'</td><td>'
		//+ ( Number( uniquePriceID_ask.split('-')[1].split('_')[0] ) - Number( uniquePriceID_ask.split('-')[0] ) ).toFixed(2)
		//+'</td><td>'
		
		+ quantity_ask
		+'</td><td>'
		+ '		'
		+'</td><td>'
		
		+ uniquePriceID_bid.split('_')[1]
		+'</td><td>'
		+ uniquePriceID_bid.split('_')[0]
		
		//+'</td><td>'
		//+ ( Number( uniquePriceID_bid.split('-')[1].split('_')[0]  ) - Number( uniquePriceID_bid.split('-')[0] ) ).toFixed(2)
		//+'</td><td>'
		
		+'</td><td>'
		+ quantity_bid
		
		//+ timeStampOfData
		+'</td>'
		
	tableStr +='</tr>'

		
		
	}
	
	tableStr +=' </tbody> </table>    </div>  </div>'
	//optOILosersTablesStr +=' </tbody> </table>    </div>  </div>'
	
	 document.getElementById('highest_ask_bid_orders_tick_wise_TableContainer').innerHTML = tableStr;
	 //document.getElementById('allSpurtsUnderlyingsColumnsContainer').innerHTML += tablesStrForNegative;
	 
	
	 
	var theadStr = '<thead class="tableRowClass">   <tr>      '
	+'<th>Time</th>'
	+'<th>POC</th>' //bid
	+'<th>POC Ask</th>' //bid
	+'<th>POC Bid</th>' //bid
	+'<th>Tot Buy</th>'	//ask
	+'<th>Tot Sell</th>' //bid
	+'<th>Ratio</th>' //bid
	
	//+' <th>Data</th>'
	
	+' </tr></thead><tbody>'
	var tableStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="poc_changes_timewise_TableStr"><caption style="caption-side:top"> POC Changes | '+selectedEquitySymbol+' | '+selectedTradingDate+' | '+'</caption>'+theadStr 
	//var optOILosersTablesStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="optPriceLosersTablesStr"><caption style="caption-side:top">Options Price Losers | '+selectedTradingDate+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	 //console.log("candlewise_highest_vol_price_obj2",candlewise_highest_vol_price_obj2)
	 var previous_poc_price = 0
	for ( var candleTime2 in candlewise_highest_vol_price_obj2 ) {
	
	var dataArray = candlewise_highest_vol_price_obj2[candleTime2]
	var ratio = ''
	var poc_price = dataArray['poc'][0]
	var poc_ask = dataArray['poc'][1][0]
	var poc_bid = dataArray['poc'][1][1]
	if( poc_price !=previous_poc_price )
	{
	
	if( dataArray['total_ask'] >= dataArray['total_bid'] )
	{
		ratio = (dataArray['total_ask']/dataArray['total_bid']).toFixed(2) + ' Buy'
	}
	else
	{
		ratio = (dataArray['total_bid']/dataArray['total_ask']).toFixed(2) + ' Sell'
	}
	
	
	tableStr += '<tr class="item"><td>'
		//+ timeStampPrevious1+'-'+timeStamp
		+ candleTime2
		+'</td><td>'
		+ dataArray['poc'][0]
		+'</td><td>'
		+ poc_ask
		+'</td><td>'
		+ poc_bid
		+'</td><td>'
		+ dataArray['total_ask']
		+'</td><td>'
		+ dataArray['total_bid']
		+'</td><td>'
		+ ratio
		
		//+ timeStampOfData
		//+'</td><td><table>'
		+'</td>'
		
		/*
	for(var element of dataArray )
	{
	
		tableStr += '<tr>'
		
		+'<td>'
		+ element[0]
		+'</td>'        
		
		+'<td>'
		+ element[1][0] 
		+'</td>'    
		
		+'<td>'
		+ element[1][1][0]
		+'</td>'       

		+'<td>'
		+ element[1][1][1]
		+'</td>'        
		
		+'<td>'
		+ element[1][1][2]
		+'</td>'        
		
		+'</tr>'
		
	}
	
	tableStr +='</table></td></tr>'
*/
		tableStr +='</tr>'
		
		 previous_poc_price = poc_price
		 
		}
	}
	
	
	tableStr +=' </tbody> </table>    </div>  </div>'
	//optOILosersTablesStr +=' </tbody> </table>    </div>  </div>'
	
	 document.getElementById('poc_changes_timewise_TableContainer').innerHTML = tableStr;
	 //document.getElementById('allSpurtsUnderlyingsColumnsContainer').innerHTML += tablesStrForNegative;
	 
	
	 await addEventListnerInTables()
}	//	show_spurts_in_oi_underlyings_Data() Function ENDS HERE



async function previousEntriesDataObj( selectedNumberOfPreviousEntries=1, selectedDifferenceBetweenEntries, passedDate, useCurrentTimeValue=false )
{
	//var returnedDataObj = await previousTradingDateObj2( 1, '29-Dec-2023' )
	
	var selectedEquityTimeRef = document.getElementById('equityTimeValues')
	var selectedEquityTimeValue = selectedEquityTimeRef.value
	//selectedEquityTimeRef.options[selectedEquityTimeRef.selectedIndex - 15].value

	 var loopCondition = true
	 var numberCounter = 0
	 var retryCounter = 0 // retry for any date only 3 times to exit from infinite loop
	 var specifiedPreviousDatesObj = {}
	 var selectedDate = passedDate; 
	  try {
	 while( loopCondition )
	 {
		 /*
		 if( numberCounter==0 && retryCounter ==0 && useCurrentDateDelivery==false )
		 { // 		 
			 selectedDate = passedDate; 
			 //retryCounter = 0
		 }
		 else if(  numberCounter!=0 || retryCounter >2 ) { // if already retried 3 times then use next trading date
			 //selectedDate = formatDate(new Date(new Date('02-Feb-2023')-1)) ; 
			 selectedDate = formatDate(new Date(new Date(selectedDate)-1)); 
			 retryCounter = 0 
		 }
		 
		 */
		 if( useCurrentTimeValue==false || numberCounter!=0 || retryCounter >1 ) { // if already retried 3 times then use next trading date
			 //selectedDate = formatDate(new Date(new Date('02-Feb-2023')-1)) ; 
			 //selectedDate = formatDate(new Date(new Date(selectedDate)-1)); 
			 
			 //selectedEquityTimeValue = selectedEquityTimeRef.options[selectedEquityTimeRef.selectedIndex - 1].value

			// Get the index of the element with a specific value
			var targetValue = selectedEquityTimeValue //'11:48:00';
			var targetIndex = Array.from(selectedEquityTimeRef).findIndex(selectedEquityTimeRef => selectedEquityTimeRef.textContent === targetValue);

			//selectedEquityTimeValue = selectedEquityTimeRef.options[targetIndex - 1].value
			selectedEquityTimeValue = selectedEquityTimeRef.options[targetIndex - Number(selectedDifferenceBetweenEntries) ].value

			 retryCounter = 0 
		 }
		 
		 //console.log("selectedDate",selectedDate)
		 var monthYear = getMonthYearFromDate(passedDate); // Output: "December 2023"
		 
		 //var docPath = '/December 2023/Delivery_Data/29-Dec-2023'
		 //var docPath = '/'+monthYear+'/Delivery_Data/'+selectedDate
		 var docPath = '/'+monthYear+'/'+passedDate+'/all_equity/'+selectedEquityTimeValue+'/'+selectedEquityTimeValue


		 //var allDerivativesDataArray = await fetchDerivativesCollectionData( docPathForSpurts )
		 var deliveryDataObj = await fetchAndSaveDataIDB( docPath );
		 //console.log(deliveryDataObj)
		 
		 if( Object.keys(deliveryDataObj).length>0 )
		 {
			//console.log( deliveryDataObj )
			 //deliveryDataObj = JSON.parse( deliveryDataObj )
			 specifiedPreviousDatesObj[ selectedEquityTimeValue ] = deliveryDataObj
			 
			 if( ( Number(selectedNumberOfPreviousEntries) -1 )==numberCounter )
			 { // if got specifed previous trading days data then exit from loop
				 loopCondition = false
			 }
			 
			 numberCounter++;
		 }
		 
		 retryCounter ++;
		 if( 2*Number( selectedNumberOfPreviousEntries )==retryCounter )
		 {
			// if we don't get data after so many retries then then exit from loop
				 loopCondition = false
		 }
		//console.log("retryCounter",retryCounter, selectedDate )
		//console.log("passedPrevDays",passedPrevDays, numberCounter, selectedEquityTimeValue )
		
	 }
	 //console.log("specifiedPreviousDatesObj", specifiedPreviousDatesObj)
		
	  // Code that might throw an error
	} catch (error) {
	  // Code to handle the error
	  console.log("there was error whiile getting data of previous entries", error)
	} finally {
	  // Code that will always run (optional)
	  return specifiedPreviousDatesObj;
	}
		 
	 
	 
	 
function formatDate(date) {
	date = new Date(date)
    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
    const day = String(date.getDate()).padStart(2, '0');
    const month = months[date.getMonth()];
    const year = date.getFullYear();
    return `${day}-${month}-${year}`;
}

function getMonthYearFromDate(date) {
	date = new Date(date)
    const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    const month = months[date.getMonth()];
    const year = date.getFullYear();
    return `${month} ${year}`;
}

	// await sleep(200)
 } //  async function previousTradingDateObj( passedPrevDays=1 ) ENDS HERE
 
	

async function showPerticularDerivativeData( selectedSpurtsTimeValue, selectedTradingDate, allDerivativesDataObj )
{

	 document.getElementById('perticularDerivativeTableContainer').innerHTML = "";
	 //document.getElementById('optionsDerivativesTableContainer').innerHTML = "";

	var onlySpurtsSelectedTime = selectedSpurtsTimeValue

	var selectedDerivativesSymbol = document.getElementById('derivativesSymbols').value
	//var spurtsInOIUnderlyingsObject = spurtsDataObj['data']
	//var niftyTotalMarketObject = equityDataObj ['data']


	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => b[1] - a[1] ) )   // for sorting object ascending
	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => a[1] - b[1] ) )   // for sorting object descending
	var theadStr = '<thead class="tableRowClass">   <tr>      '
	+'<th>Symbol</th>'
	+' <th>Type</th>'
	+' <th>LTP</th>'
	+'<th>Vol</th>   '
	+'<th>Val</th>      '
	+' <th>OI</th>'
	+' <th>COI</th>      '
	+' <th>%COI</th>      '
	+' <th>PremTO</th>      '
	+' <th>%Chng</th>      '
	//+' <th>TO</th>      '

	+' </tr></thead><tbody>'
	//var tablesStrFutures =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="futuresDerivativesTableStr"><caption style="caption-side:top"> Futures Derivatives | '+selectedTradingDate+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	var tablesStrOptions =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="optionsPerticularDerivativeTableStr"><caption style="caption-side:top">Options Derivatives | '+selectedTradingDate+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
		
	{
	//for( var symbol in allDerivativesDataObj ) {

	 var symbol = selectedDerivativesSymbol
	var dataObj = JSON.parse( allDerivativesDataObj[symbol]['data'] )
	
	for( var i=0; i< Object.keys( dataObj ).length ; i++ ) {
	//for( var i=0; i< 9 ; i++ ) {
	var identifier = Object.keys( dataObj )[i]
	//if( identifier.includes('FUTSTK')==true || identifier.includes('OPTSTK')==true )
	if( identifier.includes('OPTSTK')==true && document.getElementById('optionsCheckbox').checked )
	{
		//console.log(symbol, identifier, dataObj[ identifier ])
		var dataArray = dataObj[ identifier ]
		
		
		var strikePrice;
		var expirtDate;
		
		if( identifier.includes('CE') ==true ) 
		{
		strikePrice = "CE "+Number( identifier.split('CE')[1] )
		expirtDate = formatDate( identifier.split('CE')[0].split('STK')[1] );

		
		}
		else if( identifier.includes('PE') ==true ) 
		{
		strikePrice = "PE "+Number( identifier.split('PE')[1] )
		expirtDate = formatDate( identifier.split('PE')[0].split('STK')[1] );
		}
			
		
		identifier = identifier.split('STK')[0]
		
			//if( symbol.includes('NIFTY')==false )
			{

		tablesStrOptions +='<tr class="item"><td>'
		+ symbol
		+'</td><td>'
		//+ identifier // fur/opt
		+ strikePrice + ' ('+expirtDate +')'// fur/opt
		+'</td><td>'
		+ dataArray[3] // ltp
		+'</td><td>'
		+ dataArray[7] //"numberOfContractsTraded"
		+'</td><td>'
		+ dataArray[8] //"totalTurnover"
		+'</td><td>'
	 	  + dataArray[9][0]  //"OpenInterest"
	 	  //+ dataArray[9][4]  //""tradedVolume""
		+'</td><td>'
		+ dataArray[9][1] // ""changeinOpenInterest""
		+'</td><td>'
		+ dataArray[9][2].toFixed(2)// "pchangeinOpenInterest"
		+'</td><td>'
		+ dataArray[9][3].toFixed(0) // "premiumTurnover"
		+'</td><td>'
		+ dataArray[5].toFixed(2) // "pchange"
		//+'</td><td>'
		//+ dataArray[9][5] // "value"
		+'</td></tr>'
		}
	}	
	else if( identifier.includes('FUTSTK')==true && document.getElementById('futuresCheckbox').checked )
	{
		//console.log(symbol, identifier, dataObj[ identifier ])
		var dataArray = dataObj[ identifier ]
		identifier = identifier.split('STK')[0]
		
			//if( symbol.includes('NIFTY')==false )
			{

		tablesStrOptions +='<tr class="item"><td>'
			+ symbol
		+'</td><td>'
		//+ identifier // fur/opt
		+ identifier // fur/opt
		+'</td><td>'
		+ dataArray[3] // ltp
		+'</td><td>'
		+ dataArray[7] //"numberOfContractsTraded"
		+'</td><td>'
		+ dataArray[8] //"totalTurnover"
		+'</td><td>'
	 	  + dataArray[9][0]  //"OpenInterest"
	 	  //+ dataArray[9][4]  //""tradedVolume""
		+'</td><td>'
		+ dataArray[9][1] // ""changeinOpenInterest""
		+'</td><td>'
		+ dataArray[9][2].toFixed(2)// "pchangeinOpenInterest"
		+'</td><td>'
		+ dataArray[9][3].toFixed(0) // "premiumTurnover"
		+'</td><td>'
		+ dataArray[5].toFixed(2) // "pchange"
		//+'</td><td>'
		//+ dataArray[9][5] // "value"
		+'</td></tr>'
		}
	}
	}
	
	
	
	}
	//tablesStrFutures +=' </tbody> </table>    </div>  </div>'
	tablesStrOptions +=' </tbody> </table>    </div>  </div>'


	
	 //document.getElementById('futuresDerivativesTableContainer').innerHTML = tablesStrFutures;
	 document.getElementById('perticularDerivativeTableContainer').innerHTML = tablesStrOptions;
	 //document.getElementById('allSpurtsUnderlyingsColumnsContainer').innerHTML += tablesStrForNegative;
	 
	// await addEventListnerInTables()
}	//	show_spurts_in_oi_underlyings_Data() Function ENDS HERE


async function calculateFutOptData2( selectedSpurtsTimeValue, selectedTradingDate, allDerivativesDataObj )
{
	
	var optionsOIPerChngObj = {}
	var optionsPricePerChngObj = {}
	var optionsTurnoverObj = {}
	var allOptionsTurnoverObj = {}
	
	var futuresOIPerChngObj = {}
	var futuresPricePerChngObj = {}
	var futuresTurnoverObj = {}
	var allFuturesTurnoverObj = {}

	for( var symbol in allDerivativesDataObj ) {

	var dataObj = JSON.parse( allDerivativesDataObj[symbol]['data'] )
	
	for( var i=0; i< Object.keys( dataObj ).length ; i++ ) {
	//for( var i=0; i< 7 ; i++ ) {
	var identifier = Object.keys( dataObj )[i]
	//if( identifier.includes('FUTSTK')==true || identifier.includes('OPTSTK')==true )
	if( identifier.includes('OPTSTK')==true )
	{
		//console.log(symbol, identifier, dataObj[ identifier ])
		var dataArray = dataObj[ identifier ]
		var pchangeinOpenInterest = Number( dataArray[9][2].toFixed(2) ) // "pchangeinOpenInterest"
		if( pchangeinOpenInterest > 1 || pchangeinOpenInterest < 0  )
		{
			optionsOIPerChngObj [ symbol+'_'+identifier  ] = pchangeinOpenInterest
		}
		optionsPricePerChngObj [ symbol+'_'+identifier  ] = dataArray[5] // "pChange"
		//optionsTurnoverObj [ symbol+'_'+identifier  ] = dataArray[8] // "totalTurnover/value"
		optionsTurnoverObj [ symbol+'_'+identifier  ] = dataArray[7] // "numberOfContractsTraded/tradedVolume"
		
		if( allOptionsTurnoverObj [ symbol ]==undefined )
		{
			//allOptionsTurnoverObj [ symbol ] = Number( dataArray[7] )// "numberOfContractsTraded/tradedVolume"
			allOptionsTurnoverObj [ symbol ] = Number( dataArray[8] )// "totalTurnover/value"
		}
		else{
			//allOptionsTurnoverObj [ symbol ] += Number( dataArray[7] )// "numberOfContractsTraded/tradedVolume"
			allOptionsTurnoverObj [ symbol ] += Number( dataArray[8] )// "totalTurnover/value"
		}
		
		
	}
	else if( identifier.includes('FUTSTK')==true )
	{
		//console.log(symbol, identifier, dataObj[ identifier ])
		var dataArray = dataObj[ identifier ]
		var pchangeinOpenInterest = Number( dataArray[9][2].toFixed(2) ) // "pchangeinOpenInterest"
		if( pchangeinOpenInterest > 1 ||  pchangeinOpenInterest < 0 )
		{
			futuresOIPerChngObj [ symbol+'_'+identifier  ] = pchangeinOpenInterest
		}
		futuresPricePerChngObj [ symbol+'_'+identifier  ] = dataArray[5] // "pChange"
		//futuresTurnoverObj [ symbol+'_'+identifier  ] = dataArray[8] // "totalTurnover/value"
		futuresTurnoverObj [ symbol+'_'+identifier  ] = dataArray[7] // "numberOfContractsTraded/tradedVolume"

		if( allFuturesTurnoverObj [ symbol ]==undefined )
		{
			//allFuturesTurnoverObj [ symbol ] = Number( dataArray[7] )// "numberOfContractsTraded/tradedVolume"
			allFuturesTurnoverObj [ symbol ] = Number( dataArray[8] )// "totalTurnover/value"
		}
		else{
			//allFuturesTurnoverObj [ symbol ] += Number( dataArray[7] )// "numberOfContractsTraded/tradedVolume"
			allFuturesTurnoverObj [ symbol ] += Number( dataArray[8] )// "totalTurnover/value"
		}
		
	}
	}
	

	}
	
	
	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => b[1] - a[1] ) )   // for sorting object ascending
	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => a[1] - b[1] ) )   // for sorting object descending
	
	optionsOIPerChngObj = Object.fromEntries( Object.entries(optionsOIPerChngObj).sort( (a,b) => b[1] - a[1] )  ) 
	futuresOIPerChngObj = Object.fromEntries( Object.entries(futuresOIPerChngObj).sort( (a,b) => b[1] - a[1] ) ) 
	
	optionsPricePerChngObj = Object.fromEntries( Object.entries(optionsPricePerChngObj).sort( (a,b) => b[1] - a[1] ) ) 
	futuresPricePerChngObj = Object.fromEntries( Object.entries(futuresPricePerChngObj).sort( (a,b) => b[1] - a[1] ) ) 
	
	optionsTurnoverObj = Object.fromEntries( Object.entries(optionsTurnoverObj).sort( (a,b) => b[1] - a[1] )  ) 
	futuresTurnoverObj = Object.fromEntries( Object.entries(futuresTurnoverObj).sort( (a,b) => b[1] - a[1] )  ) 
	
	allOptionsTurnoverObj = Object.fromEntries( Object.entries(allOptionsTurnoverObj).sort( (a,b) => b[1] - a[1] )  ) 
	allFuturesTurnoverObj = Object.fromEntries( Object.entries(allFuturesTurnoverObj).sort( (a,b) => b[1] - a[1] )  ) 
	
	showOptOIGainersLosersStocks( selectedSpurtsTimeValue, selectedTradingDate, optionsOIPerChngObj )
	showOptPricePerChngStocks( selectedSpurtsTimeValue, selectedTradingDate, optionsPricePerChngObj )
	
	showFutOIGainersLosersStocks( selectedSpurtsTimeValue, selectedTradingDate, futuresOIPerChngObj )
	showFutPricePerChngStocks( selectedSpurtsTimeValue, selectedTradingDate, futuresPricePerChngObj )
	
	showOptMostActiveStocks( selectedSpurtsTimeValue, selectedTradingDate, optionsTurnoverObj )
	showFutMostActiveStocks( selectedSpurtsTimeValue, selectedTradingDate, futuresTurnoverObj )
	

	showMostActiveOptStocks( selectedSpurtsTimeValue, selectedTradingDate, allOptionsTurnoverObj )
	showMostActiveFutStocks( selectedSpurtsTimeValue, selectedTradingDate, allFuturesTurnoverObj )
	
	//console.log( optionsOIPerChngObj, futuresOIPerChngObj 	)
	//console.log( optionsPricePerChngObj, futuresPricePerChngObj 	)
	//console.log( optionsTurnoverObj, futuresTurnoverObj 	)
	
	// await addEventListnerInTables()
}	//	show_spurts_in_oi_underlyings_Data() Function ENDS HERE


async function showMostActiveOptStocks( selectedSpurtsTimeValue, selectedTradingDate, passedDataObj )
{
	
	 document.getElementById('mostActiveOptStocksTableContainer').innerHTML = "";
	 //document.getElementById('optPriceLosersTableContainer').innerHTML = "";

	var onlySpurtsSelectedTime = selectedSpurtsTimeValue

	var allSymbolsLength = firestoreIndexObj[ selectedTradingDate ]['all_derivatives_index']['all_symbols'].length-1
	var availableSymbolsLengthStr = Object.keys( passedDataObj ).length+' / '+allSymbolsLength
	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => b[1] - a[1] ) )   // for sorting object ascending
	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => a[1] - b[1] ) )   // for sorting object descending
	var theadStr = '<thead class="tableRowClass">   <tr>      '
	+'<th>Symbol</th>'
	+' <th>TO</th>'


	+' </tr></thead><tbody>'
	var optMostActiveTablesStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="mostActiveOptStocksTablesStr"><caption style="caption-side:top"> Most Active Opt Stocks | '+availableSymbolsLengthStr+' | '+selectedTradingDate+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	//var optOILosersTablesStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="optPriceLosersTablesStr"><caption style="caption-side:top">Options Price Losers | '+selectedTradingDate+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	
	function returnDataStr( symbol, data )
	{

		var tablesStr = '<tr class="item"><td>'
		+ symbol
		+'</td><td>'
		+ data.toFixed(0)
		+'</td></tr>'
		
		return tablesStr;
	}

	for( var i=0; i< Object.keys( passedDataObj ).length ; i++ ) {
	//for( var i=0; i< 50 ; i++ ) {
	//var symbol = symbolStr.split('_')[0]
	var symbolStr = Object.keys( passedDataObj )[i]
	var symbolStrBackward = Object.keys( passedDataObj )[ Object.keys( passedDataObj ).length -1 - i ]
	
	{
		//var symbol = symbolStr.split('_')[0]
		var symbol = symbolStr
		//var dataObj = JSON.parse( allDerivativesDataObj[symbol]['data'] )
		var data = passedDataObj[symbol]
		//var identifier = symbolStr.split('_')[1]
		//console.log( symbol )
		optMostActiveTablesStr +=	returnDataStr( symbol, data )
		
		
	}
		

	}
	
	optMostActiveTablesStr +=' </tbody> </table>    </div>  </div>'
	//optOILosersTablesStr +=' </tbody> </table>    </div>  </div>'


	
	 document.getElementById('mostActiveOptStocksTableContainer').innerHTML = optMostActiveTablesStr;
	 //document.getElementById('optPriceLosersTableContainer').innerHTML = optOILosersTablesStr;

	// await addEventListnerInTables()
}	//	show_spurts_in_oi_underlyings_Data() Function ENDS HERE

async function showMostActiveFutStocks( selectedSpurtsTimeValue, selectedTradingDate, passedDataObj )
{
	
	 document.getElementById('mostActiveFutStocksTableContainer').innerHTML = "";
	 //document.getElementById('optPriceLosersTableContainer').innerHTML = "";

	var onlySpurtsSelectedTime = selectedSpurtsTimeValue

	var allSymbolsLength = firestoreIndexObj[ selectedTradingDate ]['all_derivatives_index']['all_symbols'].length-1
	var availableSymbolsLengthStr = Object.keys( passedDataObj ).length+' / '+allSymbolsLength
	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => b[1] - a[1] ) )   // for sorting object ascending
	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => a[1] - b[1] ) )   // for sorting object descending
	var theadStr = '<thead class="tableRowClass">   <tr>      '
	+'<th>Symbol</th>'
	+' <th>TO</th>'


	+' </tr></thead><tbody>'
	var optMostActiveTablesStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="mostActiveFutStocksTablesStr"><caption style="caption-side:top"> Most Active Fut Stocks | '+availableSymbolsLengthStr+' | '+selectedTradingDate+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	//var optOILosersTablesStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="optPriceLosersTablesStr"><caption style="caption-side:top">Options Price Losers | '+selectedTradingDate+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	
	function returnDataStr( symbol, data )
	{

		var tablesStr = '<tr class="item"><td>'
		+ symbol
		+'</td><td>'
		+ data.toFixed(0)
		+'</td></tr>'
		
		return tablesStr;
	}

	for( var i=0; i< Object.keys( passedDataObj ).length ; i++ ) {
	//for( var i=0; i< 50 ; i++ ) {
	//var symbol = symbolStr.split('_')[0]
	var symbolStr = Object.keys( passedDataObj )[i]
	var symbolStrBackward = Object.keys( passedDataObj )[ Object.keys( passedDataObj ).length -1 - i ]
	
	{
		//var symbol = symbolStr.split('_')[0]
		var symbol = symbolStr
		//var dataObj = JSON.parse( allDerivativesDataObj[symbol]['data'] )
		var data = passedDataObj[symbol]
		//var identifier = symbolStr.split('_')[1]
		//console.log( symbol )
		optMostActiveTablesStr +=	returnDataStr( symbol, data )
		
		
	}
		

	}
	
	optMostActiveTablesStr +=' </tbody> </table>    </div>  </div>'
	//optOILosersTablesStr +=' </tbody> </table>    </div>  </div>'


	
	 document.getElementById('mostActiveFutStocksTableContainer').innerHTML = optMostActiveTablesStr;
	 //document.getElementById('optPriceLosersTableContainer').innerHTML = optOILosersTablesStr;

	// await addEventListnerInTables()
}	//	show_spurts_in_oi_underlyings_Data() Function ENDS HERE


async function showFutMostActiveStocks( selectedSpurtsTimeValue, selectedTradingDate, passedDataObj )
{
	
	
	 document.getElementById('futuresDerivativesTableContainer').innerHTML = "";
	 //document.getElementById('optPriceLosersTableContainer').innerHTML = "";

	var onlySpurtsSelectedTime = selectedSpurtsTimeValue


	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => b[1] - a[1] ) )   // for sorting object ascending
	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => a[1] - b[1] ) )   // for sorting object descending
	var theadStr = '<thead class="tableRowClass">   <tr>      '
	+'<th>Symbol</th>'
	+' <th>Type</th>'
	+' <th>LTP</th>'
	+'<th>Vol</th>   '
	//+'<th>Val</th>      '
	+' <th>OI</th>'
	+' <th>COI</th>      '
	+' <th>%COI</th>      '
	//+' <th>%price</th>      '
	+' <th>PremTO</th>      '
	//+' <th>TVol</th>      '
	//+' <th>TO</th>      '

	+' </tr></thead><tbody>'
	var futMostActiveTablesStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="futMostActiveTablesStr"><caption style="caption-side:top"> Futures Most Active | '+selectedTradingDate+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	//var optOILosersTablesStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="optPriceLosersTablesStr"><caption style="caption-side:top">Options Price Losers | '+selectedTradingDate+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	
	function returnDataStr( symbol, identifier, dataArray )
	{
				var strikePrice;
		if( identifier.includes('CE') ==true ) 
			strikePrice =  "CE "+Number( identifier.split('CE')[1] ) +" ("+ formatDateMonth( identifier.split('CE')[0].split('STK')[1] ) +")"
		else if( identifier.includes('PE') ==true ) 
			strikePrice = "PE "+Number( identifier.split('PE')[1] ) +" ("+ formatDateMonth( identifier.split('PE')[0].split('STK')[1] ) +")"
		else if( identifier.includes('FUT') ==true ) 
			strikePrice = formatMonth( identifier.split('STK')[1].split('XX')[0] ) + " FUT"
		
		var tablesStr = '<tr class="item"><td>'
		+ symbol
		+'</td><td>'
		//+ identifier // fur/opt
		+ strikePrice // fur/opt
		+'</td><td>'
		+ dataArray[3] // ltp
		+'</td><td>'
		+ dataArray[7] //"numberOfContractsTraded"
		//+'</td><td>'
		//+ dataArray[8] //"totalTurnover"
		+'</td><td>'
	 	  + dataArray[9][0]  //"OpenInterest"
	 	  //+ dataArray[9][4]  //""tradedVolume""
		+'</td><td>'
		+ dataArray[9][1] // ""changeinOpenInterest""
		+'</td><td>'
		+ dataArray[9][2].toFixed(2)// "pchangeinOpenInterest"
		//+ dataArray[5].toFixed(2)  // "pChange"
		+'</td><td>'
		+ dataArray[9][3].toFixed(0) // "premiumTurnover"
		//+'</td><td>'
		//+ dataArray[9][4] // "tradedVolume"
		//+'</td><td>'
		//+ dataArray[9][5] // "value"
		+'</td></tr>'
		
		return tablesStr;
	}

	//for( var i=0; i< Object.keys( passedDataObj ).length ; i++ ) {
	for( var i=0; i< 50 ; i++ ) {
	//var symbol = symbolStr.split('_')[0]
	var symbolStr = Object.keys( passedDataObj )[i]
	var symbolStrBackward = Object.keys( passedDataObj )[ Object.keys( passedDataObj ).length -1 - i ]
	
	{
		var symbol = symbolStr.split('_')[0]
		var dataObj = JSON.parse( allDerivativesDataObj[symbol]['data'] )
		var identifier = symbolStr.split('_')[1]
		
		//console.log(symbol, identifier, dataObj[ identifier ])
		var dataArray = dataObj[ identifier ]
		
		
			//if( symbol.includes('NIFTY')==false )
			{

			futMostActiveTablesStr +=	returnDataStr( symbol, identifier, dataArray )
		
		}
	}
		

	}
	
	futMostActiveTablesStr +=' </tbody> </table>    </div>  </div>'
	//optOILosersTablesStr +=' </tbody> </table>    </div>  </div>'


	
	 document.getElementById('futuresDerivativesTableContainer').innerHTML = futMostActiveTablesStr;
	 //document.getElementById('optPriceLosersTableContainer').innerHTML = optOILosersTablesStr;

	// await addEventListnerInTables()
}	//	show_spurts_in_oi_underlyings_Data() Function ENDS HERE

async function showOptOIGainersLosersStocks( selectedSpurtsTimeValue, selectedTradingDate, passedDataObj )
{
	
	 document.getElementById('optOIGainersTableContainer').innerHTML = "";
	 document.getElementById('optOILosersTableContainer').innerHTML = "";

	var onlySpurtsSelectedTime = selectedSpurtsTimeValue


	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => b[1] - a[1] ) )   // for sorting object ascending
	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => a[1] - b[1] ) )   // for sorting object descending
	var theadStr = '<thead class="tableRowClass">   <tr>      '
	+'<th>Symbol</th>'
	+' <th>Type</th>'
	+' <th>LTP</th>'
	//+'<th>Vol</th>   '
	+'<th>Val</th>      '
	+' <th>OI</th>'
	+' <th>COI</th>      '
	+' <th>%COI</th>      '
	+' <th>PremTO</th>      '
	//+' <th>TVol</th>      '
	//+' <th>TO</th>      '

	+' </tr></thead><tbody>'
	var optOIGainersTablesStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="optOIGainersTablesStr"><caption style="caption-side:top"> Options OI Gainers | '+selectedTradingDate+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	var optOILosersTablesStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="optOILosersTablesStr"><caption style="caption-side:top">Options OI Losers | '+selectedTradingDate+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	
	function returnDataStr( symbol, identifier, dataArray )
	{
	
		var strikePrice;
		if( identifier.includes('CE') ==true ) 
			strikePrice =  "CE "+Number( identifier.split('CE')[1] ) +" ("+ formatDateMonth( identifier.split('CE')[0].split('STK')[1] ) +")"
		else if( identifier.includes('PE') ==true ) 
			strikePrice = "PE "+Number( identifier.split('PE')[1] ) +" ("+ formatDateMonth( identifier.split('PE')[0].split('STK')[1] ) +")"
		else if( identifier.includes('FUT') ==true ) 
			strikePrice = formatMonth( identifier.split('STK')[1].split('XX')[0] ) + " FUT"
		
		
		var tablesStr = '<tr class="item"><td>'
		+ symbol
		+'</td><td>'
		//+ identifier // fur/opt
		+ strikePrice // fur/opt
		+'</td><td>'
		+ dataArray[3] // ltp
		+'</td><td>'
		//+ dataArray[7] //"numberOfContractsTraded"
		//+'</td><td>'
		+ dataArray[8] //"totalTurnover"
		+'</td><td>'
	 	  + dataArray[9][0]  //"OpenInterest"
	 	  //+ dataArray[9][4]  //""tradedVolume""
		+'</td><td>'
		+ dataArray[9][1] // ""changeinOpenInterest""
		+'</td><td>'
		+ dataArray[9][2].toFixed(2)// "pchangeinOpenInterest"
		+'</td><td>'
		+ dataArray[9][3].toFixed(0) // "premiumTurnover"
		//+'</td><td>'
		//+ dataArray[9][4] // "tradedVolume"
		//+'</td><td>'
		//+ dataArray[9][5] // "value"
		+'</td></tr>'
		
		return tablesStr;
	}

	//for( var i=0; i< Object.keys( passedDataObj ).length ; i++ ) {
	for( var i=0; i< 50 ; i++ ) {
	//var symbol = symbolStr.split('_')[0]
	var symbolStr = Object.keys( passedDataObj )[i]
	var symbolStrBackward = Object.keys( passedDataObj )[ Object.keys( passedDataObj ).length -1 - i ]
	
	{
		var symbol = symbolStr.split('_')[0]
		var dataObj = JSON.parse( allDerivativesDataObj[symbol]['data'] )
		var identifier = symbolStr.split('_')[1]
		
		//console.log(symbol, identifier, dataObj[ identifier ])
		var dataArray = dataObj[ identifier ]
		
	
			//if( symbol.includes('NIFTY')==false )
			{

	//optOILosersTablesStr
			optOIGainersTablesStr +=	returnDataStr( symbol, identifier, dataArray )
		
		}
	}
		
	{
		var symbol = symbolStrBackward.split('_')[0]
		var dataObj = JSON.parse( allDerivativesDataObj[symbol]['data'] )
		var identifier = symbolStrBackward.split('_')[1]
		
		//console.log(symbol, identifier, dataObj[ identifier ])
		var dataArray = dataObj[ identifier ]
		
		
	
			//if( symbol.includes('NIFTY')==false )
			{

		//optOILosersTablesStr
		optOILosersTablesStr += returnDataStr( symbol, identifier, dataArray )
		
		}
	}
	
	}
	
	optOIGainersTablesStr +=' </tbody> </table>    </div>  </div>'
	optOILosersTablesStr +=' </tbody> </table>    </div>  </div>'


	
	 document.getElementById('optOIGainersTableContainer').innerHTML = optOIGainersTablesStr;
	 document.getElementById('optOILosersTableContainer').innerHTML = optOILosersTablesStr;

}	//	Function ENDS HERE

async function showOptPricePerChngStocks( selectedSpurtsTimeValue, selectedTradingDate, passedDataObj )
{
	
	 document.getElementById('optPriceGainersTableContainer').innerHTML = "";
	 document.getElementById('optPriceLosersTableContainer').innerHTML = "";

	var onlySpurtsSelectedTime = selectedSpurtsTimeValue


	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => b[1] - a[1] ) )   // for sorting object ascending
	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => a[1] - b[1] ) )   // for sorting object descending
	var theadStr = '<thead class="tableRowClass">   <tr>      '
	+'<th>Symbol</th>'
	+' <th>Type</th>'
	+' <th>LTP</th>'
	//+'<th>Vol</th>   '
	+'<th>Val</th>      '
	+' <th>OI</th>'
	+' <th>COI</th>      '
	//+' <th>%COI</th>      '
	+' <th>%price</th>      '
	+' <th>PremTO</th>      '
	//+' <th>TVol</th>      '
	//+' <th>TO</th>      '

	+' </tr></thead><tbody>'
	var optOIGainersTablesStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="optPriceGainersTablesStr"><caption style="caption-side:top"> Options Price Gainers | '+selectedTradingDate+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	var optOILosersTablesStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="optPriceLosersTablesStr"><caption style="caption-side:top">Options Price Losers | '+selectedTradingDate+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	
	function returnDataStr( symbol, identifier, dataArray )
	{
				var strikePrice;
		if( identifier.includes('CE') ==true ) 
			strikePrice =  "CE "+Number( identifier.split('CE')[1] ) +" ("+ formatDateMonth( identifier.split('CE')[0].split('STK')[1] ) +")"
		else if( identifier.includes('PE') ==true ) 
			strikePrice = "PE "+Number( identifier.split('PE')[1] ) +" ("+ formatDateMonth( identifier.split('PE')[0].split('STK')[1] ) +")"
		else if( identifier.includes('FUT') ==true ) 
			strikePrice = formatMonth( identifier.split('STK')[1].split('XX')[0] ) + " FUT"
		
		var tablesStr = '<tr class="item"><td>'
		+ symbol
		+'</td><td>'
		//+ identifier // fur/opt
		+ strikePrice // fur/opt
		+'</td><td>'
		+ dataArray[3] // ltp
		+'</td><td>'
		//+ dataArray[7] //"numberOfContractsTraded"
		//+'</td><td>'
		+ dataArray[8] //"totalTurnover"
		+'</td><td>'
	 	  + dataArray[9][0]  //"OpenInterest"
	 	  //+ dataArray[9][4]  //""tradedVolume""
		+'</td><td>'
		+ dataArray[9][1] // ""changeinOpenInterest""
		+'</td><td>'
		//+ dataArray[9][2].toFixed(2)// "pchangeinOpenInterest"
		+ dataArray[5].toFixed(2)  // "pChange"
		+'</td><td>'
		+ dataArray[9][3].toFixed(0) // "premiumTurnover"
		//+'</td><td>'
		//+ dataArray[9][4] // "tradedVolume"
		//+'</td><td>'
		//+ dataArray[9][5] // "value"
		+'</td></tr>'
		
		return tablesStr;
	}

	//for( var i=0; i< Object.keys( passedDataObj ).length ; i++ ) {
	for( var i=0; i< 50 ; i++ ) {
	//var symbol = symbolStr.split('_')[0]
	var symbolStr = Object.keys( passedDataObj )[i]
	var symbolStrBackward = Object.keys( passedDataObj )[ Object.keys( passedDataObj ).length -1 - i ]
	
	{
		var symbol = symbolStr.split('_')[0]
		var dataObj = JSON.parse( allDerivativesDataObj[symbol]['data'] )
		var identifier = symbolStr.split('_')[1]
		
		//console.log(symbol, identifier, dataObj[ identifier ])
		var dataArray = dataObj[ identifier ]
		
		
			//if( symbol.includes('NIFTY')==false )
			{

	//optOILosersTablesStr
			optOIGainersTablesStr +=	returnDataStr( symbol, identifier, dataArray )
		
		}
	}
		
	{
		var symbol = symbolStrBackward.split('_')[0]
		var dataObj = JSON.parse( allDerivativesDataObj[symbol]['data'] )
		var identifier = symbolStrBackward.split('_')[1]
		
		//console.log(symbol, identifier, dataObj[ identifier ])
		var dataArray = dataObj[ identifier ]
		
		
			//if( symbol.includes('NIFTY')==false )
			{

		//optOILosersTablesStr
		optOILosersTablesStr += returnDataStr( symbol, identifier, dataArray )
		
		}
	}
	
	}
	
	optOIGainersTablesStr +=' </tbody> </table>    </div>  </div>'
	optOILosersTablesStr +=' </tbody> </table>    </div>  </div>'


	
	 document.getElementById('optPriceGainersTableContainer').innerHTML = optOIGainersTablesStr;
	 document.getElementById('optPriceLosersTableContainer').innerHTML = optOILosersTablesStr;

}	//	Function ENDS HERE

async function showFutOIGainersLosersStocks( selectedSpurtsTimeValue, selectedTradingDate, passedDataObj )
{
	
	 document.getElementById('futOIGainersTableContainer').innerHTML = "";
	 document.getElementById('futOILosersTableContainer').innerHTML = "";

	var onlySpurtsSelectedTime = selectedSpurtsTimeValue


	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => b[1] - a[1] ) )   // for sorting object ascending
	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => a[1] - b[1] ) )   // for sorting object descending
	var theadStr = '<thead class="tableRowClass">   <tr>      '
	+'<th>Symbol</th>'
	+' <th>Type</th>'
	+' <th>LTP</th>'
	//+'<th>Vol</th>   '
	+'<th>Val</th>      '
	+' <th>OI</th>'
	+' <th>COI</th>      '
	+' <th>%COI</th>      '
	+' <th>PremTO</th>      '
	//+' <th>TVol</th>      '
	//+' <th>TO</th>      '

	+' </tr></thead><tbody>'
	var futOIGainersTablesStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="futOIGainersTablesStr"><caption style="caption-side:top"> Futures OI Gainers | '+selectedTradingDate+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	var futOILosersTablesStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="futOILosersTablesStr"><caption style="caption-side:top">Futures OI Losers | '+selectedTradingDate+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	
	function returnDataStr( symbol, identifier, dataArray )
	{
		
			var strikePrice;
		if( identifier.includes('CE') ==true ) 
			strikePrice =  "CE "+Number( identifier.split('CE')[1] ) +" ("+ formatDateMonth( identifier.split('CE')[0].split('STK')[1] ) +")"
		else if( identifier.includes('PE') ==true ) 
			strikePrice = "PE "+Number( identifier.split('PE')[1] ) +" ("+ formatDateMonth( identifier.split('PE')[0].split('STK')[1] ) +")"
		else if( identifier.includes('FUT') ==true ) 
			strikePrice = formatMonth( identifier.split('STK')[1].split('XX')[0] ) + " FUT"
		
		
		var tablesStr = '<tr class="item"><td>'
		+ symbol
		+'</td><td>'
		//+ identifier // fur/opt
		+ strikePrice // fur/opt
		+'</td><td>'
		+ dataArray[3] // ltp
		+'</td><td>'
		//+ dataArray[7] //"numberOfContractsTraded"
		//+'</td><td>'
		+ dataArray[8] //"totalTurnover"
		+'</td><td>'
	 	  + dataArray[9][0]  //"OpenInterest"
	 	  //+ dataArray[9][4]  //""tradedVolume""
		+'</td><td>'
		+ dataArray[9][1] // ""changeinOpenInterest""
		+'</td><td>'
		+ dataArray[9][2].toFixed(2)// "pchangeinOpenInterest"
		+'</td><td>'
		+ dataArray[9][3].toFixed(0) // "premiumTurnover"
		//+'</td><td>'
		//+ dataArray[9][4] // "tradedVolume"
		//+'</td><td>'
		//+ dataArray[9][5] // "value"
		+'</td></tr>'
		
		return tablesStr;
	}

	//for( var i=0; i< Object.keys( passedDataObj ).length ; i++ ) {
	for( var i=0; i< 50 ; i++ ) {
	//var symbol = symbolStr.split('_')[0]
	var symbolStr = Object.keys( passedDataObj )[i]
	var symbolStrBackward = Object.keys( passedDataObj )[ Object.keys( passedDataObj ).length -1 - i ]
	
	{
		var symbol = symbolStr.split('_')[0]
		var dataObj = JSON.parse( allDerivativesDataObj[symbol]['data'] )
		var identifier = symbolStr.split('_')[1]

		//console.log(symbol, identifier, dataObj[ identifier ])
		var dataArray = dataObj[ identifier ]
	
			//if( symbol.includes('NIFTY')==false )
			{
	//optOILosersTablesStr
			futOIGainersTablesStr +=	returnDataStr( symbol, identifier, dataArray )
		
		}
	}
		
	{
		var symbol = symbolStrBackward.split('_')[0]
		var dataObj = JSON.parse( allDerivativesDataObj[symbol]['data'] )
		var identifier = symbolStrBackward.split('_')[1]
		
		//console.log(symbol, identifier, dataObj[ identifier ])
		var dataArray = dataObj[ identifier ]
		
		
		
			//if( symbol.includes('NIFTY')==false )
			{

		//optOILosersTablesStr
		futOILosersTablesStr += returnDataStr( symbol, identifier, dataArray )
		
		}
	}
	
	}
	
	futOIGainersTablesStr +=' </tbody> </table>    </div>  </div>'
	futOILosersTablesStr +=' </tbody> </table>    </div>  </div>'


	
	 document.getElementById('futOIGainersTableContainer').innerHTML = futOIGainersTablesStr;
	 document.getElementById('futOILosersTableContainer').innerHTML = futOILosersTablesStr;

}	// Function ENDS HERE

async function showFutPricePerChngStocks( selectedSpurtsTimeValue, selectedTradingDate, passedDataObj )
{
	 document.getElementById('futPriceGainersTableContainer').innerHTML = "";
	 document.getElementById('futPriceLosersTableContainer').innerHTML = "";

	var onlySpurtsSelectedTime = selectedSpurtsTimeValue


	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => b[1] - a[1] ) )   // for sorting object ascending
	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => a[1] - b[1] ) )   // for sorting object descending
	var theadStr = '<thead class="tableRowClass">   <tr>      '
	+'<th>Symbol</th>'
	+' <th>Type</th>'
	+' <th>LTP</th>'
	//+'<th>Vol</th>   '
	+'<th>Val</th>      '
	+' <th>OI</th>'
	+' <th>COI</th>      '
	//+' <th>%COI</th>      '
	+' <th>%Price</th>      '
	+' <th>PremTO</th>      '
	//+' <th>TVol</th>      '
	//+' <th>TO</th>      '

	+' </tr></thead><tbody>'
	var futOIGainersTablesStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="futPriceGainersTablesStr"><caption style="caption-side:top"> Futures Price Gainers | '+selectedTradingDate+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	var futOILosersTablesStr =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="futPriceLosersTablesStr"><caption style="caption-side:top">Futures Price Losers | '+selectedTradingDate+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	
	function returnDataStr( symbol, identifier, dataArray )
	{
		
			var strikePrice;
		if( identifier.includes('CE') ==true ) 
			strikePrice =  "CE "+Number( identifier.split('CE')[1] ) +" ("+ formatDateMonth( identifier.split('CE')[0].split('STK')[1] ) +")"
		else if( identifier.includes('PE') ==true ) 
			strikePrice ="PE "+Number( identifier.split('PE')[1] ) +" ("+ formatDateMonth( identifier.split('PE')[0].split('STK')[1] ) +")"
		else if( identifier.includes('FUT') ==true ) 
			strikePrice = formatMonth( identifier.split('STK')[1].split('XX')[0] ) + " FUT"
		
		
		var tablesStr = '<tr class="item"><td>'
		+ symbol
		+'</td><td>'
		//+ identifier // fur/opt
		+ strikePrice // fur/opt
		+'</td><td>'
		+ dataArray[3] // ltp
		+'</td><td>'
		//+ dataArray[7] //"numberOfContractsTraded"
		//+'</td><td>'
		+ dataArray[8] //"totalTurnover"
		+'</td><td>'
	 	  + dataArray[9][0]  //"OpenInterest"
	 	  //+ dataArray[9][4]  //""tradedVolume""
		+'</td><td>'
		+ dataArray[9][1] // ""changeinOpenInterest""
		+'</td><td>'
		//+ dataArray[9][2].toFixed(2)// "pchangeinOpenInterest"
		+ dataArray[5].toFixed(2)// "pchange"
		+'</td><td>'
		+ dataArray[9][3].toFixed(0) // "premiumTurnover"
		//+'</td><td>'
		//+ dataArray[9][4] // "tradedVolume"
		//+'</td><td>'
		//+ dataArray[9][5] // "value"
		+'</td></tr>'
		
		return tablesStr;
	}

	//for( var i=0; i< Object.keys( passedDataObj ).length ; i++ ) {
	for( var i=0; i< 50 ; i++ ) {
	//var symbol = symbolStr.split('_')[0]
	var symbolStr = Object.keys( passedDataObj )[i]
	var symbolStrBackward = Object.keys( passedDataObj )[ Object.keys( passedDataObj ).length -1 - i ]
	
	{
		var symbol = symbolStr.split('_')[0]
		var dataObj = JSON.parse( allDerivativesDataObj[symbol]['data'] )
		var identifier = symbolStr.split('_')[1]

		//console.log(symbol, identifier, dataObj[ identifier ])
		var dataArray = dataObj[ identifier ]
	
			//if( symbol.includes('NIFTY')==false )
			{
	//optOILosersTablesStr
			futOIGainersTablesStr +=	returnDataStr( symbol, identifier, dataArray )
		
		}
	}
		
	{
		var symbol = symbolStrBackward.split('_')[0]
		var dataObj = JSON.parse( allDerivativesDataObj[symbol]['data'] )
		var identifier = symbolStrBackward.split('_')[1]
		
		//console.log(symbol, identifier, dataObj[ identifier ])
		var dataArray = dataObj[ identifier ]
		
		
		
			//if( symbol.includes('NIFTY')==false )
			{

		//optOILosersTablesStr
		futOILosersTablesStr += returnDataStr( symbol, identifier, dataArray )
		
		}
	}
	
	}
	
	futOIGainersTablesStr +=' </tbody> </table>    </div>  </div>'
	futOILosersTablesStr +=' </tbody> </table>    </div>  </div>'


	
	 document.getElementById('futPriceGainersTableContainer').innerHTML = futOIGainersTablesStr;
	 document.getElementById('futPriceLosersTableContainer').innerHTML = futOILosersTablesStr;

}	//Function ENDS HERE

const formatDate = inputDate => {
  const [day, month, year] = inputDate.split('-');
  return `${day}-${['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'][parseInt(month, 10) - 1]}-${year}`;
};

const formatDateMonth = inputDate => {
  const [day, month, year] = inputDate.split('-');
  return `${day} ${['JAN','FEB','MAR','APR','MAY','JUN','JUL','AUG','SEP','OCT','NOV','DEC'][parseInt(month, 10) - 1]}`;
};


const formatMonth = inputDate => {
  const [day, month, year] = inputDate.split('-');
  return `${['JAN','FEB','MAR','APR','MAY','JUN','JUL','AUG','SEP','OCT','NOV','DEC'][parseInt(month, 10) - 1]}`;
};

async function getPerticularDerivativeData( passedValue )
{
	var tradingDate = document.getElementById('tradingDate').value
	var selectedMonthYear = document.getElementById('monthYear').value
	var selectedTradingDate = document.getElementById('tradingDate').value
	
	var selectedDerivativesTimeRef = document.getElementById('derivativesTimeValues')
	var selectedDerivativesTimeValue = selectedDerivativesTimeRef.value

	var docPathForSpurts = '/'+selectedMonthYear+'/'+selectedTradingDate+'/all_derivatives/'+selectedDerivativesTimeValue+'/'+selectedDerivativesTimeValue
	//var allDerivativesDataArray = await fetchDerivativesCollectionData( docPathForSpurts )
	var allDerivativesDataObj = await fetchAndSaveDataIDB( docPathForSpurts );

	//console.log( "allDerivativesDataArray", allDerivativesDataArray )
	//console.log( "allDerivativesDataArray.length", JSON.stringify( allDerivativesDataArray ).length )

	await showPerticularDerivativeData( selectedDerivativesTimeValue, selectedTradingDate, allDerivativesDataObj )
	
	addEventListnerInTables()
}

async function showPerticularDerivativeData( selectedSpurtsTimeValue, selectedTradingDate, allDerivativesDataObj )
{

	 document.getElementById('perticularDerivativeTableContainer').innerHTML = "";
	 //document.getElementById('optionsDerivativesTableContainer').innerHTML = "";

	var onlySpurtsSelectedTime = selectedSpurtsTimeValue

	var selectedDerivativesSymbol = document.getElementById('derivativesSymbols').value
	//var spurtsInOIUnderlyingsObject = spurtsDataObj['data']
	//var niftyTotalMarketObject = equityDataObj ['data']


	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => b[1] - a[1] ) )   // for sorting object ascending
	//Object.fromEntries( Object.entries(FnOList).sort( (a,b) => a[1] - b[1] ) )   // for sorting object descending
	var theadStr = '<thead class="tableRowClass">   <tr>      '
	+'<th>Symbol</th>'
	+' <th>Type</th>'
	+' <th>LTP</th>'
	+'<th>Vol</th>   '
	+'<th>Val</th>      '
	+' <th>OI</th>'
	+' <th>COI</th>      '
	+' <th>%COI</th>      '
	+' <th>PremTO</th>      '
	+' <th>%Chng</th>      '
	//+' <th>TO</th>      '

	+' </tr></thead><tbody>'
	//var tablesStrFutures =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="futuresDerivativesTableStr"><caption style="caption-side:top"> Futures Derivatives | '+selectedTradingDate+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
	var tablesStrOptions =  '<div class=""><div class="spaceBetweenTablesSpurtsEquity"><table id="optionsPerticularDerivativeTableStr"><caption style="caption-side:top">Options Derivatives | '+selectedTradingDate+' | '+onlySpurtsSelectedTime+'</caption>'+theadStr 
		
	{
	//for( var symbol in allDerivativesDataObj ) {

	 var symbol = selectedDerivativesSymbol
	var dataObj = JSON.parse( allDerivativesDataObj[symbol]['data'] )
	
	for( var i=0; i< Object.keys( dataObj ).length ; i++ ) {
	//for( var i=0; i< 9 ; i++ ) {
	var identifier = Object.keys( dataObj )[i]
	//if( identifier.includes('FUTSTK')==true || identifier.includes('OPTSTK')==true )
	if( identifier.includes('OPTSTK')==true && document.getElementById('optionsCheckbox').checked )
	{
		//console.log(symbol, identifier, dataObj[ identifier ])
		var dataArray = dataObj[ identifier ]
		
		
		var strikePrice;
		var expirtDate;
		
		if( identifier.includes('CE') ==true ) 
		{
		strikePrice = "CE "+Number( identifier.split('CE')[1] )
		expirtDate = formatDate( identifier.split('CE')[0].split('STK')[1] );

		
		}
		else if( identifier.includes('PE') ==true ) 
		{
		strikePrice = "PE "+Number( identifier.split('PE')[1] )
		expirtDate = formatDate( identifier.split('PE')[0].split('STK')[1] );
		}
			
		
		identifier = identifier.split('STK')[0]
		
			//if( symbol.includes('NIFTY')==false )
			{

		tablesStrOptions +='<tr class="item"><td>'
		+ symbol
		+'</td><td>'
		//+ identifier // fur/opt
		+ strikePrice + ' ('+expirtDate +')'// fur/opt
		+'</td><td>'
		+ dataArray[3] // ltp
		+'</td><td>'
		+ dataArray[7] //"numberOfContractsTraded"
		+'</td><td>'
		+ dataArray[8] //"totalTurnover"
		+'</td><td>'
	 	  + dataArray[9][0]  //"OpenInterest"
	 	  //+ dataArray[9][4]  //""tradedVolume""
		+'</td><td>'
		+ dataArray[9][1] // ""changeinOpenInterest""
		+'</td><td>'
		+ dataArray[9][2].toFixed(2)// "pchangeinOpenInterest"
		+'</td><td>'
		+ dataArray[9][3].toFixed(0) // "premiumTurnover"
		+'</td><td>'
		+ dataArray[5].toFixed(2) // "pchange"
		//+'</td><td>'
		//+ dataArray[9][5] // "value"
		+'</td></tr>'
		}
	}	
	else if( identifier.includes('FUTSTK')==true && document.getElementById('futuresCheckbox').checked )
	{
		//console.log(symbol, identifier, dataObj[ identifier ])
		var dataArray = dataObj[ identifier ]
		identifier = identifier.split('STK')[0]
		
			//if( symbol.includes('NIFTY')==false )
			{

		tablesStrOptions +='<tr class="item"><td>'
			+ symbol
		+'</td><td>'
		//+ identifier // fur/opt
		+ identifier // fur/opt
		+'</td><td>'
		+ dataArray[3] // ltp
		+'</td><td>'
		+ dataArray[7] //"numberOfContractsTraded"
		+'</td><td>'
		+ dataArray[8] //"totalTurnover"
		+'</td><td>'
	 	  + dataArray[9][0]  //"OpenInterest"
	 	  //+ dataArray[9][4]  //""tradedVolume""
		+'</td><td>'
		+ dataArray[9][1] // ""changeinOpenInterest""
		+'</td><td>'
		+ dataArray[9][2].toFixed(2)// "pchangeinOpenInterest"
		+'</td><td>'
		+ dataArray[9][3].toFixed(0) // "premiumTurnover"
		+'</td><td>'
		+ dataArray[5].toFixed(2) // "pchange"
		//+'</td><td>'
		//+ dataArray[9][5] // "value"
		+'</td></tr>'
		}
	}
	}
	
	
	
	}
	//tablesStrFutures +=' </tbody> </table>    </div>  </div>'
	tablesStrOptions +=' </tbody> </table>    </div>  </div>'


	
	 //document.getElementById('futuresDerivativesTableContainer').innerHTML = tablesStrFutures;
	 document.getElementById('perticularDerivativeTableContainer').innerHTML = tablesStrOptions;
	 //document.getElementById('allSpurtsUnderlyingsColumnsContainer').innerHTML += tablesStrForNegative;
	 
	// await addEventListnerInTables()
}	//	show_spurts_in_oi_underlyings_Data() Function ENDS HERE

function addOnclickEvent()
{
var tableRows = document.getElementsByTagName('tr')

for( var i=0;i<tableRows.length;i++ )
{
var tableData = tableRows[i].getElementsByTagName('td')[0]
var tableHead = tableRows[i].getElementsByTagName('th')

if( tableData==undefined && tableHead[0] !=undefined )
{
/*
console.log(tableHead[0].innerHTML)
for( var j=0;j<tableHead.length;j++ )
{
var functionStr ="addOnclickEvent();" + tableHead[j].getAttribute('onclick')
 tableHead[j].setAttribute('onclick', functionStr)
 }
 */
}
else
{
var functionStr = "document.getElementById('derivativesSymbols').value ='"+tableData.innerHTML+"';showPerticularStocksEquityDataInTable();document.getElementById('highest_ask_bid_orders_tick_wise_TableContainer').scrollIntoView();"
tableData.setAttribute('onclick', functionStr)
}
}
}

function tableSortAndPushData(tableHead,event)
{
	var clicked_heading_index = tableHead.closest('th').cellIndex
	var clicked_table_id=tableHead.closest("table").id
	
	//console.log("clicked heading index "+ clicked_heading_index  )
	//console.log("clicked table index "+ clicked_table_id )
	
	var table=tableHead.closest("table")
   	var fetchedTableData = [];
	table.tBodies[0].getElementsByTagName('tr').length

	for( var tableRow=0;  tableRow<table.tBodies[0].getElementsByTagName('tr').length; tableRow++ )
	{
	var keysValuesObj={}
	var td=(table.tBodies[0].getElementsByTagName('tr')[tableRow]).getElementsByTagName('td')
	for( var tableData=0;  tableData< td.length; tableData++ )
	{
	if(isNaN(td[tableData].innerText) == false )
	{
	keysValuesObj["column"+tableData] = Number( td[tableData].innerText )
	}
	else
	{
	keysValuesObj["column"+tableData] =  td[tableData].innerText 
	}

	}
	
	fetchedTableData.push(keysValuesObj)
	}
	//console.log(fetchedTableData)
	
	
	
	   let element = event.target;
		//  console.log(element)
      let caret, field, reverse;
      if (element.tagName === 'SPAN') {
        caret = element.getElementsByClassName('caret')[0];
 
      }
      else {
        caret = element;
 
      }
	  
	       field = "column"+clicked_heading_index 
		   
      let iconClassName = caret.className;
      clearArrow();
	 // console.log("cleared carets, iconClassName: " + iconClassName)
      if (iconClassName.includes(caretUpClassName)) {
        caret.className = `caret ${caretDownClassName}`;
        reverse = false;
      } else {
		 caret.className = `caret ${caretUpClassName}`;
        reverse = true;
      }

      fetchedTableData.sort(sort_by(field, reverse));
      populateTable(fetchedTableData, clicked_table_id);
	addOnclickEvent()
	} // tableSortAndPushData() ENDS HERE

</script>
<!-- All Derivatives Code Ends Here -->




<!-- Floating Buttons Code Starts Here -->
<style>		.float{	position:fixed;	width:25px;	height:50px;	bottom:16%;	right:10px;			border-radius:50px;	text-align:center;	}.vertical-centerFloat {   float: right;  margin: 0;  position: sticky;  top: 50%;  -ms-transform: translateY(-50%);  transform: translateY(-50%);	}  .Floatbtn{ margin-top:1px;} </style>
<div class="float"> 	<button class="Floatbtn" onclick="document.getElementById('commonTimeValues').scrollIntoView();"><b><span style="font-size:20px;">&#8593;</span></b></button><br/>	   	 <button class="Floatbtn" onclick="getFirestoreData('live','')"><b><span style="font-size:20px;">&#8883;</span></b></button>		<button class="Floatbtn" onclick="document.getElementById('highest_ask_bid_orders_tick_wise_TableContainer').scrollIntoView();"><b><span style="font-size:20px;">&#8595;</span></b></button><br/>	 </div>
<!--<div class="float"> 	<button class="Floatbtn" onclick="document.getElementById('IndicesPerformanceChart').scrollIntoView();"><b><span style="font-size:20px;">&#8593;</span></b></button><br/>	    <button class="Floatbtn" onclick="getFirestoreData('refresh','')"><b><span style="font-size:20px;">&#8635;</span></b></button><br/>		 <button class="Floatbtn" onclick="getFirestoreData('live','')"><b><span style="font-size:20px;">&#8883;</span></b></button><br/>	    <button class="Floatbtn" onclick="document.getElementById(\'indices_performance_time\').scrollIntoView();"><b><span style="font-size:20px;">&#8595;</span></b></button>	<br/>	    <button class="Floatbtn" onclick="document.getElementById(\'EquitySpurtsContainerDiv\').scrollIntoView();"><b><span style="font-size:20px;">&#8595;</span></b></button>	<br/>	    <button class="Floatbtn" onclick="document.getElementById(\'heatMapSectorSelector\').scrollIntoView();"><b><span style="font-size:20px;">&#8595;</span></b></button>	</div> -->
<!-- Floating Buttons Code Ends Here -->


<script>
generateMonthYearFromDate( new Date("January 2025") );
</script>